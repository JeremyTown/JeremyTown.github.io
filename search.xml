<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Git 指南</title>
      <link href="/2019/05/26/git/"/>
      <url>/2019/05/26/git/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-获取-Git-仓库"><a href="#1-获取-Git-仓库" class="headerlink" title="1. 获取 Git 仓库"></a>1. 获取 Git 仓库</h2><h3 id="在现有目录中初始化仓库"><a href="#在现有目录中初始化仓库" class="headerlink" title="在现有目录中初始化仓库"></a>在现有目录中初始化仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><h3 id="克隆现有的仓库"><a href="#克隆现有的仓库" class="headerlink" title="克隆现有的仓库"></a>克隆现有的仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/libgit2/libgit2 mylibgit</span><br></pre></td></tr></table></figure><h2 id="2-记录每次更新到仓库"><a href="#2-记录每次更新到仓库" class="headerlink" title="2. 记录每次更新到仓库"></a>2. 记录每次更新到仓库</h2><h3 id="检查当前文件状态"><a href="#检查当前文件状态" class="headerlink" title="检查当前文件状态"></a>检查当前文件状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h3 id="跟踪新文件"><a href="#跟踪新文件" class="headerlink" title="跟踪新文件"></a>跟踪新文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add README</span><br><span class="line">git status</span><br></pre></td></tr></table></figure><h3 id="暂存已修改文件"><a href="#暂存已修改文件" class="headerlink" title="暂存已修改文件"></a>暂存已修改文件</h3><h3 id="状态简览"><a href="#状态简览" class="headerlink" title="状态简览"></a>状态简览</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status --short</span><br><span class="line">git status -s</span><br></pre></td></tr></table></figure><h3 id="忽略文件"><a href="#忽略文件" class="headerlink" title="忽略文件"></a>忽略文件</h3><p>使用 .gitignore 文件</p><ul><li>所有空行或者以 ＃ 开头的行都会被 Git 忽略。</li><li>可以使用标准的 glob 模式匹配。</li><li>匹配模式可以以（/）开头防止递归。</li><li>匹配模式可以以（/）结尾指定目录。</li><li>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。</li></ul><p>glob 模式</p><ul><li>星号（*）匹配零个或多个任意字符；</li><li>[abc] 匹配任何一个列在方括号中的字符；</li><li>问号（?）只匹配一个任意字符；</li><li>如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配；</li><li>使用两个星号（*) 表示匹配任意中间目录。</li></ul><h3 id="查看已暂存和未暂存的修改"><a href="#查看已暂存和未暂存的修改" class="headerlink" title="查看已暂存和未暂存的修改"></a>查看已暂存和未暂存的修改</h3><ul><li>查看尚未暂存的文件更新了哪些部分</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure><ul><li>查看已暂存的将要添加到下次提交里的内容</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git diff --staged</span><br><span class="line">git diff --cached</span><br></pre></td></tr></table></figure><h3 id="提交更新"><a href="#提交更新" class="headerlink" title="提交更新"></a>提交更新</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"first commit"</span></span><br></pre></td></tr></table></figure><h3 id="跳过使用暂存区域"><a href="#跳过使用暂存区域" class="headerlink" title="跳过使用暂存区域"></a>跳过使用暂存区域</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m <span class="string">"second commit"</span></span><br></pre></td></tr></table></figure><h3 id="移除文件"><a href="#移除文件" class="headerlink" title="移除文件"></a>移除文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm [file_name]</span><br></pre></td></tr></table></figure><p>把文件从 Git 仓库中删除，文件保留在当前工作目录中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached [file_name]</span><br></pre></td></tr></table></figure><h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git mv file_from file_to</span><br></pre></td></tr></table></figure><h2 id="3-查看提交历史"><a href="#3-查看提交历史" class="headerlink" title="3. 查看提交历史"></a>3. 查看提交历史</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -p -2 <span class="comment"># -p 显示每次提交的内容差异，-2 仅显示最近两次提交</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span> <span class="comment"># 查看提交的简略的统计信息</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment"># 将每个提交放在一行显示</span></span><br><span class="line">git <span class="built_in">log</span> --short</span><br><span class="line">git <span class="built_in">log</span> --full</span><br><span class="line">git <span class="built_in">log</span> --fuller</span><br><span class="line">git <span class="built_in">log</span> --pretty=online</span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an, %ar : %s"</span> --graph <span class="comment"># 定制要显示的记录格式</span></span><br></pre></td></tr></table></figure><p><code>git log</code> 常用选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">-p</td><td align="left">按补丁格式显示每个更新之间的差异</td></tr><tr><td align="right">–stat</td><td align="left">显示每次更新的文件修改统计信息。</td></tr><tr><td align="right">–shortstat</td><td align="left">只显示 –stat 中最后的行数修改添加移除统计。</td></tr><tr><td align="right">–name-only</td><td align="left">仅在提交信息后显示已修改的文件清单。</td></tr><tr><td align="right">–name-status</td><td align="left">显示新增、修改、删除的文件清单。</td></tr><tr><td align="right">–abbrev-commit</td><td align="left">仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。</td></tr><tr><td align="right">–relative-date</td><td align="left">使用较短的相对时间显示（比如，“2 weeks ago”）。</td></tr><tr><td align="right">–graph</td><td align="left">显示 ASCII 图形表示的分支合并历史。</td></tr><tr><td align="right">–pretty</td><td align="left">使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。</td></tr></tbody></table><p><code>git log --pretty=format</code> 常用的选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">%H</td><td align="left">提交对象（commit）的完整哈希字串</td></tr><tr><td align="right">%h</td><td align="left">提交对象的简短哈希字串</td></tr><tr><td align="right">%T</td><td align="left">树对象（tree）的完整哈希字串</td></tr><tr><td align="right">%t</td><td align="left">树对象的简短哈希字串</td></tr><tr><td align="right">%P</td><td align="left">父对象（parent）的完整哈希字串</td></tr><tr><td align="right">%p</td><td align="left">父对象的简短哈希字串</td></tr><tr><td align="right">%an</td><td align="left">作者（author）的名字</td></tr><tr><td align="right">%ae</td><td align="left">作者的电子邮件地址</td></tr><tr><td align="right">%ad</td><td align="left">作者修订日期（可以用 –date= 选项定制格式）</td></tr><tr><td align="right">%ar</td><td align="left">作者修订日期，按多久以前的方式显示</td></tr><tr><td align="right">%cn</td><td align="left">提交者（committer）的名字</td></tr><tr><td align="right">%ce</td><td align="left">提交者的电子邮件地址</td></tr><tr><td align="right">%cd</td><td align="left">提交日期</td></tr><tr><td align="right">%cr</td><td align="left">提交日期，按多久以前的方式显示</td></tr><tr><td align="right">%s</td><td align="left">提交说明</td></tr></tbody></table><h3 id="限制输出长度"><a href="#限制输出长度" class="headerlink" title="限制输出长度"></a>限制输出长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --since=2.weeks</span><br></pre></td></tr></table></figure><p>限制 <code>git log</code> 输出的选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">-(n)</td><td align="left">仅显示最近的 n 条提交</td></tr><tr><td align="right">–since, –after</td><td align="left">仅显示指定时间之后的提交</td></tr><tr><td align="right">–until, –before</td><td align="left">仅显示指定时间之前的提交</td></tr><tr><td align="right">–author</td><td align="left">仅显示指定作者相关的提交</td></tr><tr><td align="right">–committer</td><td align="left">仅显示指定提交者相关的提交</td></tr><tr><td align="right">–grep</td><td align="left">仅显示含指定关键字的提交</td></tr><tr><td align="right">-S</td><td align="left">仅显示添加或移除了某个关键字的提交</td></tr></tbody></table><h2 id="4-撤消操作"><a href="#4-撤消操作" class="headerlink" title="4. 撤消操作"></a>4. 撤消操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><h3 id="取消暂存的文件"><a href="#取消暂存的文件" class="headerlink" title="取消暂存的文件"></a>取消暂存的文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git reset HEAD &lt;file&gt; ...</span></span><br><span class="line">git reset HEAD CONTRIBUTING.md</span><br></pre></td></tr></table></figure><h3 id="撤消对文件的修改"><a href="#撤消对文件的修改" class="headerlink" title="撤消对文件的修改"></a>撤消对文件的修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git checkout -- &lt;file&gt;</span></span><br><span class="line">git checkout -- CONTRIBUTING.md</span><br></pre></td></tr></table></figure><h2 id="5-远程仓库的使用"><a href="#5-远程仓库的使用" class="headerlink" title="5. 远程仓库的使用"></a>5. 远程仓库的使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/schacon/ticgit</span><br><span class="line">git remote</span><br><span class="line">git remote -v</span><br><span class="line">git remote add pb https://github.com/paulboone/ticgit</span><br><span class="line">git fetch pb</span><br></pre></td></tr></table></figure><h3 id="从远程仓库中抓取与拉取"><a href="#从远程仓库中抓取与拉取" class="headerlink" title="从远程仓库中抓取与拉取"></a>从远程仓库中抓取与拉取</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch [remote-name]</span><br></pre></td></tr></table></figure><h3 id="推送到远程仓库"><a href="#推送到远程仓库" class="headerlink" title="推送到远程仓库"></a>推送到远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h3 id="查看远程仓库"><a href="#查看远程仓库" class="headerlink" title="查看远程仓库"></a>查看远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git remote show [remote-name]</span></span><br><span class="line">git remote show origin</span><br></pre></td></tr></table></figure><h3 id="远程仓库的移除与重命名"><a href="#远程仓库的移除与重命名" class="headerlink" title="远程仓库的移除与重命名"></a>远程仓库的移除与重命名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote rename pb paul</span><br><span class="line">git remote rm paul</span><br></pre></td></tr></table></figure><h2 id="6-打标签"><a href="#6-打标签" class="headerlink" title="6. 打标签"></a>6. 打标签</h2><h3 id="列出标签"><a href="#列出标签" class="headerlink" title="列出标签"></a>列出标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br><span class="line">git tag -l <span class="string">'v1.8.5*'</span></span><br></pre></td></tr></table></figure><h3 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h3><h3 id="附注标签"><a href="#附注标签" class="headerlink" title="附注标签"></a>附注标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag -a v1.4 -m <span class="string">'my version 1.4'</span></span><br><span class="line">git tag</span><br><span class="line">git show v1.4 <span class="comment"># 查看标签信息与对应的提交信息</span></span><br></pre></td></tr></table></figure><h3 id="轻量标签"><a href="#轻量标签" class="headerlink" title="轻量标签"></a>轻量标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.4-lw</span><br><span class="line">git tag</span><br></pre></td></tr></table></figure><h3 id="后期打标签"><a href="#后期打标签" class="headerlink" title="后期打标签"></a>后期打标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">git tag -a v1.2 &lt;部分校验和&gt; <span class="comment"># git tag -a v1.2 9fceb02</span></span><br></pre></td></tr></table></figure><h3 id="共享标签"><a href="#共享标签" class="headerlink" title="共享标签"></a>共享标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push origin v1.5</span><br><span class="line">git push origin --tags <span class="comment"># 一次性推送全部标签</span></span><br></pre></td></tr></table></figure><h3 id="检出标签"><a href="#检出标签" class="headerlink" title="检出标签"></a>检出标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git checkout -b [branchname] [tagname] 在特定的标签上创建一个新分支</span></span><br><span class="line">git checkout -b version2 v2.0.0</span><br></pre></td></tr></table></figure><h2 id="7-Git-别名"><a href="#7-Git-别名" class="headerlink" title="7. Git 别名"></a>7. Git 别名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br><span class="line">git config --global alias.unstage <span class="string">'reset HEAD --'</span></span><br><span class="line">git config --global alias.last <span class="string">'log -1 HEAD'</span></span><br><span class="line"><span class="comment"># 执行外部命令，在命令前面加入 ! 符号</span></span><br><span class="line">git config --global alias.visual <span class="string">'!gitk'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus + Grafana</title>
      <link href="/2019/02/27/promethues/"/>
      <url>/2019/02/27/promethues/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="安装-GO"><a href="#安装-GO" class="headerlink" title="安装 GO"></a>安装 GO</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install go</span><br><span class="line">[root@mysqlnode05 go]# go version</span><br></pre></td></tr></table></figure><h2 id="安装-prometheus"><a href="#安装-prometheus" class="headerlink" title="安装 prometheus"></a>安装 prometheus</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf prometheus-2.7.1.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# mv prometheus-2.7.1.linux-amd64 /appdata/prometheus</span><br><span class="line">[root@master ~]# cd /appdata/prometheus/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改prometheus.yml文件，配置targets其中的IP和端口则是对应的exporter的监听端口</span></span><br><span class="line">[root@master ~]# vim prometheus.yml</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line"><span class="attr">  scrape_interval:</span>     <span class="number">15</span><span class="string">s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line"><span class="attr">  evaluation_interval:</span> <span class="number">15</span><span class="string">s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line"><span class="attr">  alertmanagers:</span></span><br><span class="line"><span class="attr">  - static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line">      <span class="comment"># - alertmanager:9093</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="comment"># - "first_rules.yml"</span></span><br><span class="line">  <span class="comment"># - "second_rules.yml"</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['192.168.41.131:9090']</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'master'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['192.168.41.131:9100']</span></span><br><span class="line"><span class="attr">        labels:</span></span><br><span class="line"><span class="attr">          instance:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'slave'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['192.168.41.132:9100']</span></span><br><span class="line"><span class="attr">        labels:</span></span><br><span class="line"><span class="attr">          instance:</span> <span class="string">slave</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'mysql-master'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['192.168.41.131:9104']</span></span><br><span class="line"><span class="attr">        labels:</span></span><br><span class="line"><span class="attr">          instance:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'mysql-slave'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['192.168.41.132:9104']</span></span><br><span class="line"><span class="attr">        labels:</span></span><br><span class="line"><span class="attr">          instance:</span> <span class="string">slave</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动并通过web访问</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/prometheus --config.file /appdata/prometheus/prometheus.yml &gt;&gt; /appdata/prometheus/prometheus.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="安装-mysqld-exporter"><a href="#安装-mysqld-exporter" class="headerlink" title="安装 mysqld_exporter"></a>安装 mysqld_exporter</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf mysqld_exporter-0.11.0.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# cp mysqld_exporter-0.11.0.linux-amd64/mysqld_exporter /appdata/prometheus/</span><br><span class="line">[root@master ~]# mysql -uroot -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建专用用户</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create user <span class="string">'prometheus'</span>@<span class="string">'%'</span> identified by <span class="string">'xxxxxx'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant REPLICATION CLIENT,PROCESS,SELECT ON *.* TO <span class="string">'prometheus'</span>@<span class="string">'%'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建exporter配置文件</span></span><br><span class="line">[root@master ~]# vim /appdata/prometheus/.my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">user=mysql_prome</span><br><span class="line">password=Aa123456789</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动mysqld_exporter</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/mysqld_exporter --config.my-cnf /appdata/prometheus/.my.cnf &gt;&gt; /appdata/prometheus/mysqld_exporter.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="安装-node-exporter"><a href="#安装-node-exporter" class="headerlink" title="安装 node_exporter"></a>安装 node_exporter</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf node_exporter-0.17.0.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# cp node_exporter-0.17.0.linux-amd64/node_exporter /appdata/prometheus/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动node_exporter</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/node_exporter &gt;&gt; /appdata/prometheus/node_exporter.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="查看-target-status"><a href="#查看-target-status" class="headerlink" title="查看 target status"></a>查看 target status</h2><p>浏览器访问 <a href="http://192.168.31.131:9090" target="_blank" rel="noopener">http://192.168.31.131:9090</a></p><h2 id="安装-grafana"><a href="#安装-grafana" class="headerlink" title="安装 grafana"></a>安装 grafana</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# wget https://dl.grafana.com/oss/release/grafana-6.0.0-1.x86_64.rpm </span><br><span class="line">[root@master ~]# yum -y install grafana-6.0.0-1.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动grafana</span></span><br><span class="line">[root@master ~]# systemctl enable grafana-server</span><br><span class="line">[root@master ~]# systemctl start grafana-server</span><br></pre></td></tr></table></figure><h2 id="添加数据源"><a href="#添加数据源" class="headerlink" title="添加数据源"></a>添加数据源</h2><p>浏览器访问 <a href="http://192.168.31.131:3000" target="_blank" rel="noopener">http://192.168.31.131:3000</a></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> prometheus </tag>
            
            <tag> grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 安装指南</title>
      <link href="/2019/02/18/mysql/"/>
      <url>/2019/02/18/mysql/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h1 id="1-安装并初始化数据库"><a href="#1-安装并初始化数据库" class="headerlink" title="1. 安装并初始化数据库"></a>1. 安装并初始化数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ls</span></span><br><span class="line">mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">[root@master ~]<span class="comment"># tar -Jxf mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span></span><br><span class="line">[root@master ~]<span class="comment"># ls</span></span><br><span class="line">mysql-8.0.15-linux-glibc2.12-x86_64  mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">[root@master ~]<span class="comment"># mkdir /appdata </span></span><br><span class="line">[root@master ~]<span class="comment"># mv mysql-8.0.15-linux-glibc2.12-x86_64 /appdata/mysql</span></span><br><span class="line">[root@master ~]<span class="comment"># cd /appdata/mysql/bin</span></span><br><span class="line">[root@master bin]<span class="comment"># ./mysqld --verbose --help</span></span><br><span class="line">[root@master bin]<span class="comment"># ./mysqld --initialize --user=mysql</span></span><br><span class="line">2019-02-17T13:24:47.271942Z 0 [Warning] [MY-011070] [Server] <span class="string">'Disabling symbolic links using --skip-symbolic-links (or equivalent) is the default. Consider not using this option as it'</span> is deprecated and will be removed <span class="keyword">in</span> a future release.</span><br><span class="line">2019-02-17T13:24:47.272022Z 0 [System] [MY-013169] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server <span class="keyword">in</span> progress as process 9517</span><br><span class="line">2019-02-17T13:24:49.230753Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: fYd00.&lt;Ucx:0</span><br><span class="line">2019-02-17T13:24:50.553995Z 0 [System] [MY-013170] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server has completed</span><br></pre></td></tr></table></figure><h1 id="2-编辑自定义配置文件"><a href="#2-编辑自定义配置文件" class="headerlink" title="2. 编辑自定义配置文件"></a>2. 编辑自定义配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim /etc/my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">basedir=/appdata/mysql</span><br><span class="line">datadir=/appdata/mysql/data</span><br><span class="line">socket=/appdata/mysql/data/mysql.sock</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server-id=1</span><br><span class="line">binlog_format=MIXED</span><br><span class="line">gtid_mode = on</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line">log_slave_updates = 1</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line">interactive_timeout = 28800000</span><br><span class="line">wait_timeout = 28800000</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket=/appdata/mysql/data/mysql.sock</span><br></pre></td></tr></table></figure><h1 id="3-启动MySQL"><a href="#3-启动MySQL" class="headerlink" title="3. 启动MySQL"></a>3. 启动MySQL</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cp /appdata/mysql/support-files/mysql.server /etc/init.d/</span><br><span class="line">[root@master ~]# vim /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">basedir=/appdata/mysql</span><br><span class="line">datadir=/appdata/mysql/data</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# /etc/init.d/mysql.server start</span><br></pre></td></tr></table></figure><h1 id="4-设置主从同步"><a href="#4-设置主从同步" class="headerlink" title="4. 设置主从同步"></a>4. 设置主从同步</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql -uroot -pfYd00.&lt;Ucx:0</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER USER root@'localhost' IDENTIFIED BY 'Abc123';</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER replication@'%' IDENTIFIED WITH 'mysql_native_password' BY 'replication';</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to replication@'%';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE mysql.slave_master_info ENGINE=InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE mysql.slave_relay_log_info ENGINE=InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; reset slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST="slave.example.com",MASTER_USER='replication',MASTER_PASSWORD="replication",MASTER_AUTO_POSITION=1;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: slave.example.com</span><br><span class="line">                  Master_User: replication</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000015</span><br><span class="line">          Read_Master_Log_Pos: 1567</span><br><span class="line">               Relay_Log_File: master-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 456</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000015</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h1 id="5-问题处理"><a href="#5-问题处理" class="headerlink" title="5. 问题处理"></a>5. 问题处理</h1><blockquote><p>Error_code: MY-002061</p></blockquote><ul><li>不兼容的变化： 在caching_sha2_password和 sha256_password认证插件提供比更安全的密码加密 mysql_native_password插件，并 caching_sha2_password提供了比更好的性能sha256_password。由于这些优越的安全性和性能特性 caching_sha2_password，它现在是首选的身份验证插件，而且也是默认的身份验证插件而不是 mysql_native_password。此更改会影响服务器和libmysqlclient客户端库：<ul><li>对于服务器，default_authentication_plugin 系统变量的默认值 从更改 mysql_native_password为 caching_sha2_password。</li><li>该libmysqlclient库将其 caching_sha2_password视为默认的身份验证插件而不是 mysql_native_password。</li><li>此更改仅影响用于创建新MySQL帐户的身份验证插件。对于已升级安装中已存在的帐户，其身份验证插件保持不变。</li><li>使用经过身份验证的帐户的客户端 caching_sha2_password必须使用安全连接（使用TCP使用TLS / SSL凭据，Unix套接字文件或共享内存制作），或使用RSA密钥对支持密码交换的未加密连接。此安全要求不适用 mysql_native_passsword，因此交换机 caching_sha2_password可能需要其他配置（请参阅 缓存SHA-2可插入身份验证）。但是，默认情况下，MySQL 8.0中的客户端连接更喜欢使用TLS / SSL，因此已满足该首选项的客户端可能不需要其他配置。</li><li>因为caching_sha2_password现在也是libmysqlclient客户端库中的默认身份验证插件，所以 身份验证需要在客户端/服务器协议中进行额外的往返，以便从MySQL 8.0客户端连接到使用mysql_native_password（以前的默认身份验证插件）的帐户 ，除非调用客户端程序一个 –default-auth=mysql_native_password 选择。</li><li>不兼容：尚未更新的客户端和连接器 caching_sha2_password 无法连接到通过身份验证的帐户，caching_sha2_password 因为他们无法将此插件识别为有效。要解决此问题，请libmysqlclient从MySQL 8.0.4或更高版本重新链接客户端 ，或获取可识别的更新连接器 caching_sha2_password。</li><li>不兼容：尚未更新的客户端和连接器 caching_sha2_password可能无法连接到配置caching_sha2_password为默认身份验证插件的MySQL 8.0服务器 ，甚至使用未通过身份验证的帐户caching_sha2_password。出现此问题的原因是服务器为客户端指定其默认身份验证插件的名称。如果客户端或连接器基于未正常处理无法识别的默认身份验证插件的客户端/服务器协议实现，则可能会失败并显示错误。</li></ul></li></ul><blockquote><p>ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> replication </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes 离线安装</title>
      <link href="/2019/02/07/k8s/"/>
      <url>/2019/02/07/k8s/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/hosts</span><br><span class="line">192.168.61.11 node1</span><br><span class="line">192.168.61.12 node2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line">setenforce 0</span><br><span class="line">vim /etc/selinux/config</span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line">vim /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br></pre></td></tr></table></figure><h2 id="kube-proxy开启ipvs的前置条件"><a href="#kube-proxy开启ipvs的前置条件" class="headerlink" title="kube-proxy开启ipvs的前置条件"></a>kube-proxy开启ipvs的前置条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否已经正确加载所需的内核模块</span></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br></pre></td></tr></table></figure><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"># Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"># Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line"></span><br><span class="line">yum list docker-ce.x86_64  --showduplicates |sort -r</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">yum install -y --setopt=obsoletes=0 \</span><br><span class="line">  docker-ce-18.06.1.ce-3.el7</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><h2 id="安装kubeadm和kubelet"><a href="#安装kubeadm和kubelet" class="headerlink" title="安装kubeadm和kubelet"></a>安装kubeadm和kubelet</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubelet –help</span><br><span class="line"></span><br><span class="line">cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/kubelet</span><br><span class="line"></span><br><span class="line">KUBELET_EXTRA_ARGS=--fail-swap-on=false</span><br></pre></td></tr></table></figure><h2 id="使用kubeadm-init初始化集群"><a href="#使用kubeadm-init初始化集群" class="headerlink" title="使用kubeadm init初始化集群"></a>使用kubeadm init初始化集群</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">images=(kube-apiserver:v1.13.3 kube-controller-manager:v1.13.3 kube-scheduler:v1.13.3 kube-proxy:v1.13.3 pause:3.1 etcd:3.2.24)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> imageName <span class="keyword">in</span> <span class="variable">$&#123;images[@]&#125;</span> ; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  docker pull mirrorgooglecontainers/<span class="variable">$imageName</span></span><br><span class="line">  docker tag mirrorgooglecontainers/<span class="variable">$imageName</span> k8s.gcr.io/<span class="variable">$imageName</span></span><br><span class="line">  docker rmi mirrorgooglecontainers/<span class="variable">$imageName</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> docker pull coredns/coredns:1.2.6</span><br><span class="line"> docker tag coredns/coredns:1.2.6  k8s.gcr.io/coredns:1.2.6</span><br><span class="line"> docker rmi coredns/coredns:1.2.6</span><br><span class="line"></span><br><span class="line">kubeadm init \</span><br><span class="line">  --kubernetes-version=v1.13.0 \</span><br><span class="line">  --pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">  --apiserver-advertise-address=192.168.41.132 \</span><br><span class="line">  --ignore-preflight-errors=Swap</span><br><span class="line"><span class="comment"># running with swap on is not supported. Please disable swap</span></span><br><span class="line"><span class="comment"># 添加--ignore-preflight-errors=Swap参数忽略这个错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">kubeadm join 192.168.41.132:6443 --token e4xr2p.xvfc3dr6a4dvz8se --discovery-token-ca-cert-hash sha256:7f99258581c9118551ec500b61bf3d732ed6e31799e5074fc5f75b784633410a</span><br><span class="line"></span><br><span class="line">kubectl get cs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 集群初始化如果遇到问题，可以使用下面的命令进行清理</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h2 id="安装Pod-Network"><a href="#安装Pod-Network" class="headerlink" title="安装Pod Network"></a>安装Pod Network</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/k8s/</span><br><span class="line"><span class="built_in">cd</span> ~/k8s</span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line">kubectl apply -f  kube-flannel.yml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> docker </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 组复制</title>
      <link href="/2019/01/30/mgr/"/>
      <url>/2019/01/30/mgr/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-部署组复制实例"><a href="#1-部署组复制实例" class="headerlink" title="1. 部署组复制实例"></a>1. 部署组复制实例</h2><p>假定MySQL Server已下载并解压缩到名为的目录中mysql-8.0。以下过程使用一台物理计算机，因此每个MySQL服务器实例都需要该实例的特定数据目录。在名为的目录中创建数据目录data 并初始化每个目录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br><span class="line">mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s1</span><br><span class="line">mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s2</span><br><span class="line">mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s3</span><br></pre></td></tr></table></figure><p>里面data/s1，data/s2， data/s3是一个初始化的数据目录，包含了MySQL系统数据库和相关表等等</p><blockquote><p>–initialize-insecure在生产环境中使用，它仅用于简化教程。</p></blockquote><h2 id="2-配置组复制实例"><a href="#2-配置组复制实例" class="headerlink" title="2. 配置组复制实例"></a>2. 配置组复制实例</h2><h3 id="组Replication-Server设置"><a href="#组Replication-Server设置" class="headerlink" title="组Replication Server设置"></a>组Replication Server设置</h3><p>要安装和使用组复制插件，必须正确配置MySQL Server实例。建议将配置存储在实例的配置文件中。以下是组中第一个实例的配置，在此过程中称为s1。以下部分显示了示例服务器配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir=&lt;full_path_to_data&gt;/data/s1</span><br><span class="line">basedir=&lt;full_path_to_bin&gt;/mysql-8.0/</span><br><span class="line"></span><br><span class="line">port=24801</span><br><span class="line">socket=&lt;full_path_to_sock_dir&gt;/s1.sock</span><br></pre></td></tr></table></figure><p>这些设置将MySQL服务器配置为使用先前创建的数据目录以及服务器应打开的端口并开始侦听传入连接。</p><blockquote><p>使用非默认端口24801是因为在本教程中，三个服务器实例使用相同的主机名。在具有三台不同机器的设置中，这不是必需的。</p></blockquote><p>组复制需要成员之间的网络连接，这意味着每个成员必须能够解析所有其他成员的网络地址。例如，在本教程中，所有三个实例都在一台机器上运行，因此为了确保成员可以相互联系，您可以在选项文件中添加一行，例如 report_host=127.0.0.1。</p><h3 id="复制框架"><a href="#复制框架" class="headerlink" title="复制框架"></a>复制框架</h3><p>以下设置根据MySQL组复制要求配置复制。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_id=1</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=ON</span><br><span class="line">binlog_checksum=NONE</span><br></pre></td></tr></table></figure><p>这些设置将服务器配置为使用唯一标识符编号1，以启用全局事务标识符，以允许仅执行可使用GTID安全记录的语句，以及禁用写入写入二进制日志的事件的校验和。</p><blockquote><p>如果您使用的是早于8.0.3的MySQL版本，其中默认值已针对复制进行了改进，则需要将这些行添加到成员的选项文件中。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log_bin=binlog</span><br><span class="line">log_slave_updates=ON</span><br><span class="line">binlog_format=ROW</span><br><span class="line">master_info_repository=TABLE</span><br><span class="line">relay_log_info_repository=TABLE</span><br></pre></td></tr></table></figure><p>这些设置指示服务器打开二进制日志记录，使用基于行的格式，将复制元数据存储在系统表而不是文件中，并禁用二进制日志事件校验和。有关更多详细信息，请参见 第18.8.1节“组复制要求”。</p><h3 id="组复制设置"><a href="#组复制设置" class="headerlink" title="组复制设置"></a>组复制设置</h3><p>此时，该my.cnf文件确保配置服务器并指示在给定配置下实例化复制基础结构。以下部分配置服务器的“组复制”设置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">transaction_write_set_extraction=XXHASH64</span><br><span class="line">group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot=off</span><br><span class="line">group_replication_local_address= &quot;127.0.0.1:24901&quot;</span><br><span class="line">group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group=off</span><br></pre></td></tr></table></figure><ul><li>配置 transaction_write_set_extraction 指示服务器对于每个事务，它必须收集写集并使用XXHASH64散列算法将其编码为散列。从MySQL 8.0.2开始，此设置是默认设置，因此可以省略此行。</li><li>配置 group_replication_group_name 告诉插件它正在加入或创建的组被命名为”aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa”，group_replication_group_name的值 必须是有效的UUID。在二进制日志中为组复制事件设置GTID时，将在内部使用此UUID。使用SELECT UUID()生成一个UUID。</li><li>配置 group_replication_start_on_boot 指示插件在服务器启动时不自动启动操作。这在设置组复制时很重要，因为它确保您可以在手动启动插件之前配置服务器。配置成员后，您可以设置 group_replication_start_on_boot 为on，以便在服务器引导时自动启动Group Replication。</li><li>配置 group_replication_local_address 告诉插件使用网络地址127.0.0.1和端口24901与组中的其他成员进行内部通信。</li></ul><blockquote><p>组复制将此地址用于涉及组通信引擎（XCom，Paxos变体）的远程实例的内部成员到成员连接。此地址必须与用于SQL的主机名和端口不同，并且不得用于客户端应用程序。在运行组复制时，必须为组成员之间的内部通信保留它。</p></blockquote><p>配置的网络地址 group_replication_local_address 必须可由所有组成员解析。例如，如果每个服务器实例位于具有固定网络地址的其他计算机上，则可以使用计算机的IP地址，例如10.0.0.1。如果使用主机名，则必须使用完全限定名称，并确保它可以通过DNS解析，并且配置正确 /etc/hosts文件或其他名称解析过程。从MySQL 8.0.14开始，可以使用IPv6地址（或解析它们的主机名）以及IPv4地址。组可以包含使用IPv6的成员和使用IPv4的成员的混合。</p><p>建议的端口 group_replication_local_address 是33061。在本教程中，我们使用在一台计算机上运行的三个服务器实例，因此端口24901到24903用于内部通信网络地址。 group_replication_local_address Group Replication使用它作为复制组中组成员的唯一标识符。只要主机名或IP地址都不同，您就可以为复制组的所有成员使用相同的端口，并且如本教程所示，只要具有相同的主机名或IP地址，就可以使用相同的主机名或IP地址。港口都不一样。</p><ul><li>配置 group_replication_group_seeds 设置组成员的主机名和端口，新成员使用它们建立与组的连接。这些成员称为种子成员。建立连接后，将列出组成员身份信息 performance_schema.replication_group_members。通常， group_replication_group_seeds 列表包含hostname:port每个组成员的列表 group_replication_local_address，但这不是强制性的，可以选择组成员的子集作为种子。</li></ul><blockquote><p>该hostname:port列在 group_replication_group_seeds 是种子构件的内部网络地址，由被配置 group_replication_local_address ，而不是SQL hostname:port用于客户端连接，并且例如在显示 performance_schema.replication_group_members 表中。</p></blockquote><p>启动该组的服务器不使用此选项，因为它是初始服务器，因此，它负责引导组。换句话说，引导该组的服务器上的任何现有数据都是用作下一个加入成员的数据。第二个服务器连接要求组中唯一的成员加入，第二个服务器上的任何缺失数据都从引导成员上的施主数据中复制，然后组扩展。加入的第三个服务器可以要求这两个服务器中的任何一个加入，数据被同步到新成员，然后该组再次扩展。</p><blockquote><p>在同时加入多个服务器时，请确保它们指向已在该组中的种子成员。不要使用也加入该组的成员作为种子，因为他们在联系时可能尚未加入该组。</p></blockquote><p>最好首先启动引导程序成员，然后让它创建组。然后使其成为正在加入的其余成员的种子成员。这确保了在连接其余成员时形成的组。</p><p>不支持创建组并同时加入多个成员。它可能有效，但可能是操作竞争，然后加入该组的行为最终会出错或超时。</p><p>加入成员必须使用种子成员在group_replication_group_seeds 选项中通告的相同协议（IPv4或IPv6）与种子成员通信 。出于组复制的IP地址白名单的目的，种子成员上的白名单必须包含种子成员提供的协议的加入成员的IP地址，或者解析为该协议的地址的主机名。除了加入成员之外，还必须设置此地址或主机名并列入白名单 group_replication_local_address 如果该地址的协议与种子成员的通告协议不匹配。如果加入成员没有适当协议的白名单地址，则拒绝其连接尝试。有关更多信息，请参见 第18.5.1节“IP地址白名单”。</p><ul><li>配置 group_replication_bootstrap_group 指示插件是否引导组。</li></ul><blockquote><p>此选项只能在任何时候在一个服务器实例上使用，通常是第一次引导组时（或者在整个组关闭并重新备份的情况下）。如果多次引导组，例如当多个服务器实例设置了此选项时，则可以创建一个人工分裂脑情景，其中存在两个具有相同名称的不同组。在第一个服务器实例联机后禁用此选项。组中所有服务器的配置非常相似。您需要更改有关每个服务器的细节（例如server_id， datadir， group_replication_local_address）。本教程稍后将对此进行说明。</p></blockquote><h2 id="3-用户凭证"><a href="#3-用户凭证" class="headerlink" title="3. 用户凭证"></a>3. 用户凭证</h2><p>组复制使用异步复制协议来实现 分布式恢复过程依赖于名为的复制通道group_replication_recovery，该通道用于将来自供体成员的事务转移到加入该组的成员。因此，您需要设置具有正确权限的复制用户，以便组复制可以建立直接的成员到成员恢复复制通道。</p><p>使用选项文件启动服务器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0/bin/mysqld --defaults-file=data/s1/s1.cnf</span><br></pre></td></tr></table></figure><p>使用该REPLICATION-SLAVE权限创建MySQL用户 。可以在二进制日志中捕获此过程，然后您可以依靠分布式恢复来复制用于创建用户的语句。或者，您可以禁用二进制日志记录，然后在每个成员上手动创建用户，例如，如果要避免将更改传播到其他服务器实例。要禁用二进制日志记录，请连接到服务器s1并发出以下语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET SQL_LOG_BIN=0;</span><br></pre></td></tr></table></figure><p>在以下示例中rpl_user，将password显示具有密码 的用户 。配置服务器时，请使用合适的用户名和密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;</span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><p>如果禁用了二进制日志记录，则在创建用户后再次启用它。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET SQL_LOG_BIN=1;</span><br></pre></td></tr></table></figure><p>配置用户后，使用该 CHANGE MASTER TO语句将服务器配置为group_replication_recovery在下次需要从另一个成员恢复其状态时使用复制通道的给定凭据 。发出以下，替换 rpl_user和 password与创建用户时使用的值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos; \\</span><br><span class="line">      FOR CHANNEL &apos;group_replication_recovery&apos;;</span><br></pre></td></tr></table></figure><p>分布式恢复是加入组的服务器采取的第一步，并且没有与组成员相同的事务集。如果没有为group_replication_recovery 复制通道正确设置这些凭据，并且rpl_user如图所示，则服务器无法连接到供体成员并运行分布式恢复过程以与其他组成员同步，因此最终无法加入该组。</p><p>同样，如果服务器无法通过服务器正确识别其他成员，hostname则恢复过程可能会失败。建议运行MySQL的操作系统具有正确配置的唯一 hostname，使用DNS或本地设置。这hostname可以Member_host在performance_schema.replication_group_members 表格的列中 进行验证 。如果多个组成员外部化hostname操作系统的默认 设置，则成员可能无法解析为正确的成员地址而无法加入该组。在这种情况下，使用report_host配置hostname由每个服务器外部化的唯一。</p><h3 id="使用组复制和缓存SHA-2用户凭据插件"><a href="#使用组复制和缓存SHA-2用户凭据插件" class="headerlink" title="使用组复制和缓存SHA-2用户凭据插件"></a>使用组复制和缓存SHA-2用户凭据插件</h3><p>默认情况下，在MySQL 8中创建的用户使用 缓存SHA-2可插入身份验证。如果rpl_user您配置分布式恢复使用缓存SHA-2认证插件并没有使用安全套接字层支持（SSL） 的group_replication_recovery 复制通道，RSA密钥用于密码交换，创建SSL和RSA证书和密钥，您可以将rpl_user应该从组中恢复其状态的成员的公钥复制 到该组，也可以将捐赠者配置为在请求时提供公钥。</p><p>更安全的方法是将公钥复制 rpl_user到应该从捐赠者恢复组状态的成员。然后，您需要group_replication_recovery_public_key_path 在加入组的成员上配置 系统变量，并为其提供公钥的路径rpl_user。</p><p>可选地，不太安全的方法是设置 group_replication_recovery_get_public_key=ON 捐赠者，以便他们rpl_user在加入组时提供成员的公钥 。无法验证服务器的身份，因此只有group_replication_recovery_get_public_key=ON 在您确定没有服务器身份被泄露的风险时才会设置 ，例如通过中间人攻击。</p><h2 id="4-启动组复制"><a href="#4-启动组复制" class="headerlink" title="4. 启动组复制"></a>4. 启动组复制</h2><p>配置并启动服务器s1后，安装组复制插件。连接到服务器并发出以下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;;</span><br></pre></td></tr></table></figure><blockquote><p>mysql.session在加载组复制之前，用户必须存在。 MySQL 8.0.2版中添加了mysql.session。如果使用早期版本初始化数据字典，则必须运行 mysql_upgrade过程。如果未运行升级，则组复制无法以错误消息启动尝试使用用户访问服务器时出现错误：mysql.session@localhost。确保用户在服务器中，并且在服务器更新后运行了mysql_upgrade。</p></blockquote><p>要检查插件是否已成功安装，请发出 SHOW PLUGINS;并检查输出。它应该显示如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW PLUGINS;</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br><span class="line">| Name                       | Status   | Type               | Library              | License     |</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br><span class="line">| binlog                     | ACTIVE   | STORAGE ENGINE     | NULL                 | PROPRIETARY |</span><br><span class="line"></span><br><span class="line">(...)</span><br><span class="line"></span><br><span class="line">| group_replication          | ACTIVE   | GROUP REPLICATION  | group_replication.so | PROPRIETARY |</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br></pre></td></tr></table></figure><p>要启动该组，请指示服务器s1引导该组，然后启动组复制。此引导程序应仅由单个服务器完成，该服务器启动组并且只执行一次。这就是为什么bootstrap配置选项的值未保存在配置文件中的原因。如果它保存在配置文件中，则在重新启动时，服务器会自动引导具有相同名称的第二个组。这将导致两个具有相同名称的不同组。同样的推理适用于在此选项设置为的情况下停止并重新启动插件ON。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL group_replication_bootstrap_group=ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SET GLOBAL group_replication_bootstrap_group=OFF;</span><br></pre></td></tr></table></figure><p>一旦START GROUP_REPLICATION 语句返回，该集团已启动。您可以检查该组现在是否已创建，并且其中包含一个成员：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | ce9be252-2b71-11e6-b8f4-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>此表中的信息确认组中有成员具有唯一标识符 ce9be252-2b71-11e6-b8f4-00212844f856，它正在ONLINE并且正在myhost 侦听端口上的客户端连接 24801。</p><p>为了证明服务器确实在一个组中并且它能够处理负载，创建一个表并向其添加一些内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE test;</span><br><span class="line">mysql&gt; USE test;</span><br><span class="line">mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL);</span><br><span class="line">mysql&gt; INSERT INTO t1 VALUES (1, &apos;Luis&apos;);</span><br></pre></td></tr></table></figure><p>检查表的内容t1和二进制日志。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |   4 | Format_desc    |         1 |         123 | Server ver: 8.0.2-gr080-log, Binlog ver: 4                        |</span><br><span class="line">| binlog.000001 | 123 | Previous_gtids |         1 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 | 150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos;  |</span><br><span class="line">| binlog.000001 | 211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 270 | View_change    |         1 |         369 | view_id=14724817264259180:1                                        |</span><br><span class="line">| binlog.000001 | 369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 | 434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos;  |</span><br><span class="line">| binlog.000001 | 495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 | 585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos;  |</span><br><span class="line">| binlog.000001 | 646 | Query          |         1 |         770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 | 770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos;  |</span><br><span class="line">| binlog.000001 | 831 | Query          |         1 |         899 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 899 | Table_map      |         1 |         942 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 | 942 | Write_rows     |         1 |         984 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 | 984 | Xid            |         1 |        1011 | COMMIT /* xid=38 */                                                |</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>如上所示，创建了数据库和表对象，并将相应的DDL语句写入二进制日志。此外，数据已插入表中并写入二进制日志。当组成长并且新成员尝试赶上并联机时执行分布式恢复时，下一节将说明二进制日志条目的重要性。</p><h2 id="5-向组添加实例"><a href="#5-向组添加实例" class="headerlink" title="5. 向组添加实例"></a>5. 向组添加实例</h2><p>此时，该组中有一个成员服务器s1，其中包含一些数据。现在是时候通过添加先前配置的其他两个服务器来扩展组。</p><h3 id="添加第二个实例"><a href="#添加第二个实例" class="headerlink" title="添加第二个实例"></a>添加第二个实例</h3><p>为了添加第二个实例，服务器s2，首先为它创建配置文件。配置类似于用于服务器s1的配置，除了诸如数据目录的位置，s2将要监听的端口或其之外的配置 server_id。这些不同的行在下面的列表中突出显示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir=&lt;full_path_to_data&gt;/data/s2</span><br><span class="line">basedir=&lt;full_path_to_bin&gt;/mysql-8.0/</span><br><span class="line"></span><br><span class="line">port=24802</span><br><span class="line">socket=&lt;full_path_to_sock_dir&gt;/s2.sock</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Replication configuration parameters</span><br><span class="line">#</span><br><span class="line">server_id=2</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=ON</span><br><span class="line">binlog_checksum=NONE</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Group Replication configuration</span><br><span class="line">#</span><br><span class="line">transaction_write_set_extraction=XXHASH64</span><br><span class="line">group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot=off</span><br><span class="line">group_replication_local_address= &quot;127.0.0.1:24902&quot;</span><br><span class="line">group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group= off</span><br></pre></td></tr></table></figure><p>与服务器s1的过程类似，使用选项文件启动服务器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0/bin/mysqld --defaults-file=data/s2/s2.cnf</span><br></pre></td></tr></table></figure><p>然后按如下方式配置恢复凭据。这些命令与设置服务器s1时使用的命令相同，因为用户在组内共享。在s2上发布以下语句。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET SQL_LOG_BIN=0;</span><br><span class="line">CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;</span><br><span class="line">SET SQL_LOG_BIN=1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos; \\</span><br><span class="line">FOR CHANNEL &apos;group_replication_recovery&apos;;</span><br></pre></td></tr></table></figure><blockquote><p>如果您使用的是缓存SHA-2身份验证插件（MySQL 8中的默认设置），请参阅 使用组复制和缓存SHA-2用户凭据插件。</p></blockquote><p>安装组复制插件并开始将服务器加入组的过程。以下示例以与部署服务器s1时相同的方式安装插件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;;</span><br></pre></td></tr></table></figure><p>将服务器s2添加到组中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure><p>与之前的步骤（与s1上执行的步骤相同）不同，此处的区别在于， 在启动组复制之前不会发出SET GLOBAL group_replication_bootstrap_group=ON;，因为该组已由服务器s1创建并引导。此时，只需将服务器s2添加到现有组中。</p><blockquote><p>当组复制成功启动并且服务器加入组时，它会检查 super_read_only变量。通过super_read_only 在成员的配置文件中设置为ON，可以确保因任何原因启动组复制时出现故障的服务器不接受事务。如果服务器应将该组作为读写实例加入，例如作为单主组中的主要组或多主组的成员，则当该 super_read_only变量设置为ON时，则在加入时将其设置为OFF群组。</p></blockquote><p>performance_schema.replication_group_members 再次 检查 表显示该组中现在有两个 ONLINE服务器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">| group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost      |       24802 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>由于服务器s2也标记为ONLINE，它必须已经自动赶上服务器s1。验证它确实已与服务器s1同步，如下所示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES LIKE &apos;test&apos;;</span><br><span class="line">+-----------------+</span><br><span class="line">| Database (test) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test.t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos  | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |    4 | Format_desc    |         2 |         123 | Server ver: 8.0.3-log, Binlog ver: 4                              |</span><br><span class="line">| binlog.000001 |  123 | Previous_gtids |         2 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 |  150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos;  |</span><br><span class="line">| binlog.000001 |  211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  270 | View_change    |         1 |         369 | view_id=14724832985483517:1                                        |</span><br><span class="line">| binlog.000001 |  369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 |  434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos;  |</span><br><span class="line">| binlog.000001 |  495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 |  585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos;  |</span><br><span class="line">| binlog.000001 |  646 | Query          |         1 |         770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 |  770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos;  |</span><br><span class="line">| binlog.000001 |  831 | Query          |         1 |         890 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  890 | Table_map      |         1 |         933 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 |  933 | Write_rows     |         1 |         975 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 |  975 | Xid            |         1 |        1002 | COMMIT /* xid=30 */                                                |</span><br><span class="line">| binlog.000001 | 1002 | Gtid           |         1 |        1063 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&apos;  |</span><br><span class="line">| binlog.000001 | 1063 | Query          |         1 |        1122 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1122 | View_change    |         1 |        1261 | view_id=14724832985483517:2                                        |</span><br><span class="line">| binlog.000001 | 1261 | Query          |         1 |        1326 | COMMIT                                                             |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>如上所示，第二台服务器已添加到组中，并自动从服务器s1复制了更改。根据分布式恢复过程，这意味着在加入组之后并且在被声明在线之前，服务器s2已经自动连接到服务器s1并从中获取丢失的数据。换句话说，它将事务从缺少的s1的二进制日志复制到它加入组的时间点。</p><h3 id="添加其他实例"><a href="#添加其他实例" class="headerlink" title="添加其他实例"></a>添加其他实例</h3><p>向组添加其他实例与添加第二个服务器的步骤顺序基本相同，只是必须更改配置，因为必须更改服务器s2。总结所需的命令：</p><ol><li>创建配置文件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir=&lt;full_path_to_data&gt;/data/s3</span><br><span class="line">basedir=&lt;full_path_to_bin&gt;/mysql-8.0/</span><br><span class="line"></span><br><span class="line">port=24803</span><br><span class="line">socket=&lt;full_path_to_sock_dir&gt;/s3.sock</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Replication configuration parameters</span><br><span class="line">#</span><br><span class="line">server_id=3</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=ON</span><br><span class="line">binlog_checksum=NONE</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Group Replication configuration</span><br><span class="line">#</span><br><span class="line">group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot=off</span><br><span class="line">group_replication_local_address= &quot;127.0.0.1:24903&quot;</span><br><span class="line">group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group= off</span><br></pre></td></tr></table></figure><ol start="2"><li>启动服务器</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0/bin/mysqld --defaults-file=data/s3/s3.cnf</span><br></pre></td></tr></table></figure><ol start="3"><li>配置group_replication_recovery通道的恢复凭据。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SET SQL_LOG_BIN=0;</span><br><span class="line">CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN=1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos;  \\</span><br><span class="line">FOR CHANNEL &apos;group_replication_recovery&apos;;</span><br></pre></td></tr></table></figure><ol start="4"><li>安装Group Replication插件并启动它。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;;</span><br><span class="line">START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure><p>此时，服务器s3已启动并正在运行，已加入该组并赶上该组中的其他服务器。performance_schema.replication_group_members 再次咨询 表证实了这种情况。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">| group_replication_applier | 7eb217ff-6df3-11e6-966c-00212844f856 | myhost      |       24803 | ONLINE        |</span><br><span class="line">| group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost      |       24802 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>在服务器s2或服务器s1上发出相同的查询会产生相同的结果。此外，您可以验证服务器s3是否也赶上了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES LIKE &apos;test&apos;;</span><br><span class="line">+-----------------+</span><br><span class="line">| Database (test) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test.t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos  | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |    4 | Format_desc    |         3 |         123 | Server ver: 8.0.3-log, Binlog ver: 4                              |</span><br><span class="line">| binlog.000001 |  123 | Previous_gtids |         3 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 |  150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos;  |</span><br><span class="line">| binlog.000001 |  211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  270 | View_change    |         1 |         369 | view_id=14724832985483517:1                                        |</span><br><span class="line">| binlog.000001 |  369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 |  434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos;  |</span><br><span class="line">| binlog.000001 |  495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 |  585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos;  |</span><br><span class="line">| binlog.000001 |  646 | Query          |         1 |         770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 |  770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos;  |</span><br><span class="line">| binlog.000001 |  831 | Query          |         1 |         890 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  890 | Table_map      |         1 |         933 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 |  933 | Write_rows     |         1 |         975 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 |  975 | Xid            |         1 |        1002 | COMMIT /* xid=29 */                                                |</span><br><span class="line">| binlog.000001 | 1002 | Gtid           |         1 |        1063 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&apos;  |</span><br><span class="line">| binlog.000001 | 1063 | Query          |         1 |        1122 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1122 | View_change    |         1 |        1261 | view_id=14724832985483517:2                                        |</span><br><span class="line">| binlog.000001 | 1261 | Query          |         1 |        1326 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 | 1326 | Gtid           |         1 |        1387 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:6&apos;  |</span><br><span class="line">| binlog.000001 | 1387 | Query          |         1 |        1446 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1446 | View_change    |         1 |        1585 | view_id=14724832985483517:3                                        |</span><br><span class="line">| binlog.000001 | 1585 | Query          |         1 |        1650 | COMMIT                                                             |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> mysql </tag>
            
            <tag> mgr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Powerline 美化终端</title>
      <link href="/2019/01/29/powerline/"/>
      <url>/2019/01/29/powerline/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="安装-python3"><a href="#安装-python3" class="headerlink" title="安装 python3"></a>安装 python3</h2><p>Ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># sudo apt install python3 python3-pip</span></span><br></pre></td></tr></table></figure><h2 id="安装-powerline"><a href="#安装-powerline" class="headerlink" title="安装 powerline"></a>安装 powerline</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# python3 -m pip install powerline-status</span><br><span class="line">[root@ubuntu ~]# python3 -m pip show powerline-status</span><br><span class="line">Name: powerline-status</span><br><span class="line">Version: 2.7</span><br><span class="line">Summary: The ultimate statusline/prompt utility.</span><br><span class="line">Home-page: https://github.com/powerline/powerline</span><br><span class="line">Author: Kim Silkebaekken</span><br><span class="line">Author-email: kim.silkebaekken+vim@gmail.com</span><br><span class="line">License: MIT</span><br><span class="line">Location: /usr/local/lib/python3.6/dist-packages</span><br><span class="line">Requires:</span><br></pre></td></tr></table></figure><h2 id="设置-bash"><a href="#设置-bash" class="headerlink" title="设置 bash"></a>设置 bash</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powerline-daemon -q</span><br><span class="line">POWERLINE_BASH_CONTINUATION=1</span><br><span class="line">POWERLINE_BASH_SELECT=1</span><br><span class="line">. /usr/local/lib/python3.6/dist-packages/powerline/bindings/bash/powerline.sh</span><br></pre></td></tr></table></figure><ul><li>效果图</li></ul><h2 id="设置-vim"><a href="#设置-vim" class="headerlink" title="设置 vim"></a>设置 vim</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># vim ~/.vimrc</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set rtp+=/usr/local/lib/python3.6/dist-packages/powerline/bindings/vim/</span><br><span class="line">set laststatus=2</span><br><span class="line">set t_Co=256</span><br></pre></td></tr></table></figure><ul><li>效果图</li></ul>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> powerline </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 常用函数</title>
      <link href="/2019/01/15/mysql_function/"/>
      <url>/2019/01/15/mysql_function/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>left( )</td><td>返回串左边的字符</td></tr><tr><td>right( )</td><td>返回串右边的字符</td></tr><tr><td>length( )</td><td>返回串的长度</td></tr><tr><td>locate( )</td><td>找出串的一个子串</td></tr><tr><td>lower( )</td><td>将串转换为小写</td></tr><tr><td>upper( )</td><td>将串转换为大写</td></tr><tr><td>ltrim( )</td><td>去掉串左边的空格</td></tr><tr><td>rtrim( )</td><td>去掉串右边的空格</td></tr><tr><td>soundex( )</td><td>返回串的SOUNDEX值</td></tr><tr><td>substring( )</td><td>返回子串的字符</td></tr><tr><td>## 日期和时间处理函数</td><td></td></tr></tbody></table><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>adddate( )</td><td>增加一个日期（天、周等）</td></tr><tr><td>addtime( )</td><td>增加一个时间（时、分等）</td></tr><tr><td>curdate( )</td><td>返回当前日期</td></tr><tr><td>curtime( )</td><td>返回当前时间</td></tr><tr><td>date( )</td><td>返回日期时间的日期部分</td></tr><tr><td>datediff( )</td><td>计算两个日期之差</td></tr><tr><td>date_add( )</td><td>高度灵活的日期运算函数</td></tr><tr><td>date_format( )</td><td>返回一个格式化的日期或时间串</td></tr><tr><td>day( )</td><td>返回一个日期的天数部分</td></tr><tr><td>dayofweek( )</td><td>对于一个日期，返回对应的星期几</td></tr><tr><td>hour( )</td><td>返回一个时间的小时部分</td></tr><tr><td>minute( )</td><td>返回一个时间的分钟部分</td></tr><tr><td>month( )</td><td>返回一个日期的月份部分</td></tr><tr><td>now( )</td><td>返回当前日期和时间</td></tr><tr><td>second( )</td><td>返回一个时间的秒部分</td></tr><tr><td>time( )</td><td>返回一个日期时间的时间部分</td></tr><tr><td>year( )</td><td>返回一个日期的年份部分</td></tr></tbody></table><h2 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>abs( )</td><td>返回一个数的绝对值</td></tr><tr><td>cos( )</td><td>返回一个角度的余弦</td></tr><tr><td>exp( )</td><td>返回一个数的指数值</td></tr><tr><td>mod( )</td><td>返回除操作的余数</td></tr><tr><td>pi( )</td><td>返回圆周率</td></tr><tr><td>rand( )</td><td>返回一个随机数</td></tr><tr><td>sin( )</td><td>返回一个角度的正弦</td></tr><tr><td>sqrt( )</td><td>返回一个数的平方根</td></tr><tr><td>tan( )</td><td>返回一个角度的正切</td></tr></tbody></table><h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>avg( )</td><td>返回某列的平均值</td></tr><tr><td>count( )</td><td>返回某列的行数</td></tr><tr><td>max( )</td><td>返回某列的最大值</td></tr><tr><td>min( )</td><td>返回某列的最小值</td></tr><tr><td>sum( )</td><td>返回某列值之和</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uWSGI 部署 Django 应用</title>
      <link href="/2019/01/07/uwsgi/"/>
      <url>/2019/01/07/uwsgi/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><ul><li>demo项目的目录结构</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">demo/</span><br><span class="line">├── db.sqlite3</span><br><span class="line">├── demo</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── __pycache__</span><br><span class="line">│   │   ├── __init__.cpython-36.pyc</span><br><span class="line">│   │   ├── settings.cpython-36.pyc</span><br><span class="line">│   │   ├── urls.cpython-36.pyc</span><br><span class="line">│   │   └── wsgi.cpython-36.pyc</span><br><span class="line">│   ├── settings.py</span><br><span class="line">│   ├── urls.py</span><br><span class="line">│   └── wsgi.py</span><br><span class="line">├── manage.py</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure><h2 id="安装相关工具和依赖"><a href="#安装相关工具和依赖" class="headerlink" title="安装相关工具和依赖"></a>安装相关工具和依赖</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install git wget httpd vim # 安装相关工具</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install gcc zlib* openssl-devel # 安装编译工具和依赖库</span></span><br></pre></td></tr></table></figure><h2 id="安装-Python-环境"><a href="#安装-Python-环境" class="headerlink" title="安装 Python 环境"></a>安装 Python 环境</h2><p>rhel系列无法通过yum直接安装python3，需要源码编译安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># pwd # 查看当前目录</span></span><br><span class="line">/root</span><br><span class="line">[root@uwsgi ~]<span class="comment"># wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz # 下载python3.6.5</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># tar -zxvf Python-3.6.5.tgz # 解压</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># cd Python-3.6.5</span></span><br><span class="line"></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># pwd # 查看当前目录</span></span><br><span class="line">/root/Python-3.6.5</span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># ./configure # 编译</span></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># make &amp;&amp; make install # 安装</span></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># which python3 # 查看python3的路径</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/python3</span><br></pre></td></tr></table></figure><h2 id="安装-uWSGI"><a href="#安装-uWSGI" class="headerlink" title="安装 uWSGI"></a>安装 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># python3 -m pip install uwsgi</span></span><br></pre></td></tr></table></figure><h2 id="安装配置虚拟环境"><a href="#安装配置虚拟环境" class="headerlink" title="安装配置虚拟环境"></a>安装配置虚拟环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># python3 -m pip install virtualenv # 安装虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># virtualenv -p /usr/local/bin/python3 /venv # 配置虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># source /venv/bin/activate # 激活虚拟环境</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># pip install -r /root/demo/requirements.txt # 安装项目依赖</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># pip freeze # 查看依赖库是否安装</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># deactivate # 取消激活虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="修改-ALLOW-HOSTS"><a href="#修改-ALLOW-HOSTS" class="headerlink" title="修改 ALLOW_HOSTS"></a>修改 ALLOW_HOSTS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># vim demo/demo/settings.py # 编辑项目中的 settings.py</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALLOWED_HOSTS = [<span class="string">"192.168.41.130"</span>,]</span><br></pre></td></tr></table></figure><h2 id="配置-uWSGI"><a href="#配置-uWSGI" class="headerlink" title="配置 uWSGI"></a>配置 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># mkdir -p /var/log/uwsgi # 创建 uwsgi 的日志目录</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># vim /etc/uwsgi.ini # 创建 uwsgi.ini 配置文件</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">chdir=/root/demo</span><br><span class="line">http=192.168.41.130:8000</span><br><span class="line">home=/venv</span><br><span class="line">module=demo.wsgi:application</span><br><span class="line">master=True</span><br><span class="line">pidfile=/tmp/demo.pid</span><br><span class="line">max-requests=5000</span><br><span class="line">daemonize=/var/log/uwsgi/demo.log</span><br><span class="line">env=LANG=en_US.UTF-8</span><br><span class="line">buffer-size=32768</span><br></pre></td></tr></table></figure><h2 id="启动-uWSGI"><a href="#启动-uWSGI" class="headerlink" title="启动 uWSGI"></a>启动 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># uwsgi --init /etc/uwsgi.ini # 以 /etc/uwsgi.ini 配置启动 uwsgi</span></span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><table><thead><tr><th>路径</th><th>说明</th></tr></thead><tbody><tr><td>/root/demo</td><td>项目路径</td></tr><tr><td>/usr/local/bin/python3</td><td>python3默认安装路径</td></tr><tr><td>/etc/uwsgi.ini</td><td>uwsgi配置文件</td></tr><tr><td>/var/log/uwsgi/demo.log</td><td>uwsgi日志文件</td></tr><tr><td>/venv</td><td>python虚拟环境路径</td></tr></tbody></table><p>未安装zlib*：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zipimport.ZipImportError: can&apos;t decompress data; zlib not available # 编译时报错</span><br></pre></td></tr></table></figure><p>未安装openssl、openssl-devel：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available # pip 安装 uwsgi 时报错</span><br></pre></td></tr></table></figure><p>uwsgi 无法访问，日志报错：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalid request block size: 21573 (max 4096)...skip # 在 /etc/uwsgi.ini 中添加 buffer-size=32768</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 oh-my-posh 美化 PowerShell</title>
      <link href="/2019/01/05/oh-my-posh/"/>
      <url>/2019/01/05/oh-my-posh/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>英文字体是支持PowerLine的DejaVuSansMono字体，中文字体是文泉驿等宽微米黑字体），并将终端字体设置为支持PowerLine的字体。<br>然后开始安装oh-my-posh（该步骤可能需要某种“较为稳定”的网络环境）。在管理员权限的PowerShell下执行指令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass</span><br></pre></td></tr></table></figure><p>该指令旨在允许加载并运行任意脚本。可能会造成安全问题，但是只要有杀毒软件在就无需担心，毕竟没有人会无聊到对一个普通的计算机用户进行针对性攻击。</p><p>然后安装oh-my-posh的依赖和oh-my-posh本身</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> posh-git -Scope CurrentUser</span><br><span class="line"><span class="built_in">Install-Module</span> oh-my-posh -Scope CurrentUser</span><br></pre></td></tr></table></figure><p>安装完成之后，可以通过</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> oh-my-posh</span><br></pre></td></tr></table></figure><p>来尝试启用这个模组。之后就可以使用</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Theme主题名</span><br></pre></td></tr></table></figure><p>这种格式的指令来切换不同的显示风格。示例图中的主题是基于Agnoster改造的，默认主题文件位于</p><p>IT之家学院：使用oh-my-posh美化Win10 PowerShell</p><p>接下来便是在PowerShell启动时加载这个模组了。类似于Linux Bash的.bashrc，PowerShell也提供类似的Profile文件用于在启动时执行指令。输入</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Test-Path</span> <span class="variable">$profile</span></span><br></pre></td></tr></table></figure><p>并执行，以确定profile文件是否存在。如果返回False，则应该执行：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-Item</span> -path <span class="variable">$profile</span> -type file–force</span><br></pre></td></tr></table></figure><p>来新建一个文件。然后去往Profile的目录（通常是你的文档下的WindowsPowerShell目录下），修改那个后缀为ps1的Profile文件，加入一行Import-Module oh-my-posh即可。</p><p>一切完成之后，PowerShell应该比原先美观了不少，而且提示符的功能更强了。基于oh-my-posh框架，还能自己编写更多的主题。</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> powershell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jenkins 入门指南</title>
      <link href="/2019/01/04/jenkins/"/>
      <url>/2019/01/04/jenkins/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>sudo wget -O /etc/yum.repos.d/jenkins.repo <a href="https://pkg.jenkins.io/redhat-stable/jenkins.repo" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/jenkins.repo</a><br>sudo rpm –import <a href="https://pkg.jenkins.io/redhat-stable/jenkins.io.key" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/jenkins.io.key</a></p><p>yum install jenkins</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> jenkins </tag>
            
            <tag> ci </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlab-ce 入坑指南</title>
      <link href="/2019/01/03/gitlab/"/>
      <url>/2019/01/03/gitlab/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="更新软件包"><a href="#更新软件包" class="headerlink" title="更新软件包"></a>更新软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br></pre></td></tr></table></figure><h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><ul><li>启用并启动防火墙</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl enable firewalld</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># systemctl start firewalld</span></span><br></pre></td></tr></table></figure><ul><li>放通 HTTP、HTTPS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --add-service=http --permanent</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --add-service=https --permanent</span></span><br></pre></td></tr></table></figure><ul><li>重载入防火墙</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl reload firewalld</span></span><br></pre></td></tr></table></figure><h2 id="安装-postfix"><a href="#安装-postfix" class="headerlink" title="安装 postfix"></a>安装 postfix</h2><p>GitLab 需要使用 postfix 来发送邮件。当然，也可以使用 SMTP 服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/postfix/main.cf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inet_protocols = all</span><br><span class="line">inet_protocols = ipv4</span><br></pre></td></tr></table></figure><ul><li>启用并启动 postfix</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl restart postfix</span></span><br></pre></td></tr></table></figure><h2 id="配置-swap"><a href="#配置-swap" class="headerlink" title="配置 swap"></a>配置 swap</h2><p>由于 GitLab 较为消耗资源，我们需要先创建交换分区，以降低物理内存的压力。<br>在实际生产环境中，如果服务器配置够高，则不必配置交换分区。</p><ul><li>新建 2 GB 大小的交换分区</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># dd if=/dev/zero of=/root/swapfile bs=1M count=2048</span></span><br></pre></td></tr></table></figure><ul><li>格式化为交换分区文件并启用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># mkswap /root/swapfile</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># swapon /root/swapfile</span></span><br></pre></td></tr></table></figure><ul><li>添加自启用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/fstab</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure><h2 id="安装-GitLab"><a href="#安装-GitLab" class="headerlink" title="安装 GitLab"></a>安装 GitLab</h2><ul><li>将软件源修改为国内源</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/yum.repos.d/gitlab-ce.repo</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><ul><li>安装 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># yum makecache</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># yum install -y gitlab-ce</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">     *.                  *.</span><br><span class="line">    ***                 ***</span><br><span class="line">   *****               *****</span><br><span class="line">  .******             *******</span><br><span class="line">  ********            ********</span><br><span class="line"> ,,,,,,,,,***********,,,,,,,,,</span><br><span class="line">,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="line">.,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="line">    ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="line">       ,,,,,,,****,,,,,,</span><br><span class="line">          .,,,***,,,,</span><br><span class="line">              ,*,.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   _______ __  __          __</span><br><span class="line">  / ____(_) /_/ /   ____ _/ /_</span><br><span class="line"> / / __/ / __/ /   / __ `/ __ \</span><br><span class="line">/ /_/ / / /_/ /___/ /_/ / /_/ /</span><br><span class="line">\____/_/\__/_____/\__,_/_.___/</span><br><span class="line"></span><br><span class="line">Thank you for installing GitLab!</span><br></pre></td></tr></table></figure><h2 id="配置-HTTPS-证书"><a href="#配置-HTTPS-证书" class="headerlink" title="配置 HTTPS 证书"></a>配置 HTTPS 证书</h2><ul><li>生成 key 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># openssl genrsa -out "/etc/gitlab/ssl/gitlab.example.com.key"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................................+++</span><br><span class="line">..............................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br></pre></td></tr></table></figure><ul><li>生成 csr 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ssl]<span class="comment"># openssl req -new -key "/etc/gitlab/ssl/gitlab.example.com.key" -out "/etc/gitlab/ssl/gitlab.example.com.csr"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:cn</span><br><span class="line">State or Province Name (full name) []:sz</span><br><span class="line">Locality Name (eg, city) [Default City]:sz</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:example</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:gitlab.example.com</span><br><span class="line">Email Address []:admin@example.com</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:password</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure><ul><li>生成 crt 文件 </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># openssl x509 -req -days 365 -in "/etc/gitlab/ssl/gitlab.example.com.csr" -signkey "/etc/gitlab/ssl/gitlab.example.com.key" -out "/etc/gitlab/ssl/gitlab.example.com.crt"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Signature ok</span><br><span class="line">subject=/C=cn/ST=sz/L=sz/O=example/CN=gitlab.example.com/emailAddress=admin@example.com</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure><ul><li>生成 dhparams.pem</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ssl]<span class="comment"># openssl dhparam -out /etc/gitlab/ssl/dhparams.pem 2048</span></span><br></pre></td></tr></table></figure><h2 id="初始化-GitLab"><a href="#初始化-GitLab" class="headerlink" title="初始化 GitLab"></a>初始化 GitLab</h2><ul><li>配置 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">external_url &apos;http://gitlab.example.com&apos;</span><br><span class="line">nginx[&apos;redirect_http_to_https&apos;] = true</span><br><span class="line">nginx[&apos;ssl_certificate&apos;] = &quot;/etc/gitlab/ssl/gitlab.example.com.crt&quot;</span><br><span class="line">nginx[&apos;ssl_certificate_key&apos;] = &quot;/etc/gitlab/ssl/gitlab.example.com.key&quot;</span><br><span class="line">nginx[&apos;ssl_dhparam&apos;] = &quot;/etc/gitlab/ssl/dhparams.pem&quot;</span><br></pre></td></tr></table></figure><ul><li>初始化 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure><ul><li>修改 nginx 配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /var/opt/gitlab/nginx/conf/gitlab-http.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen *:80;</span><br><span class="line"></span><br><span class="line">  rewrite ^(.*)$ https://$host$1 permanent; # 新增</span><br><span class="line"></span><br><span class="line">  server_name gitlab.example.com;</span><br><span class="line">  server_tokens off; ## Don&apos;t show the nginx version number, a security best practice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    return 301 https://gitlab.example.com:443$request_uri;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  access_log  /var/log/gitlab/nginx/gitlab_access.log gitlab_access;</span><br><span class="line">  error_log   /var/log/gitlab/nginx/gitlab_error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>重启 gitlab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl restart</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Ambari 部署 Hadoop 集群</title>
      <link href="/2018/12/18/ambari/"/>
      <url>/2018/12/18/ambari/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><h3 id="安装httpd"><a href="#安装httpd" class="headerlink" title="安装httpd"></a>安装httpd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd -y</span><br></pre></td></tr></table></figure><h3 id="在官方下载镜像文件"><a href="#在官方下载镜像文件" class="headerlink" title="在官方下载镜像文件"></a>在官方下载镜像文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari.repo</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/hdp.repo</span><br><span class="line">wget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari-2.6.1.0-centos7.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/centos7/HDP-UTILS-1.1.0.22-centos7.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-GPL/centos7/2.x/updates/2.6.4.0/HDP-GPL-2.6.4.0-centos7-rpm.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/HDP-2.6.4.0-centos7-rpm.tar.gz</span><br></pre></td></tr></table></figure><h3 id="将对应的tar包解压到httpd的文件目录"><a href="#将对应的tar包解压到httpd的文件目录" class="headerlink" title="将对应的tar包解压到httpd的文件目录"></a>将对应的tar包解压到httpd的文件目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">tar -zxvf ambari-2.6.1.0-centos7.tar.gz</span><br><span class="line">tar -zxvf HDP-2.6.4.0-centos7-rpm.tar.gz </span><br><span class="line">tar -zxvf HDP-GPL-2.6.4.0-centos7-rpm.tar.gz </span><br><span class="line">tar -zxvf HDP-UTILS-1.1.0.22-centos7.tar.gz</span><br></pre></td></tr></table></figure><h3 id="配置基础源，创建hadoop的repo文件"><a href="#配置基础源，创建hadoop的repo文件" class="headerlink" title="配置基础源，创建hadoop的repo文件"></a>配置基础源，创建hadoop的repo文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ambari 源</span></span><br><span class="line">vim /etc/yum.repo.d/ambari.repo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ambari-2.6.1.0]</span><br><span class="line">name=ambari Version - ambari-2.6.1.0</span><br><span class="line">baseurl=http://192.168.10.11/ambari/centos7/2.6.1.0-143</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://192.168.10.11/ambari/centos7/2.6.1.0-143/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled=1</span><br><span class="line">priority=1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hadoop源</span></span><br><span class="line">vim /etc/yum.repo.d/hdp.repo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#VERSION_NUMBER=2.6.4.0-91</span><br><span class="line">[HDP-2.6.4.0]</span><br><span class="line">name=HDP Version - HDP-2.6.4.0</span><br><span class="line">baseurl=http://192.168.10.11/HDP/centos7/2.6.4.0-91</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://192.168.10.11/HDP/centos7/2.6.4.0-91/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled=1</span><br><span class="line">priority=1</span><br><span class="line"></span><br><span class="line">[HDP-UTILS-1.1.0.22]</span><br><span class="line">name=HDP-UTILS Version - HDP-UTILS-1.1.0.22</span><br><span class="line">baseurl=http://192.168.10.11/HDP-UTILS/centos7/1.1.0.22/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://192.168.10.11/HDP-UTILS/centos7/1.1.0.22/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled=1</span><br><span class="line">priority=1</span><br><span class="line"></span><br><span class="line">[HDP-GPL-2.6.4.0]</span><br><span class="line">name=HDP-GPL Version - HDP-GPL-2.6.4.0</span><br><span class="line">baseurl=http://192.168.10.11/HDP-GPL/centos7/2.6.4.0-91</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://192.168.10.11/HDP-GPL/centos7/2.6.4.0-91/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled=1</span><br><span class="line">priority=1</span><br></pre></td></tr></table></figure><h3 id="启动httpd"><a href="#启动httpd" class="headerlink" title="启动httpd"></a>启动httpd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd</span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure><h3 id="将本地源的repo配置拷贝到其它节点，并创建缓存"><a href="#将本地源的repo配置拷贝到其它节点，并创建缓存" class="headerlink" title="将本地源的repo配置拷贝到其它节点，并创建缓存"></a>将本地源的repo配置拷贝到其它节点，并创建缓存</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/yum.repos.d/ambari.repo 192.168.135.4:/etc/yum.repos.d/</span><br><span class="line">scp /etc/yum.repos.d/ambari.repo 192.168.135.5:/etc/yum.repos.d/</span><br><span class="line">scp /etc/yum.repos.d/hdp.repo 192.168.135.6:/etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>在各个节点创建缓存：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><h2 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h2><h3 id="各个节点安装java-1-8-0-openjdk"><a href="#各个节点安装java-1-8-0-openjdk" class="headerlink" title="各个节点安装java-1.8.0-openjdk"></a>各个节点安装java-1.8.0-openjdk</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk -y</span><br></pre></td></tr></table></figure><h3 id="解析主机名"><a href="#解析主机名" class="headerlink" title="解析主机名"></a>解析主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo "192.168.135.4 node2" &gt;&gt; /etc/hosts</span><br><span class="line">echo "192.168.135.5 node3" &gt;&gt; /etc/hosts</span><br><span class="line">echo "192.168.135.6 node4" &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="创建主机信任关系"><a href="#创建主机信任关系" class="headerlink" title="创建主机信任关系"></a>创建主机信任关系</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id node-1</span><br><span class="line">ssh-copy-id node-2</span><br><span class="line">ssh-copy-id node-3</span><br></pre></td></tr></table></figure><h3 id="安装配置数据库"><a href="#安装配置数据库" class="headerlink" title="安装配置数据库"></a>安装配置数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb-server -y</span><br><span class="line">systemctl enable mariadb</span><br><span class="line">systemctl start mariadb</span><br></pre></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span>=<span class="keyword">password</span>(<span class="string">'123456'</span>);</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> ambari <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> ambari.* <span class="keyword">to</span> ambari@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'bigdata'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> ambari.* <span class="keyword">to</span> ambari@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'bigdata'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> hive <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> hive.* <span class="keyword">to</span> hive@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'hive'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> hive.* <span class="keyword">to</span> hive@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'hive'</span>;</span><br></pre></td></tr></table></figure><h2 id="安装Amabri服务"><a href="#安装Amabri服务" class="headerlink" title="安装Amabri服务"></a>安装Amabri服务</h2><h3 id="在node-1上安装ambari-server-并启动配置向导"><a href="#在node-1上安装ambari-server-并启动配置向导" class="headerlink" title="在node-1上安装ambari-server,并启动配置向导"></a>在node-1上安装ambari-server,并启动配置向导</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ambari-server -y</span><br><span class="line">ambari-server setup</span><br></pre></td></tr></table></figure><h3 id="按照配置向导信息、配置用户、java-home"><a href="#按照配置向导信息、配置用户、java-home" class="headerlink" title="按照配置向导信息、配置用户、java_home"></a>按照配置向导信息、配置用户、java_home</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ambari-server setup</span><br><span class="line">Using python  /usr/bin/python</span><br><span class="line">Setup ambari-server</span><br><span class="line">Checking SELinux...</span><br><span class="line">SELinux status is 'disabled'</span><br><span class="line">Customize user account for ambari-server daemon [y/n] (n)? y</span><br><span class="line">Enter user account for ambari-server daemon (root):ambari  </span><br><span class="line">Adjusting ambari-server permissions and ownership...</span><br><span class="line">Checking firewall status...</span><br><span class="line">Checking JDK...</span><br><span class="line">[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8</span><br><span class="line">[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7</span><br><span class="line">[3] Custom JDK</span><br><span class="line">==============================================================================</span><br><span class="line">Enter choice (1): 3</span><br><span class="line">WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.</span><br><span class="line">WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.</span><br><span class="line">Path to JAVA_HOME: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre  # 填写java_home</span><br><span class="line">Validating JDK on Ambari Server...done.</span><br><span class="line">Checking GPL software agreement...</span><br><span class="line">GPL License for LZO: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html</span><br><span class="line">Enable Ambari Server to download and install GPL Licensed LZO packages [y/n] (n)? n</span><br><span class="line">Completing setup...</span><br><span class="line">Configuring database...</span><br><span class="line">Enter advanced database configuration [y/n] (n)? y  </span><br><span class="line">Configuring database...</span><br><span class="line">==============================================================================</span><br><span class="line">Choose one of the following options:</span><br><span class="line">[1] - PostgreSQL (Embedded)</span><br><span class="line">[2] - Oracle</span><br><span class="line">[3] - MySQL / MariaDB</span><br><span class="line">[4] - PostgreSQL</span><br><span class="line">[5] - Microsoft SQL Server (Tech Preview)</span><br><span class="line">[6] - SQL Anywhere</span><br><span class="line">[7] - BDB</span><br><span class="line">==============================================================================</span><br><span class="line">Enter choice (1): 3</span><br><span class="line">Hostname (localhost): </span><br><span class="line">Port (3306): </span><br><span class="line">Database name (ambari): </span><br><span class="line">Username (ambari): </span><br><span class="line">Enter Database Password (bigdata): </span><br><span class="line">Configuring ambari database...</span><br><span class="line">WARNING: Before starting Ambari Server, you must copy the MySQL JDBC driver JAR file to /usr/share/java and set property "server.jdbc.driver.path=[path/to/custom_jdbc_driver]" in ambari.properties.</span><br><span class="line">Press &lt;enter&gt; to continue.</span><br></pre></td></tr></table></figure><h3 id="到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置："><a href="#到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置：" class="headerlink" title="到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置："></a>到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/java</span><br><span class="line">ll</span><br><span class="line">tar xf mysql-connector-java-5.1.45.tar.gz </span><br><span class="line">mv mysql-connector-java-5.1.45/mysql-connector-java-5.1.45-bin.jar ./</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件：</span></span><br><span class="line">vim /etc/ambari-server/conf/ambari.properties</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.jdbc.driver.path=/usr/share/java/mysql-connector-java-5.1.45-bin.jar</span><br></pre></td></tr></table></figure><p>配置完成后继续，会出现如下提示：</p><p>Press <enter> to continue.<br>Configuring remote database connection properties…<br>WARNING: Before starting Ambari Server, you must run the following DDL against the database to create the schema: /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql<br>Proceed with configuring remote database connection properties [y/n] (y)? </enter></p><h3 id="出现上述提示时，根据信息导入数据库"><a href="#出现上述提示时，根据信息导入数据库" class="headerlink" title="出现上述提示时，根据信息导入数据库"></a>出现上述提示时，根据信息导入数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p ambari &lt; /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql</span><br></pre></td></tr></table></figure><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ambari-server start</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ambari </tag>
            
            <tag> hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible 自动化运维实战</title>
      <link href="/2018/12/17/ansible/"/>
      <url>/2018/12/17/ansible/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="Ad-Hoc命令简介"><a href="#Ad-Hoc命令简介" class="headerlink" title="Ad-Hoc命令简介"></a>Ad-Hoc命令简介</h2><h3 id="并行和Shell命令"><a href="#并行和Shell命令" class="headerlink" title="并行和Shell命令"></a>并行和Shell命令</h3><p>让我们使用Ansible的命令行工具重启atlanta的所有Web服务器，一次10个。首先，让我们设置SSH代理，以便它能记住我们的凭据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-agent bash</span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>playbook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ansible </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch Linux 入坑指南</title>
      <link href="/2018/12/16/archlinux_install/"/>
      <url>/2018/12/16/archlinux_install/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h2><h3 id="连接网络"><a href="#连接网络" class="headerlink" title="连接网络"></a>连接网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wifi-menu</span><br></pre></td></tr></table></figure><h3 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line">fdisk /dev/sda</span><br><span class="line"><span class="comment"># 1. 先将硬盘格式转换为 GPT</span></span><br><span class="line"><span class="comment"># 2. 创建 sda1 EFI 分区 200M</span></span><br><span class="line"><span class="comment"># 3. 创建 ada2 boot 分区 1G</span></span><br><span class="line"><span class="comment"># 4. 剩下的 sda3 Linux LVM 分区</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化三个分区</span></span><br><span class="line">mkfs.vfat -F32 /dev/sda1</span><br><span class="line">mkfs.ext4 /dev/sda2</span><br><span class="line">mkfs.xfs /dev/sda3</span><br></pre></td></tr></table></figure><h3 id="查看硬盘的分区情况"><a href="#查看硬盘的分区情况" class="headerlink" title="查看硬盘的分区情况"></a>查看硬盘的分区情况</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk -l</span><br></pre></td></tr></table></figure><h3 id="创建并挂载目录"><a href="#创建并挂载目录" class="headerlink" title="创建并挂载目录"></a>创建并挂载目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一定要先挂载 /mnt</span></span><br><span class="line">mount /dev/sda3 /mnt</span><br><span class="line"><span class="comment"># 创建 boot 文件夹并挂载</span></span><br><span class="line">mkdir /mnt/boot</span><br><span class="line">mount /dev/sda2 /mnt/boot</span><br><span class="line"><span class="comment"># 创建 efi 文件夹并挂载</span></span><br><span class="line">mkdir /mnt/boot/efi</span><br><span class="line">mount /dev/sda1 /mnt/boot/efi</span><br></pre></td></tr></table></figure><h3 id="安装基本系统"><a href="#安装基本系统" class="headerlink" title="安装基本系统"></a>安装基本系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap /mnt base</span><br></pre></td></tr></table></figure><h3 id="生成-fstab"><a href="#生成-fstab" class="headerlink" title="生成 fstab"></a>生成 fstab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure><h3 id="Change-root-到新安装的系统"><a href="#Change-root-到新安装的系统" class="headerlink" title="Change root 到新安装的系统"></a>Change root 到新安装的系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /mnt</span><br><span class="line">pacman -S vim net-tools</span><br></pre></td></tr></table></figure><h3 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑地区信息生成文件</span></span><br><span class="line">vim /etc/locale.gen</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成地区信息</span></span><br><span class="line">locale-gen</span><br><span class="line"><span class="comment"># 写进配置文件</span></span><br><span class="line"><span class="built_in">echo</span> LANG=zh_CN.UTF-8 &gt; /etc/locale.conf</span><br></pre></td></tr></table></figure><h3 id="设置时区"><a href="#设置时区" class="headerlink" title="设置时区"></a>设置时区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -S /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">hwclock --localtime</span><br></pre></td></tr></table></figure><h3 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo myhostname &gt; /etc/hostname</span><br><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="Root-密码"><a href="#Root-密码" class="headerlink" title="Root 密码"></a>Root 密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><h3 id="安装-GRUB"><a href="#安装-GRUB" class="headerlink" title="安装 GRUB"></a>安装 GRUB</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub-efi-x86_64</span><br><span class="line">pacman -S efibootmgr</span><br><span class="line">grub-install --efi-directory=/boot/efi --bootloader-id=arch --recheck</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">umount /mnt/boot/efi</span><br><span class="line">umount /mnt/boot</span><br><span class="line">umount /mnt</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="安装图形化界面"><a href="#安装图形化界面" class="headerlink" title="安装图形化界面"></a>安装图形化界面</h2><h3 id="设置-archlinux-源"><a href="#设置-archlinux-源" class="headerlink" title="设置 archlinux 源"></a>设置 archlinux 源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure><h3 id="更新源并且安装yaourt"><a href="#更新源并且安装yaourt" class="headerlink" title="更新源并且安装yaourt:"></a>更新源并且安装yaourt:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syu yaourt</span><br></pre></td></tr></table></figure><h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><ul><li>触摸板驱动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xf86-input-libinput xf86-input-synaptics</span><br></pre></td></tr></table></figure><ul><li>显示驱动</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xf86-video-intel</span><br><span class="line">pacman -S mesa-libgl libva-intel-driver libvdpau-va-glmesa-demos</span><br><span class="line">pacman -S nvidia nvidia-settings</span><br></pre></td></tr></table></figure><ul><li>声音</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S alsa-utils</span><br></pre></td></tr></table></figure><ul><li>无线网卡安装BCM4322</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S linux-firmware</span><br><span class="line">pacman -S linux-headers</span><br><span class="line">yaourt -S broadcom-wl-dkms</span><br></pre></td></tr></table></figure><ul><li>安装Deepin桌面环境</li></ul><p>1.安装Xorg和其工具包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xorg-server xorg-xinit</span><br></pre></td></tr></table></figure><p>2.DDE基本环境安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S deepin deepin-extra lightdm</span><br><span class="line">pacman -S file-roller evince gedit thunderbird gpicview</span><br><span class="line">pacman -S unrar unzip p7zip</span><br></pre></td></tr></table></figure><p>3.修改lightdm.conf使用登录管理器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/lightdm/lightdm.conf</span><br><span class="line">greeter-session=lightdm-deepin-greeter</span><br><span class="line">systemctl enable lightdm</span><br></pre></td></tr></table></figure><p>4.配置网络连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S networkmanager</span><br><span class="line">systemctl enable NetworkManager</span><br></pre></td></tr></table></figure><ul><li>安装常用软件</li></ul><p>1.搜狗输入法安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S fcitx fcitx-configtool</span><br><span class="line">pacman -S fcitx-sougoupinyin</span><br></pre></td></tr></table></figure><p>在用户目录下添加个配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano ~/.xprofile</span><br><span class="line">export GTK_IM_MODULE=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br><span class="line">export XMODIFIERS=@im=fcitx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S opencc  （简体和繁体互相转换的库）</span><br></pre></td></tr></table></figure><p>2.浏览器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S chromium</span><br><span class="line">pacman -S google-chrome</span><br><span class="line">pacman -S firefox</span><br><span class="line">pacman -S git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> archlinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 文本处理器之 awk</title>
      <link href="/2018/12/15/awk/"/>
      <url>/2018/12/15/awk/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk  <span class="string">'BEGIN&#123;FS="[:]"&#125; &#123;aa+=$3&#125; END&#123;print "所用的UID的和是:",aa&#125;'</span> passwd</span><br><span class="line">FSawk <span class="string">'BEGIN&#123;FS="[:]"&#125; /root/&#123;print $1,$2&#125;'</span> passwd</span><br><span class="line">OFSawk <span class="string">'BEGIN&#123;FS="[:]";OFS="---"&#125; /root/&#123;print $1,$2&#125;'</span> passwd</span><br><span class="line">NFawk -F: <span class="string">'&#123;print NF&#125;'</span> passwd</span><br><span class="line">RSawk <span class="string">'BEGIN&#123;FS="[,]";RS=" "&#125;&#123;print $2&#125;'</span> bb.txt</span><br><span class="line">ORSawk <span class="string">'BEGIN&#123;FS="[:]";ORS="---"&#125;&#123;print $0&#125;'</span> passwd</span><br><span class="line">FILENAMEawk -F<span class="string">"[:]"</span> <span class="string">'&#123;print FILENAME&#125;'</span> passwd</span><br><span class="line">NRawk <span class="string">'&#123;print NR&#125;'</span> a.txt b.txt</span><br><span class="line">FNRawk <span class="string">'&#123;print NR&#125;'</span> a.txt b.txt</span><br><span class="line"><span class="comment"># NR==FNR 此时处理的是第一个文件</span></span><br><span class="line"><span class="comment"># NR!=FNR 此时处理的是第二个文件</span></span><br><span class="line">awk <span class="string">'NR==FNR&#123;print FILENAME&#125; NR!=FNR&#123;print FILENAME&#125;'</span> a.txt b.txt</span><br><span class="line"><span class="keyword">if</span>awk -F[:] <span class="string">'&#123;if($3&lt;=1000)&#123;print $1"是root用户"&#125;else&#123;print $1"是普通用户"&#125;&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>变量名</td><td>属性</td></tr><tr><td>$0</td><td>当前记录</td></tr><tr><td>$1~$n</td><td>当前记录的第n个字段</td></tr><tr><td>FS</td><td>输入字段分隔符，默认为空格</td></tr><tr><td>RS</td><td>输入记录分割符，默认为换行符</td></tr><tr><td>NF</td><td>当前记录中的字段个数，就是有多少列</td></tr><tr><td>NR</td><td>已经读出的记录数，就是行号，从1开始</td></tr><tr><td>OFS</td><td>输出字符分隔符，默认也是空格</td></tr><tr><td>ORS</td><td>输出的记录分隔符，默认为换行符</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS Oracle 12c 安装指南</title>
      <link href="/2018/12/14/centos_install_oracle12c/"/>
      <url>/2018/12/14/centos_install_oracle12c/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-优化、安装必要的工具"><a href="#1-优化、安装必要的工具" class="headerlink" title="1. 优化、安装必要的工具"></a>1. 优化、安装必要的工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ yum -y install unzip vim lrzsz</span><br><span class="line">[root@oracle12c ~]$ setenforce 0</span><br><span class="line">[root@oracle12c ~]$ sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config</span><br><span class="line">[root@oracle12c ~]$ reboot</span><br><span class="line">[root@oracle12c ~]$ sed -i &apos;s/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/&apos; /etc/ssh/sshd_config</span><br><span class="line">[root@oracle12c ~]$ sed -i &apos;s/#UseDNS yes/UseDNS no/&apos; /etc/ssh/sshd_config</span><br><span class="line">[root@oracle12c ~]$ service sshd restart</span><br></pre></td></tr></table></figure><h2 id="2-安装依赖"><a href="#2-安装依赖" class="headerlink" title="2. 安装依赖"></a>2. 安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ yum -y install binutils compat-libcap1 compat-libstdc++-33 compat-libstdc++-33*.i686 elfutils-libelf-devel gcc gcc-c++ glibc*.i686 glibc glibc-devel glibc-devel*.i686 ksh libgcc*.i686 libgcc libstdc++ libstdc++*.i686 libstdc++-devel libstdc++-devel*.i686 libaio libaio*.i686 libaio-devel libaio-devel*.i686 make sysstat unixODBC unixODBC*.i686 unixODBC-devel unixODBC-devel*.i686 libXp</span><br></pre></td></tr></table></figure><h2 id="3-建立用户和组"><a href="#3-建立用户和组" class="headerlink" title="3. 建立用户和组"></a>3. 建立用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ groupadd oinstall</span><br><span class="line">[root@oracle12c ~]$ groupadd dba</span><br><span class="line">[root@oracle12c ~]$ groupadd oper</span><br><span class="line">[root@oracle12c ~]$ useradd -g oinstall -G dba,oper oracle</span><br><span class="line">[root@oracle12c ~]$ echo oracle | passwd --stdin oracle</span><br></pre></td></tr></table></figure><h2 id="4-创建安装、备份目录"><a href="#4-创建安装、备份目录" class="headerlink" title="4. 创建安装、备份目录"></a>4. 创建安装、备份目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ mkdir -p /u01/app/oracle/product/12.2.0</span><br><span class="line">[root@oracle12c ~]$ chown -R oracle:oinstall /u01</span><br></pre></td></tr></table></figure><h2 id="5-更改共享内存"><a href="#5-更改共享内存" class="headerlink" title="5. 更改共享内存"></a>5. 更改共享内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ echo &quot;shmfs /dev/shm tmpfs size=12g 0&quot; &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><h2 id="6-修改内核参数"><a href="#6-修改内核参数" class="headerlink" title="6. 修改内核参数"></a>6. 修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line">kernel.shmmax = 4398046511104</span><br><span class="line">kernel.panic_on_oops = 1</span><br><span class="line">net.core.rmem_default = 262144</span><br><span class="line">net.core.rmem_max = 4194304</span><br><span class="line">net.core.wmem_default = 262144</span><br><span class="line">net.core.wmem_max = 1048576</span><br><span class="line">net.ipv4.conf.all.rp_filter = 2</span><br><span class="line">net.ipv4.conf.default.rp_filter = 2</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ sysctl -p</span><br></pre></td></tr></table></figure><h2 id="7-改文件限制"><a href="#7-改文件限制" class="headerlink" title="7. 改文件限制"></a>7. 改文件限制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/security/limits.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br></pre></td></tr></table></figure><h2 id="8-修改登陆配置文件"><a href="#8-修改登陆配置文件" class="headerlink" title="8. 修改登陆配置文件"></a>8. 修改登陆配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/pam.d/login</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session required pam_limits.so</span><br></pre></td></tr></table></figure><h2 id="9-修改-ulimit"><a href="#9-修改-ulimit" class="headerlink" title="9. 修改 ulimit"></a>9. 修改 ulimit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if [ $USER = &quot;oracle&quot; ]; then</span><br><span class="line">    if [ $SHELL = &quot;/bin/ksh&quot; ]; then</span><br><span class="line">        ulimit -p 16384</span><br><span class="line">        ulimit -n 65536a</span><br><span class="line">    else</span><br><span class="line">        ulimit -u 16384 -n 65536</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="10-修改环境变量"><a href="#10-修改环境变量" class="headerlink" title="10. 修改环境变量"></a>10. 修改环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim ~/.bash_profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:$HOME/.local/bin:$HOME/bin:$ORACLE_HOME/bin</span><br><span class="line">ORACLE_BASE=/u01/app/oracle</span><br><span class="line">ORACLE_HOME=$ORACLE_BASE/product/12.2.0</span><br><span class="line">ORACLE_SID=orcl</span><br><span class="line">export ORACLE_BASE ORACLE_HOME ORACLE_SID</span><br><span class="line">export NLS_LANG=&quot;AMERICAN_AMERICA.UTF8&quot;</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure><h2 id="11-修改-hosts-文件"><a href="#11-修改-hosts-文件" class="headerlink" title="11. 修改 hosts 文件"></a>11. 修改 hosts 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ipaddr] oracle12c</span><br></pre></td></tr></table></figure><h2 id="12-上传安装包-linuxx64-12201-database-zip"><a href="#12-上传安装包-linuxx64-12201-database-zip" class="headerlink" title="12. 上传安装包 linuxx64_12201_database.zip"></a>12. 上传安装包 linuxx64_12201_database.zip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ rz</span><br></pre></td></tr></table></figure><h2 id="13-静默安装数据库软件"><a href="#13-静默安装数据库软件" class="headerlink" title="13. 静默安装数据库软件"></a>13. 静默安装数据库软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ cd database</span><br><span class="line">[oracle@oracle12c database]$ ./runInstaller  -silent -ignoreSysPrereqs -ignorePrereq -responseFile /home/oracle/database/response/db_install.rsp</span><br></pre></td></tr></table></figure><p>/home/oracle/database/response/db_install.rsp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v12.2.0</span><br><span class="line">oracle.install.option=INSTALL_DB_SWONLY</span><br><span class="line">UNIX_GROUP_NAME=dba</span><br><span class="line">INVENTORY_LOCATION=/u01/app/oracle/oraInventory</span><br><span class="line">ORACLE_HOME=/u01/app/oracle/product/12.2.0</span><br><span class="line">ORACLE_BASE=/u01/app/oracle</span><br><span class="line">oracle.install.db.InstallEdition=EE</span><br><span class="line">oracle.install.db.OSDBA_GROUP=dba</span><br><span class="line">oracle.install.db.OSOPER_GROUP=dba</span><br><span class="line">oracle.install.db.OSBACKUPDBA_GROUP=dba</span><br><span class="line">oracle.install.db.OSDGDBA_GROUP=dba</span><br><span class="line">oracle.install.db.OSKMDBA_GROUP=dba</span><br><span class="line">oracle.install.db.OSRACDBA_GROUP=dba</span><br><span class="line">oracle.install.db.CLUSTER_NODES=</span><br><span class="line">oracle.install.db.isRACOneInstall=false</span><br><span class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=false</span><br><span class="line">DECLINE_SECURITY_UPDATES=true</span><br></pre></td></tr></table></figure><h2 id="14-建立数据库"><a href="#14-建立数据库" class="headerlink" title="14. 建立数据库"></a>14. 建立数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ $ORACLE_HOME/bin/dbca -silent -createDatabase -templateName General_Purpose.dbc -gdbname orcl -sid orcl -responseFile NO_VALUE -characterSet AL32UTF8 -memoryPercentage 50 -emConfiguration LOCAL</span><br></pre></td></tr></table></figure><p>root 用户下执行以下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ /oracle/oraInventory/orainstRoot.sh</span><br><span class="line">[root@oracle12c ~]$ /oracle/product/12.2.0/root.sh</span><br></pre></td></tr></table></figure><h2 id="15-修改参数"><a href="#15-修改参数" class="headerlink" title="15. 修改参数"></a>15. 修改参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ sqlplus / as sysdba</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set sga_target=0 scope=spfile;</span><br><span class="line">SQL&gt; alter system set pga_aggregate_target=0 scope=spfile;</span><br><span class="line">SQL&gt; alter system set db_files=2000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set memory_max_target=12g scope=spfile;</span><br><span class="line">SQL&gt; alter system set memory_target=8g scope=spfile;</span><br><span class="line">SQL&gt; alter system set LOG_ARCHIVE_DEST_1='LOCATION=/backup/arch' scope=spfile;</span><br><span class="line">SQL&gt; alter SYSTEM set db_recovery_file_dest_size=4096M scope=spfile;</span><br><span class="line">SQL&gt; alter system set undo_retention=3600 scope=spfile;</span><br><span class="line">SQL&gt; alter system set processes=6000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set sessions=8000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set open_cursors=2000 scope=both;</span><br><span class="line">SQL&gt; create pfile='/tmp/pfile01.ora' from spfile;</span><br><span class="line">SQL&gt; alter system set filesystemio_options='asynch' scope=spfile;</span><br><span class="line">SQL&gt; alter system set disk_asynch_io=true SCOPE=SPFILE;</span><br><span class="line">SQL&gt; create directory expdp_dir as '/backup/expdp';</span><br><span class="line">SQL&gt; grant write,read on directory expdp_dir to public;</span><br><span class="line">SQL&gt; alter database add logfile group 4 '/u01/app/oracle/oradata/orcl/redo04.log' size 1G;</span><br><span class="line">SQL&gt; alter database add logfile group 5 '/u01/app/oracle/oradata/orcl/redo05.log' size 1G;</span><br><span class="line">SQL&gt; alter database add logfile group 6 '/u01/app/oracle/oradata/orcl/redo06.log' size 1G;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system checkpoint;</span><br><span class="line">SQL&gt; alter database drop logfile group 1;</span><br><span class="line">SQL&gt; alter database drop logfile group 2;</span><br><span class="line">SQL&gt; alter database drop logfile group 3;</span><br><span class="line">SQL&gt; host rm -rf /u01/app/oracle/oradata/orcl/redo0[1-3].log</span><br><span class="line">SQL&gt; alter database add logfile group 1 '/u01/app/oracle/oradata/orcl/redo01.log' size  1G;</span><br><span class="line">SQL&gt; alter database add logfile group 2 '/u01/app/oracle/oradata/orcl/redo02.log' size  1G;</span><br><span class="line">SQL&gt; alter database add logfile group 3 '/u01/app/oracle/oradata/orcl/redo03.log' size  1G; </span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system checkpoint;</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">SQL&gt; alter profile default limit FAILED_LOGIN_ATTEMPTS unlimited;</span><br><span class="line">SQL&gt; create pfile='/tmp/pfile02.ora' from spfile;</span><br></pre></td></tr></table></figure><h2 id="16-修改-Oracle-服务启动配置"><a href="#16-修改-Oracle-服务启动配置" class="headerlink" title="16. 修改 Oracle 服务启动配置"></a>16. 修改 Oracle 服务启动配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim /etc/oratab</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl:/u01/app/oracle/product/12.2.0:Y</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 入坑指南</title>
      <link href="/2018/12/12/docker/"/>
      <url>/2018/12/12/docker/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-Docker-安装"><a href="#1-Docker-安装" class="headerlink" title="1. Docker 安装"></a>1. Docker 安装</h2><ul><li>Ubuntu</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="comment"># step 2: 安装GPG证书</span></span><br><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># Step 3: 写入软件源信息</span></span><br><span class="line">sudo add-apt-repository <span class="string">"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="variable">$(lsb_release -cs)</span> stable"</span></span><br><span class="line"><span class="comment"># Step 4: 更新并安装 Docker-CE</span></span><br><span class="line">sudo apt -y update</span><br><span class="line">sudo apt -y install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># apt-cache madison docker-ce</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment"># Step 2: 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.1~ce-0~ubuntu-xenial)</span></span><br><span class="line"><span class="comment"># sudo apt-get -y install docker-ce=[VERSION]</span></span><br></pre></td></tr></table></figure><ul><li>CentOS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line">service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2 : 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><h2 id="3-常见问题"><a href="#3-常见问题" class="headerlink" title="3. 常见问题"></a>3. 常见问题</h2><ul><li>防火墙的问题</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 7 firewalld 设置，添加相应端口</span></span><br><span class="line">firewall-cmd --permanent --add-port 80/tcp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><ul><li>IPv4 forwarding is disabled. Networking will not work.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim  /usr/lib/sysctl.d/00-system.conf 在最后添加一行</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建基于 HDFS 碎片文件存储服务</title>
      <link href="/2018/12/10/hdfs/"/>
      <url>/2018/12/10/hdfs/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="准备-Java-环境"><a href="#准备-Java-环境" class="headerlink" title="准备 Java 环境"></a>准备 Java 环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install java-1.8.0-openjdk*</span><br><span class="line">java -version</span><br><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jre<span class="number">-1.8</span><span class="number">.0</span>-openjdk</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="准备-HDFS-环境"><a href="#准备-HDFS-环境" class="headerlink" title="准备 HDFS 环境"></a>准备 HDFS 环境</h2><h3 id="配置-SSH"><a href="#配置-SSH" class="headerlink" title="配置 SSH"></a>配置 SSH</h3><p>先后执行如下两行命令，配置 SSH 以无密码模式登陆：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -P <span class="string">''</span> -f ~/.ssh/id_dsa</span><br><span class="line">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>接着可以验证下，在不输入密码的情况下，应该能使用 ssh 命令成功连接本机：</p><h3 id="安装-Hadoop"><a href="#安装-Hadoop" class="headerlink" title="安装 Hadoop"></a>安装 Hadoop</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 /data/hadoop 目录，然后进入该目录：</span></span><br><span class="line">mkdir -p /data/hadoop &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line"><span class="comment"># 下载并解压 Hadoop：</span></span><br><span class="line">wget http://archive.apache.org/dist/hadoop/core/hadoop-2.7.1/hadoop-2.7.1.tar.gz</span><br><span class="line">tar -zxvf hadoop-2.7.1.tar.gz</span><br><span class="line">mv hadoop-2.7.1 hadoop &amp;&amp; mv <span class="variable">$_</span> /usr/<span class="built_in">local</span>/</span><br></pre></td></tr></table></figure><p>修改 Hadoop 环境配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/hadoop-env.sh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk</span><br></pre></td></tr></table></figure><p>查看下 Hadoop 的版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop version</span><br></pre></td></tr></table></figure><h2 id="修改-Hadoop-配置"><a href="#修改-Hadoop-配置" class="headerlink" title="修改 Hadoop 配置"></a>修改 Hadoop 配置</h2><p>由于我们的实践环境是在单机下进行的，所以此处把 Hadoop 配置为伪分布式模式。<br>新建若干临时文件夹，我们在后续的配置中以及 HDFS 和 Hadoop 的启动过程中会使用到这些文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop &amp;&amp; mkdir -p tmp dfs/name dfs/data</span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 core-site.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 hdfs-site.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/hadoop/etc/hadoop/hdfs-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 yarn-site.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动 Hadoop</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop/bin/</span><br><span class="line"><span class="comment"># 对 HDFS 文件系统进行格式化：</span></span><br><span class="line">./hdfs namenode -format</span><br><span class="line"><span class="comment"># 接着进入如下目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop/sbin/</span><br><span class="line"><span class="comment"># 先后执行如下两个脚本启动 Hadoop</span></span><br><span class="line">./start-dfs.sh</span><br><span class="line">./start-yarn.sh</span><br><span class="line"><span class="comment"># 验证 Hadoop 是否启动成功：</span></span><br><span class="line">jps</span><br></pre></td></tr></table></figure><p>在浏览器中访问如下链接，应该能正常访问：</p><p>http://&lt;您的 IP 地址&gt;:50070/explorer.html#/<br>接下来，我们实践下如何将碎片文件存储到 HDFS 中。</p><h2 id="存储碎片文件"><a href="#存储碎片文件" class="headerlink" title="存储碎片文件"></a>存储碎片文件</h2><h3 id="准备碎片文件"><a href="#准备碎片文件" class="headerlink" title="准备碎片文件"></a>准备碎片文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录用于存放碎片文件，进入该目录：</span></span><br><span class="line"></span><br><span class="line">mkdir -p /data/file &amp;&amp; <span class="built_in">cd</span> /data/file</span><br><span class="line"><span class="comment"># 新建一批碎片文件到该目录下</span></span><br><span class="line">i=1; <span class="keyword">while</span> [ <span class="variable">$i</span> -le 99 ]; <span class="keyword">do</span> name=`<span class="built_in">printf</span> <span class="string">"test%02d.txt"</span>  <span class="variable">$i</span>`; touch <span class="string">"<span class="variable">$name</span>"</span>; i=$((<span class="variable">$i</span>+1)); <span class="keyword">done</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h3 id="将碎片文件存储在-HDFS-中"><a href="#将碎片文件存储在-HDFS-中" class="headerlink" title="将碎片文件存储在 HDFS 中"></a>将碎片文件存储在 HDFS 中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 HDFS 上新建目录</span></span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -mkdir /dest</span><br></pre></td></tr></table></figure><p>此时，在浏览器是访问如下链接，可以看到 /dest 目录已创建，但是暂时还没有内容：</p><p>http://&lt;您的 IP 地址&gt;:50070/explorer.html#/dest  </p><h3 id="上传碎片文件"><a href="#上传碎片文件" class="headerlink" title="上传碎片文件"></a>上传碎片文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupadd supergroup</span><br><span class="line">usermod -a -G supergroup root</span><br><span class="line"><span class="comment"># 将之前创建的碎片文件上传到 HDFS 中：</span></span><br><span class="line"><span class="built_in">cd</span> /data/file &amp;&amp; /usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -put *.txt /dest</span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -ls /dest</span><br><span class="line"><span class="comment"># 在上传之前，我们需先创建 HDFS 用户组 supergroup，然后将 root 用户添加到该组中，否则会因权限问题页报告异常。</span></span><br></pre></td></tr></table></figure><h3 id="访问服务"><a href="#访问服务" class="headerlink" title="访问服务"></a>访问服务</h3><p>在浏览器是访问如下链接，可以看到 /dest 目录的文件内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&lt;您的 IP 地址&gt;:50070/explorer.html#/dest</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 打造静态博客</title>
      <link href="/2018/12/09/hexo/"/>
      <url>/2018/12/09/hexo/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h2 id="修改主页配置文件-config-yml"><a href="#修改主页配置文件-config-yml" class="headerlink" title="修改主页配置文件 _config.yml"></a>修改主页配置文件 _config.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder : true</span><br></pre></td></tr></table></figure><h2 id="安装本地图片插件"><a href="#安装本地图片插件" class="headerlink" title="安装本地图片插件"></a>安装本地图片插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure><h2 id="生成新的博文"><a href="#生成新的博文" class="headerlink" title="生成新的博文"></a>生成新的博文</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo n &quot;xxx&quot;</span><br></pre></td></tr></table></figure><p>此时 /source/_posts/ 下会生成同名文件夹</p><h2 id="博文引入图片"><a href="#博文引入图片" class="headerlink" title="博文引入图片"></a>博文引入图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](xxx/xxx.jpg)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> hexo </tag>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>history 添加时间戳</title>
      <link href="/2018/12/08/bash_history/"/>
      <url>/2018/12/08/bash_history/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HISTTIMEFORMAT=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jekyll 打造静态博客</title>
      <link href="/2018/12/07/Jekyll/"/>
      <url>/2018/12/07/Jekyll/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装之前先安装依赖包"><a href="#1-安装之前先安装依赖包" class="headerlink" title="1. 安装之前先安装依赖包"></a>1. 安装之前先安装依赖包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ruby ruby-dev build-essential</span><br></pre></td></tr></table></figure><h2 id="2-添加环境变量"><a href="#2-添加环境变量" class="headerlink" title="2. 添加环境变量"></a>2. 添加环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'# Install Ruby Gems to ~/gems'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export GEM_HOME=$HOME/gems'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$HOME/gems/bin:$PATH'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="3-安装-Jekyll"><a href="#3-安装-Jekyll" class="headerlink" title="3. 安装 Jekyll"></a>3. 安装 Jekyll</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install jekyll bundler</span><br></pre></td></tr></table></figure><h2 id="4-使用-bundle-更新-Jekyll"><a href="#4-使用-bundle-更新-Jekyll" class="headerlink" title="4. 使用 bundle 更新 Jekyll"></a>4. 使用 bundle 更新 Jekyll</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jekyll --version</span><br><span class="line">gem list jekyll</span><br><span class="line">bundle update jekyll</span><br></pre></td></tr></table></figure><h2 id="5-使用-gem-更新-Jekyll"><a href="#5-使用-gem-更新-Jekyll" class="headerlink" title="5. 使用 gem 更新 Jekyll"></a>5. 使用 gem 更新 Jekyll</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem update jekyll</span><br></pre></td></tr></table></figure><h2 id="6-更新-Rubygems"><a href="#6-更新-Rubygems" class="headerlink" title="6. 更新 Rubygems"></a>6. 更新 Rubygems</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem update --system</span><br></pre></td></tr></table></figure><h2 id="7-安装预览版"><a href="#7-安装预览版" class="headerlink" title="7. 安装预览版"></a>7. 安装预览版</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装最新预览版</span></span><br><span class="line">gem install jekyll --pre</span><br><span class="line"><span class="comment">## 安装特定版本的 Jekyll</span></span><br><span class="line">gem install jekyll -v <span class="string">'2.0.0.alpha.1'</span></span><br></pre></td></tr></table></figure><h2 id="8-源码安装"><a href="#8-源码安装" class="headerlink" title="8. 源码安装"></a>8. 源码安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/jekyll/jekyll.git</span><br><span class="line"><span class="built_in">cd</span> jekyll</span><br><span class="line">script/bootstrap</span><br><span class="line">bundle <span class="built_in">exec</span> rake build</span><br><span class="line">ls pkg/*.gem | head -n 1 | xargs gem install -l</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ruby </tag>
            
            <tag> jekyll </tag>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keepalive 安装与配置</title>
      <link href="/2018/12/06/keepalive/"/>
      <url>/2018/12/06/keepalive/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-keepalive"><a href="#1-安装-keepalive" class="headerlink" title="1. 安装 keepalive"></a>1. 安装 keepalive</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# yum -y install keepalived</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> keepalive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 网络管理</title>
      <link href="/2018/12/05/managenetwork/"/>
      <url>/2018/12/05/managenetwork/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1"><a href="#1" class="headerlink" title="1. "></a>1. <figure class="highlight plain"><figcaption><span>ARP 高速缓存</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">Usage:</span><br><span class="line">  arp [-vn]  [&lt;HW&gt;] [-i &lt;if&gt;] [-a] [&lt;hostname&gt;]             &lt;-Display ARP cache</span><br><span class="line">  arp [-v]          [-i &lt;if&gt;] -d  &lt;host&gt; [pub]               &lt;-Delete ARP entry</span><br><span class="line">  arp [-vnD] [&lt;HW&gt;] [-i &lt;if&gt;] -f  [&lt;filename&gt;]            &lt;-Add entry from file</span><br><span class="line">  arp [-v]   [&lt;HW&gt;] [-i &lt;if&gt;] -s  &lt;host&gt; &lt;hwaddr&gt; [temp]            &lt;-Add entry</span><br><span class="line">  arp [-v]   [&lt;HW&gt;] [-i &lt;if&gt;] -Ds &lt;host&gt; &lt;if&gt; [netmask &lt;nm&gt;] pub          &lt;-&apos;&apos;-</span><br><span class="line"></span><br><span class="line">        -a                       display (all) hosts in alternative (BSD) style</span><br><span class="line">        -e                       display (all) hosts in default (Linux) style</span><br><span class="line">        -s, --set                set a new ARP entry</span><br><span class="line">        -d, --delete             delete a specified entry</span><br><span class="line">        -v, --verbose            be verbose</span><br><span class="line">        -n, --numeric            don&apos;t resolve names</span><br><span class="line">        -i, --device             specify network interface (e.g. eth0)</span><br><span class="line">        -D, --use-device         read &lt;hwaddr&gt; from given device</span><br><span class="line">        -A, -p, --protocol       specify protocol family</span><br><span class="line">        -f, --file               read new entries from file or from /etc/ethers</span><br><span class="line"></span><br><span class="line">  &lt;HW&gt;=Use &apos;-H &lt;hw&gt;&apos; to specify hardware address type. Default: ether</span><br><span class="line">  List of possible hardware types (which support ARP):</span><br><span class="line">    ash (Ash) ether (Ethernet) ax25 (AMPR AX.25)</span><br><span class="line">    netrom (AMPR NET/ROM) rose (AMPR ROSE) arcnet (ARCnet)</span><br><span class="line">    dlci (Frame Relay DLCI) fddi (Fiber Distributed Data Interface) hippi (HIPPI)</span><br><span class="line">    irda (IrLAP) x25 (generic X.25) infiniband (InfiniBand)</span><br><span class="line">    eui64 (Generic EUI-64)</span><br></pre></td></tr></table></figure></h2><h2 id="2-arpwatch：监听-ARP-记录"><a href="#2-arpwatch：监听-ARP-记录" class="headerlink" title="2. arpwatch：监听 ARP 记录"></a>2. <code>arpwatch</code>：监听 ARP 记录</h2><h2 id="3-arping：发送-ARP-请求到一个相邻主机"><a href="#3-arping：发送-ARP-请求到一个相邻主机" class="headerlink" title="3. arping：发送 ARP 请求到一个相邻主机"></a>3. <code>arping</code>：发送 ARP 请求到一个相邻主机</h2><h2 id="4-finger：查找并显示用户信息"><a href="#4-finger：查找并显示用户信息" class="headerlink" title="4. finger：查找并显示用户信息"></a>4. <code>finger</code>：查找并显示用户信息</h2><h2 id="5-ifconfig：设置网络接口"><a href="#5-ifconfig：设置网络接口" class="headerlink" title="5. ifconfig：设置网络接口"></a>5. <code>ifconfig</code>：设置网络接口</h2><h2 id="6-iwconfig：设置无线网卡"><a href="#6-iwconfig：设置无线网卡" class="headerlink" title="6. iwconfig：设置无线网卡"></a>6. <code>iwconfig</code>：设置无线网卡</h2><h2 id="7-hostname：显示主机名"><a href="#7-hostname：显示主机名" class="headerlink" title="7. hostname：显示主机名"></a>7. <code>hostname</code>：显示主机名</h2><h2 id="8-ifup：激活设备"><a href="#8-ifup：激活设备" class="headerlink" title="8. ifup：激活设备"></a>8. <code>ifup</code>：激活设备</h2><h2 id="9-ifdown：禁用网络设备"><a href="#9-ifdown：禁用网络设备" class="headerlink" title="9. ifdown：禁用网络设备"></a>9. <code>ifdown</code>：禁用网络设备</h2><h2 id="10-mii-tool：调整网卡模式"><a href="#10-mii-tool：调整网卡模式" class="headerlink" title="10. mii-tool：调整网卡模式"></a>10. <code>mii-tool</code>：调整网卡模式</h2><h2 id="11-route：设置路由表"><a href="#11-route：设置路由表" class="headerlink" title="11. route：设置路由表"></a>11. <code>route</code>：设置路由表</h2><h2 id="12-netstat：查看网络连接"><a href="#12-netstat：查看网络连接" class="headerlink" title="12. netstat：查看网络连接"></a>12. <code>netstat</code>：查看网络连接</h2><h2 id="13-ping：检测主机的连通性"><a href="#13-ping：检测主机的连通性" class="headerlink" title="13. ping：检测主机的连通性"></a>13. <code>ping</code>：检测主机的连通性</h2><h2 id="14-traceroute：检查数据包所经过的路由器"><a href="#14-traceroute：检查数据包所经过的路由器" class="headerlink" title="14. traceroute：检查数据包所经过的路由器"></a>14. <code>traceroute</code>：检查数据包所经过的路由器</h2><h2 id="15-wget：下载文件"><a href="#15-wget：下载文件" class="headerlink" title="15. wget：下载文件"></a>15. <code>wget</code>：下载文件</h2><h2 id="16-telnet：远程登陆"><a href="#16-telnet：远程登陆" class="headerlink" title="16. telnet：远程登陆"></a>16. <code>telnet</code>：远程登陆</h2><h2 id="17-ethtool：查询及设置网卡参数"><a href="#17-ethtool：查询及设置网卡参数" class="headerlink" title="17. ethtool：查询及设置网卡参数"></a>17. <code>ethtool</code>：查询及设置网卡参数</h2><h2 id="18-tc：显示和维护流量控制设置"><a href="#18-tc：显示和维护流量控制设置" class="headerlink" title="18. tc：显示和维护流量控制设置"></a>18. <code>tc</code>：显示和维护流量控制设置</h2>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 时区设置</title>
      <link href="/2018/12/04/timezone/"/>
      <url>/2018/12/04/timezone/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-时间设置"><a href="#1-时间设置" class="headerlink" title="1. 时间设置"></a>1. 时间设置</h2><h3 id="查看、设置硬件时间"><a href="#查看、设置硬件时间" class="headerlink" title="查看、设置硬件时间"></a>查看、设置硬件时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hwclock --show</span><br><span class="line">clock --show</span><br><span class="line"><span class="comment">## 月/日/年时:分:秒</span></span><br><span class="line">hwclock --<span class="built_in">set</span> --date=<span class="string">"06/18/14 14:55"</span></span><br><span class="line">clock --<span class="built_in">set</span> --date=<span class="string">"06/18/14 14:55"</span></span><br></pre></td></tr></table></figure><h3 id="硬件时钟与系统时钟同步"><a href="#硬件时钟与系统时钟同步" class="headerlink" title="硬件时钟与系统时钟同步"></a>硬件时钟与系统时钟同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## hc代表硬件时间，sys代表系统时间</span></span><br><span class="line"><span class="comment">## 硬件时钟同步系统时钟</span></span><br><span class="line">hwclock --hctosys</span><br><span class="line">clock --hctosys</span><br><span class="line"><span class="comment">## 系统时钟同步硬件时钟</span></span><br><span class="line">hwclock --systohc</span><br><span class="line">clock --systohc</span><br></pre></td></tr></table></figure><h3 id="同步-ntp-服务器"><a href="#同步-ntp-服务器" class="headerlink" title="同步 ntp 服务器"></a>同步 ntp 服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装 ntp、ntpdate</span></span><br><span class="line">yum -y install ntp</span><br><span class="line">ntpdate &lt;IP&gt;</span><br><span class="line"><span class="comment">## 添加定时任务</span></span><br><span class="line">crontab -e</span><br><span class="line">0 0 * * * /usr/sbin/ntpdate &lt;IP&gt;</span><br></pre></td></tr></table></figure><h2 id="2-时区设置"><a href="#2-时区设置" class="headerlink" title="2. 时区设置"></a>2. 时区设置</h2><h3 id="tzselect"><a href="#tzselect" class="headerlink" title="tzselect"></a>tzselect</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TZ=<span class="string">'Asia/Shanghai'</span>; <span class="built_in">export</span> TZ</span><br></pre></td></tr></table></figure><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim etc/sysconfig/clock</span><br><span class="line">ZONE=Asia/Shanghai</span><br><span class="line">rm /etc/localtime</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br><span class="line">timedatectl list-timezones</span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br><span class="line">yum -y install ntp</span><br><span class="line">vim  /etc/ntp.conf</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 聚合链路</title>
      <link href="/2018/12/03/team/"/>
      <url>/2018/12/03/team/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>broadcast（可将数据传送到所有端口）<br>round-robin（可按顺序将数据传送到所有端口）<br>active-backup（使用一个端口或链接时其他则处于备用状态）<br>loadbalance（使用主动 Tx 负载平衡及基于 BPF 的 Tx 端口选择程序）<br>lacp（采用 802.3ad 链接合并控制协议）  </p><h2 id="1-安装-teamd"><a href="#1-安装-teamd" class="headerlink" title="1. 安装 teamd"></a>1. 安装 teamd</h2><p>默认不会安装网络成组守护进程 teamd。要安装 teamd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install teamd</span><br></pre></td></tr></table></figure><h2 id="2-添加配置"><a href="#2-添加配置" class="headerlink" title="2. 添加配置"></a>2. 添加配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用名称 team-ServerA 创建新的成组接口</span></span><br><span class="line">nmcli connection add <span class="built_in">type</span> team ifname team-ServerA</span><br><span class="line">nmcli con show team-ServerA</span><br><span class="line"><span class="comment"># 更改为成组分配的名称：</span></span><br><span class="line">nmcli con mod old-team-name connection.id new-team-name</span><br><span class="line"><span class="comment"># 载入成组配置文件</span></span><br><span class="line">nmcli connection modify team-name team.config JSON-config</span><br><span class="line"><span class="comment"># 检查 team.config 属性</span></span><br><span class="line">nmcli con show team-name | grep team.config</span><br><span class="line"><span class="comment"># 在 Team0 中添加名为 Team0-port1 的接口 eth0</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> team-slave con-name Team0-port1 ifname eth0 master Team0</span><br><span class="line"><span class="comment"># 添加另一个名为 Team0-port2 的接口 eth1</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> team-slave con-name Team0-port2 ifname eth1 master Team0</span><br><span class="line"><span class="comment"># 激活端口</span></span><br><span class="line">nmcli connection up Team0-port1</span><br><span class="line">nmcli connection up Team0-port2</span><br><span class="line"><span class="comment"># 验证是否已激活成组接口</span></span><br><span class="line">ip link</span><br><span class="line"><span class="comment"># 或者使用命令启用该接口组</span></span><br><span class="line">nmcli connection up Team0</span><br></pre></td></tr></table></figure><h2 id="3-配置文件"><a href="#3-配置文件" class="headerlink" title="3. 配置文件"></a>3. 配置文件</h2><p>要创建网络成组，作为成组端口或链接接口的虚拟接口需要一个 JSON 格式的配置文件。快捷的方法是复制示例配置文件，然后使用有 root 授权的编辑器进行编辑。  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出可用示例配置文件</span></span><br><span class="line">ls /usr/share/doc/teamd-*/example_configs/</span><br><span class="line"><span class="comment"># 请使用以下命令查看包含的文件之一，比如 activebackup_ethtool_1.conf：</span></span><br><span class="line">cat /usr/share/doc/teamd-*/example_configs/activebackup_ethtool_1.conf</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 网卡绑定</title>
      <link href="/2018/12/02/bond/"/>
      <url>/2018/12/02/bond/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-常见的网卡绑定驱动模式"><a href="#1-常见的网卡绑定驱动模式" class="headerlink" title="1. 常见的网卡绑定驱动模式:"></a>1. 常见的网卡绑定驱动模式:</h2><ul><li>mod=0 (balance-rr) Round-robin 衡抡循环策略<br>特点：<br>传输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1.一直循环下去，直到最后一个传输完毕），此模式提供负载平衡和容错能力；但是我们知道如果一个连接或者会话的数据包从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能会出现数据包无序到达的问题，而无序到达的数据包需要重新要求被发送，这样网络的吞吐量就会下降  </li><li>mode=1 (active-backup) 主-备份策略<br>特点：<br>只有一个设备处于活动状态，当一个宕掉另一个马上由备份转换为主设备。mac地址是外部可见得，从外面看来，bond的MAC地址是唯一的，以避免switch(交换机)发生混乱。此模式只提供了容错能力；由此可见此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1/N  </li><li>mode=2 (balance-xor) XOR policy 平衡策略<br>特点：<br>基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR 目标MAC地址) % slave数量。其他的传输策略可以通过xmit_hash_policy选项指定，此模式提供负载平衡和容错能力  </li><li>mode=3 (broadcast) 广播策略<br>特点：<br>在每个slave接口上传输每个数据包，此模式提供了容错能力  </li><li>mode=4 (802.3ad) IEEE 802.3ad 动态链接聚合<br>特点：<br>创建一个聚合组，它们共享同样的速率和双工设定。根据802.3ad规范将多个slave工作在同一个激活的聚合体下。<br>外出流量的slave选举是基于传输hash策略，该策略可以通过xmit_hash_policy选项从缺省的XOR策略改变到其他策略。需要注意的 是，并不是所有的传输策略都是802.3ad适应的，尤其考虑到在802.3ad标准43.2.4章节提及的包乱序问题。不同的实现可能会有不同的适应性。<br>必要条件：<br>条件1：ethtool支持获取每个slave的速率和双工设定<br>条件2：switch(交换机)支持IEEE 802.3ad Dynamic link aggregation<br>条件3：大多数switch(交换机)需要经过特定配置才能支持802.3ad模式  </li><li>mode=5 (balance-tlb) Adaptive transmit load balancing 适配器传输负载均衡<br>特点：<br>不需要任何特别的switch(交换机)支持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另一个slave接管失败的slave的MAC地址。<br>必要条件：<br>ethtool支持获取每个slave的速率  </li><li>mode=6 (balance-alb) Adaptive load balancing 适配器适应性负载均衡<br>特点：<br>该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个slave的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。</li></ul><h2 id="2-使用-nmcli-工具配置网卡绑定"><a href="#2-使用-nmcli-工具配置网卡绑定" class="headerlink" title="2. 使用 nmcli 工具配置网卡绑定"></a>2. 使用 nmcli 工具配置网卡绑定</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add <span class="built_in">type</span> bond con-name mybond0 ifname bond0 mode balance-alb</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens37 master mybond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens38 master mybond0</span><br><span class="line">nmcli con up bond-slave-ens7</span><br><span class="line">nmcli con modify mybond0 ipv4.method manual</span><br><span class="line">nmcli con modify mybond0 ipv4.addresses 192.168.78.137/24</span><br><span class="line">nmcli con modify mybond0 ipv4.gateway 192.168.78.2</span><br><span class="line">nmcli con modify mybond0 ipv4.dns 192.168.78.2</span><br></pre></td></tr></table></figure><h2 id="3-使用命令行界面配置网卡绑定"><a href="#3-使用命令行界面配置网卡绑定" class="headerlink" title="3. 使用命令行界面配置网卡绑定"></a>3. 使用命令行界面配置网卡绑定</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示 boding 模块信息</span></span><br><span class="line">modinfo bonding</span><br></pre></td></tr></table></figure><h3 id="3-1-创建频道绑定接口"><a href="#3-1-创建频道绑定接口" class="headerlink" title="3.1 创建频道绑定接口"></a>3.1 创建频道绑定接口</h3><p>在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-bondN 的文件，使用接口号码替换 N，比如 0。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=bond0</span><br><span class="line">NAME=bond0</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=yes</span><br><span class="line">IPADDR=192.168.1.1</span><br><span class="line">PREFIX=24</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">BONDING_OPTS=&quot;bonding parameters separated by spaces&quot;</span><br></pre></td></tr></table></figure><h3 id="3-2-创建从属接口"><a href="#3-2-创建从属接口" class="headerlink" title="3.2 创建从属接口"></a>3.2 创建从属接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=ethN</span><br><span class="line">NAME=bond0-slave</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br></pre></td></tr></table></figure><h3 id="3-3-激活频道绑定"><a href="#3-3-激活频道绑定" class="headerlink" title="3.3 激活频道绑定"></a>3.3 激活频道绑定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ifup ifcfg-eth0</span><br><span class="line">ifup ifcfg-eth1</span><br><span class="line"><span class="comment"># 生效更改</span></span><br><span class="line"><span class="comment"># nmcli con load /etc/sysconfig/network-script/ifcfg-device</span></span><br><span class="line">nmcli con reload</span><br><span class="line"><span class="comment"># 查看网卡绑定接口状态</span></span><br><span class="line">ip link show</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat 配置与优化</title>
      <link href="/2018/12/01/tomcat/"/>
      <url>/2018/12/01/tomcat/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-JVM-配置"><a href="#1-JVM-配置" class="headerlink" title="1. JVM 配置"></a>1. JVM 配置</h2><h3 id="添加-tomcat-管理员"><a href="#添加-tomcat-管理员" class="headerlink" title="添加 tomcat 管理员"></a>添加 tomcat 管理员</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim /tomcat/conf/tomcat-users.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"manager"</span> <span class="attr">password</span>=<span class="string">"manager"</span> <span class="attr">roles</span>=<span class="string">"admin-gui,manager-gui"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="修改-JVM-虚拟内存"><a href="#修改-JVM-虚拟内存" class="headerlink" title="修改 JVM 虚拟内存"></a>修改 JVM 虚拟内存</h3><p><img src="images/jvm.png" alt></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=<span class="string">"-server -Xms1024m -Xmx1024m -Xmn256m -XX:PermSize=512m -XX:MaxPermSize=1024m -XX:ReservedCodeCacheSize=256M -Djava.awt.headless=true -Dfile.encoding=utf-8"</span></span><br></pre></td></tr></table></figure><ul><li>堆设置：  </li></ul><p>-Xms=n   初始堆大小<br>-Xmx=n   最大堆大小<br>-XX:NewSize=n   设置年轻代大小<br>-XX:NewRatio=n  设置年轻代和年老代的比值.如:为3,表示年轻代与年老代比值为1:3,年轻代占整个年轻代年老代和的1/4<br>-XX:SurvivorRatio=n 年轻代中Eden区与两个Survivor区的比值.注意Survivor区有两个.如:3,表示Eden:Survivor=3:2,一个Survivor区占整个年轻代的1/5<br>-XX:MaxPermSize=n   设置持久代大小  </p><ul><li>收集器设置：  </li></ul><p>-XX:+UseSerialGC    设置串行收集器<br>-XX:+UseParallelGC  设置并行收集器<br>-XX:+UseParalledlOldGC  设置并行年老代收集器<br>-XX:+UseConcMarkSweepGC 设置并发收集器</p><ul><li>垃圾回收统计信息：  </li></ul><p>-XX:+PrintGC<br>-XX:+PrintGCDetails<br>-XX:+PrintGCTimeStamps<br>-Xloggc:filename  </p><ul><li>并行收集器设置：  </li></ul><p>-XX:ParallelGCThreads=n 设置并行收集器收集时使用的CPU数.并行收集线程数.<br>-XX:MaxGCPauseMillis=n  设置并行收集最大暂停时间<br>-XX:GCTimeRatio=n   设置垃圾回收时间占程序运行时间的百分比.公式为1/(1+n)并发收集器设置<br>-XX:+CMSIncrementalMode 设置为增量模式.适用于单CPU情况.<br>-XX:ParallelGCThreads=n 设置并发收集器年轻代收集方式为并行收集时,使用的CPU数.并行收集线程数</p><h2 id="2-apr-安装"><a href="#2-apr-安装" class="headerlink" title="2. apr 安装"></a>2. apr 安装</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install gcc expat-devel</span><br></pre></td></tr></table></figure><h3 id="安装-apr"><a href="#安装-apr" class="headerlink" title="安装 apr"></a>安装 <a href>apr</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# mkdir /usr/local/apr</span><br><span class="line">[root@server apr-1.6.3]# ./configure --prefix=/usr/local/apr</span><br><span class="line">[root@server apr-1.6.3]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="安装-apr-util"><a href="#安装-apr-util" class="headerlink" title="安装 apr-util"></a>安装 <a href>apr-util</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server apr-util-1.6.1]# ./configure --prefix=/usr/local/apr --with-apr=/usr/local/apr</span><br><span class="line">[root@server apr-util-1.6.1]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="安装-tomcat-native"><a href="#安装-tomcat-native" class="headerlink" title="安装 tomcat-native"></a>安装 <a href>tomcat-native</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# cd tomcat-native-1.2.17-src/native/</span><br><span class="line">[root@server native]# ./configure --prefix=/usr/local/apr --with-apr=/usr/local/apr --with-java-home=/usr/java/jdk1.7.0_80/</span><br><span class="line">[root@server native]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="修改-tomcat-配置"><a href="#修改-tomcat-配置" class="headerlink" title="修改 tomcat 配置"></a>修改 tomcat 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim /tomcat/bin/catalina.sh</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 CATALINA_OPTS</span></span><br><span class="line">CATALINA_OPTS=<span class="string">"-Djava.library.path=/usr/local/apr/lib"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim /tomcat/conf/server.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8001"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11AprProtocol"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">executor</span>=<span class="string">"tomcatThreadPool"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxThreads</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">enableLookups</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">acceptCount</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">connectionTimeout</span>=<span class="string">"30000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">redirectPort</span>=<span class="string">"9100"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxPostSize</span>=<span class="string">"8388608"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxParameterCount</span>=<span class="string">"40000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">disableUploadTimeout</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-SSLEngine-Error"><a href="#3-SSLEngine-Error" class="headerlink" title="3. SSLEngine Error"></a>3. SSLEngine Error</h2><h3 id="查看-tomcat-日志，出现-SSLEngine-Error"><a href="#查看-tomcat-日志，出现-SSLEngine-Error" class="headerlink" title="查看 tomcat 日志，出现 SSLEngine Error"></a>查看 tomcat 日志，出现 SSLEngine Error</h3><p>org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Failed to initialize the SSLEngine.<br>{:.error}</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim /tomcat/conf/server.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> <span class="attr">SSLEngine</span>=<span class="string">"off"</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LVS</title>
      <link href="/2018/11/30/lvs/"/>
      <url>/2018/11/30/lvs/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-ipvsadm"><a href="#1-安装-ipvsadm" class="headerlink" title="1. 安装 ipvsadm"></a>1. 安装 ipvsadm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# yum -y install ipvsadm</span><br></pre></td></tr></table></figure><h2 id="2-ipvsadm-用法"><a href="#2-ipvsadm-用法" class="headerlink" title="2. ipvsadm 用法"></a>2. ipvsadm 用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# ipvsadm --help</span><br><span class="line">ipvsadm v1.27 2008/5/15 (compiled with popt and IPVS v1.2.1)</span><br><span class="line">Usage:</span><br><span class="line">  ipvsadm -A|E -t|u|f service-address [-s scheduler] [-p [timeout]] [-M netmask] [--pe persistence_engine] [-b sched-flags]</span><br><span class="line">  ipvsadm -D -t|u|f service-address</span><br><span class="line">  ipvsadm -C</span><br><span class="line">  ipvsadm -R</span><br><span class="line">  ipvsadm -S [-n]</span><br><span class="line">  ipvsadm -a|e -t|u|f service-address -r server-address [options]</span><br><span class="line">  ipvsadm -d -t|u|f service-address -r server-address</span><br><span class="line">  ipvsadm -L|l [options]</span><br><span class="line">  ipvsadm -Z [-t|u|f service-address]</span><br><span class="line">  ipvsadm --set tcp tcpfin udp</span><br><span class="line">  ipvsadm --start-daemon state [--mcast-interface interface] [--syncid sid]</span><br><span class="line">  ipvsadm --stop-daemon state</span><br><span class="line">  ipvsadm -h</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">Either long or short options are allowed.</span><br><span class="line">  --add-service     -A        add virtual service with options</span><br><span class="line">  --edit-service    -E        edit virtual service with options</span><br><span class="line">  --delete-service  -D        delete virtual service</span><br><span class="line">  --clear           -C        clear the whole table</span><br><span class="line">  --restore         -R        restore rules from stdin</span><br><span class="line">  --save            -S        save rules to stdout</span><br><span class="line">  --add-server      -a        add real server with options</span><br><span class="line">  --edit-server     -e        edit real server with options</span><br><span class="line">  --delete-server   -d        delete real server</span><br><span class="line">  --list            -L|-l     list the table</span><br><span class="line">  --zero            -Z        zero counters in a service or all services</span><br><span class="line">  --set tcp tcpfin udp        set connection timeout values</span><br><span class="line">  --start-daemon              start connection sync daemon</span><br><span class="line">  --stop-daemon               stop connection sync daemon</span><br><span class="line">  --help            -h        display this help message</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --tcp-service  -t service-address   service-address is host[:port]</span><br><span class="line">  --udp-service  -u service-address   service-address is host[:port]</span><br><span class="line">  --fwmark-service  -f fwmark         fwmark is an integer greater than zero</span><br><span class="line">  --ipv6         -6                   fwmark entry uses IPv6</span><br><span class="line">  --scheduler    -s scheduler         one of rr|wrr|lc|wlc|lblc|lblcr|dh|sh|sed|nq,</span><br><span class="line">                                      the default scheduler is wlc.</span><br><span class="line">  --pe            engine              alternate persistence engine may be sip,</span><br><span class="line">                                      not set by default.</span><br><span class="line">  --persistent   -p [timeout]         persistent service</span><br><span class="line">  --netmask      -M netmask           persistent granularity mask</span><br><span class="line">  --real-server  -r server-address    server-address is host (and port)</span><br><span class="line">  --gatewaying   -g                   gatewaying (direct routing) (default)</span><br><span class="line">  --ipip         -i                   ipip encapsulation (tunneling)</span><br><span class="line">  --masquerading -m                   masquerading (NAT)</span><br><span class="line">  --weight       -w weight            capacity of real server</span><br><span class="line">  --u-threshold  -x uthreshold        upper threshold of connections</span><br><span class="line">  --l-threshold  -y lthreshold        lower threshold of connections</span><br><span class="line">  --mcast-interface interface         multicast interface for connection sync</span><br><span class="line">  --syncid sid                        syncid for connection sync (default=255)</span><br><span class="line">  --connection   -c                   output of current IPVS connections</span><br><span class="line">  --timeout                           output of timeout (tcp tcpfin udp)</span><br><span class="line">  --daemon                            output of daemon information</span><br><span class="line">  --stats                             output of statistics information</span><br><span class="line">  --rate                              output of rate information</span><br><span class="line">  --exact                             expand numbers (display exact values)</span><br><span class="line">  --thresholds                        output of thresholds information</span><br><span class="line">  --persistent-conn                   output of persistent connection info</span><br><span class="line">  --nosort                            disable sorting output of service/server entries</span><br><span class="line">  --sort                              does nothing, for backwards compatibility</span><br><span class="line">  --ops          -o                   one-packet scheduling</span><br><span class="line">  --numeric      -n                   numeric output of addresses and ports</span><br><span class="line">  --sched-flags  -b flags             scheduler flags (comma-separated)</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> lvs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx</title>
      <link href="/2018/11/28/nginx/"/>
      <url>/2018/11/28/nginx/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="High-Performance-Load-Balancing（高可用负载均衡）"><a href="#High-Performance-Load-Balancing（高可用负载均衡）" class="headerlink" title="High-Performance Load Balancing（高可用负载均衡）"></a>High-Performance Load Balancing（高可用负载均衡）</h2><h3 id="1-1-HTTP-Load-Balancing"><a href="#1-1-HTTP-Load-Balancing" class="headerlink" title="1.1 HTTP Load Balancing"></a>1.1 HTTP Load Balancing</h3><ul><li>使用 NGINX 的 HTTP 模块使用 upstream 块在 HTTP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 10.10.12.45:80       weight=1;</span><br><span class="line">    server app.example.com:80   weight=2;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-TCP-Load-Balancing"><a href="#1-2-TCP-Load-Balancing" class="headerlink" title="1.2 TCP Load Balancing"></a>1.2 TCP Load Balancing</h3><ul><li>使用 NGINX 的 stream 模块使用 upstream 块在 TCP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    upstream mysql_read &#123;</span><br><span class="line">        server read1.example.com:3306   weight=5;</span><br><span class="line">        server read2.example.com:3306;</span><br><span class="line">        server 10.10.12.34:3306         backup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 3306;</span><br><span class="line">        proxy_pass mysql_read;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-Load-Balancing-方法"><a href="#1-3-Load-Balancing-方法" class="headerlink" title="1.3 Load-Balancing 方法"></a>1.3 Load-Balancing 方法</h3><ul><li>使用 NGINX 的负载平衡方法之一，例如least_conn, least_time, hash, ip_hash</li></ul><p>这里将后端 upstream 池的负载平衡算法设置为最少连接。所有负载平衡算法（通用散列除外）都将是独立的指令，如前面的示例。通用散列采用单个参数（可以是变量的串联）来构建散列。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server backend.example.com;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并非所有请求或数据包都具有相同的权重。鉴于此，循环，甚至是先前示例中使用的加权循环，将不适合所有应用程序或交通流量的需要。NGINX提供了许多负载平衡算法，可用于适应特定的用例。 这些负载平衡算法或方法不仅可以选择，还可以配置。 以下负载平衡方法可用于 upstream HTTP，TCP 和 UDP 池：</p><ol><li>Round robin（轮询）：<br>默认负载平衡方法，按 upstream 池中服务器列表的顺序分配请求。对于加权循环，可以考虑权重，如果 upstream 服务器的容量变化，则可以使用加权循环。 权重的整数值越高，服务器在循环中的优势就越大。权重背后的算法只是加权平均的统计概率。循环法是默认的负载平衡算法，如果未指定其他算法，则使用该算法。</li><li>Least connections（）：<br>另一种由 NGINX 提供的负载均衡方法。此方法通过将当前请求代理到具有通过 NGINX 代理的最少数量的打开连接的upstream服务器来平衡负载。在决定向哪个服务器发送连接时，最小连接（如循环）也会考虑权重。指令名称为 least_conn。</li><li>Least time（）：<br>仅在 NGINX Plus 中可用，类似于最少连接，因为它代理具有最少数量的当前连接的upstream 服务器，但有利于具有最低平均响应时间的服务器。这种方法是最复杂的负载平衡算法之一，可满足高性能 Web 应用程序的需求。此算法是一个增加最少连接的值，因为少量连接并不一定意味着最快的响应。指令名称为 least_time。</li><li>Generic hash（）：<br>管理员使用给定文本，请求或运行时的变量或两者来定义散列。NGINX 通过为当前请求生成哈希并将其放在 upstream 服务器上来分配服务器之间的负载。当您需要更多地控制发送请求的位置或确定哪些 upstream 服务器最有可能将数据缓存时，此方法非常有用。请注意，在池中添加或删除服务器时，将重新分配散列请求。该算法具有可选参数，一致，以最小化重新分布的影响。指令名称是 hash。</li><li>IP hash（）：<br>仅支持HTTP，是最后一批。IP 哈希使用客户端 IP 地址作为哈希。与在通用散列中使用远程变量略有不同，此算法使用 IPv4 地址的前三个八位字节或整个 IPv6 地址。只要该服务器可用，此方法可确保客户端代理到同一个 upstream 服务器，这在会话状态受到关注且未由应用程序的共享内存处理时非常有用。 在分配散列时，此方法还会考虑权重参数。 指令名称为 ip_hash。</li></ol><h3 id="1-4-Connection-Limiting"><a href="#1-4-Connection-Limiting" class="headerlink" title="1.4 Connection Limiting"></a>1.4 Connection Limiting</h3><ul><li>使用 NGINX Plus 的 max_conns 参数限制 upstream 服务器的连接数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    zone backends 64k;</span><br><span class="line">    queue 750 timeout=30s;</span><br><span class="line"></span><br><span class="line">    server webserver1.example.com max_conns=25;</span><br><span class="line">    server webserver2.example.com max_conns=15;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js 安装指南</title>
      <link href="/2018/11/27/nodejs/"/>
      <url>/2018/11/27/nodejs/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p><a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">https://github.com/creationix/nvm</a></p><p>To install or update nvm, you can use the install script using cURL:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash</span><br></pre></td></tr></table></figure><p>or Wget:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export NVM_DIR="$HOME/.nvm"</span><br><span class="line">[ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh"  # This loads nvm</span><br><span class="line">[ -s "$NVM_DIR/bash_completion" ] &amp;&amp; \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派安装教程</title>
      <link href="/2018/11/26/raspberrypi/"/>
      <url>/2018/11/26/raspberrypi/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="rasbian-网络配置"><a href="#rasbian-网络配置" class="headerlink" title="rasbian 网络配置"></a>rasbian 网络配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line"></span><br><span class="line">auto wlan0</span><br><span class="line">allow-hotplug wlan0</span><br><span class="line">iface wlan0 inet dhcp</span><br><span class="line">wpa-ssid &quot;360WiFi&quot;</span><br><span class="line">wpa-psk &quot;hellworld&quot;</span><br></pre></td></tr></table></figure><h2 id="树莓派安装-docker-ce"><a href="#树莓派安装-docker-ce" class="headerlink" title="树莓派安装 docker-ce"></a>树莓派安装 docker-ce</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">echo &quot;deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list</span><br><span class="line"></span><br><span class="line">apt update</span><br><span class="line"></span><br><span class="line">apt install docker-ce</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> raspberrypi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SELinux</title>
      <link href="/2018/11/25/selinux/"/>
      <url>/2018/11/25/selinux/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-上下文（以-apache-为例）"><a href="#1-上下文（以-apache-为例）" class="headerlink" title="1. 上下文（以 apache 为例）"></a>1. 上下文（以 apache 为例）</h2><h3 id="1）服务器端安装-httpd"><a href="#1）服务器端安装-httpd" class="headerlink" title="1）服务器端安装 httpd"></a>1）服务器端安装 httpd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install httpd</span><br><span class="line">[root@server ~]# systemctl start httpd</span><br><span class="line">[root@server ~]# systemctl enable httpd</span><br></pre></td></tr></table></figure><h3 id="2）查看-httpd-默认目录的上下文"><a href="#2）查看-httpd-默认目录的上下文" class="headerlink" title="2）查看 httpd 默认目录的上下文"></a>2）查看 httpd 默认目录的上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# ls -ldZ /var/www/</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/</span><br></pre></td></tr></table></figure><h3 id="3）设置临时上下文"><a href="#3）设置临时上下文" class="headerlink" title="3）设置临时上下文"></a>3）设置临时上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# mkdir /html</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ /html/</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# chcon -R -t httpd_sys_content_t /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ /html/</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# restorecon -R /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ /html/</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# # --reference 设置和目录相同的上下文</span><br><span class="line">[root@server ~]# chcon -R --reference=/var/www/html /www</span><br></pre></td></tr></table></figure><h3 id="4）设置永久上下文"><a href="#4）设置永久上下文" class="headerlink" title="4）设置永久上下文"></a>4）设置永久上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# semanage fcontext -a -t httpd_sys_content_t &apos;/html(/.*)?&apos;</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ /html</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /html</span><br><span class="line"></span><br><span class="line">[root@server ~]# restorecon -R /html/</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ /html</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /html</span><br></pre></td></tr></table></figure><h2 id="2-布尔值（以-vsftpd-为例）"><a href="#2-布尔值（以-vsftpd-为例）" class="headerlink" title="2. 布尔值（以 vsftpd 为例）"></a>2. 布尔值（以 vsftpd 为例）</h2><ul><li>如果搭建了一个服务，需要在客户端往服务里写东西，但是无法写入，按照以下不走排查<blockquote><p>1）检查配置文件是否允许写<br>2）检查文件系统是否允许写<br>3）检查 selinux （上下文|布尔值）  </p></blockquote></li></ul><h3 id="1-服务端安装-vsftpd"><a href="#1-服务端安装-vsftpd" class="headerlink" title="1)服务端安装 vsftpd"></a>1)服务端安装 vsftpd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install vsftpd</span><br><span class="line">[root@server ~]# systemctl start vsftpd</span><br><span class="line">[root@server ~]# systemctl enable vsftpd</span><br></pre></td></tr></table></figure><h3 id="2）检查配置文件是否允许写"><a href="#2）检查配置文件是否允许写" class="headerlink" title="2）检查配置文件是否允许写"></a>2）检查配置文件是否允许写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 允许匿名上传</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br></pre></td></tr></table></figure><h3 id="3）检查文件系统是否允许写"><a href="#3）检查文件系统是否允许写" class="headerlink" title="3）检查文件系统是否允许写"></a>3）检查文件系统是否允许写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# ls -ld /var/ftp/</span><br><span class="line">drwxr-xr-x. 4 root root 27 8月  17 14:29 /var/ftp/</span><br><span class="line"></span><br><span class="line">[root@server ~]# cd /var/ftp/</span><br><span class="line"></span><br><span class="line">[root@server ftp]# mkdir test</span><br><span class="line"></span><br><span class="line">[root@server ftp]# chown -R ftp.ftp test</span><br><span class="line"></span><br><span class="line">[root@server ftp]# ls -ld test</span><br><span class="line">drwxr-xr-x. 2 ftp ftp 6 8月  17 14:48 test</span><br></pre></td></tr></table></figure><h3 id="4）检查-selinux-（上下文-布尔值）"><a href="#4）检查-selinux-（上下文-布尔值）" class="headerlink" title="4）检查 selinux （上下文|布尔值）"></a>4）检查 selinux （上下文|布尔值）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# getsebool -a | grep ftp</span><br><span class="line">ftpd_anon_write --&gt; off</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; off</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br><span class="line"></span><br><span class="line">[root@server ftp]# setsebool -P ftpd_anon_write on</span><br><span class="line"></span><br><span class="line">[root@server ftp]# setsebool -P ftpd_full_access on</span><br><span class="line"></span><br><span class="line">[root@server ~]# getsebool -a | grep ftp</span><br><span class="line">ftpd_anon_write --&gt; on</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; on</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> selinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Subversion 安装与配置</title>
      <link href="/2018/11/24/svn/"/>
      <url>/2018/11/24/svn/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-Subversion"><a href="#1-安装-Subversion" class="headerlink" title="1. 安装 Subversion"></a>1. 安装 Subversion</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y subversion</span><br></pre></td></tr></table></figure><h2 id="2-创建-SVN-版本库"><a href="#2-创建-SVN-版本库" class="headerlink" title="2. 创建 SVN 版本库"></a>2. 创建 SVN 版本库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/svn/myproject</span><br><span class="line">svnadmin create /data/svn/myproject</span><br></pre></td></tr></table></figure><h2 id="3-配置-SVN-信息"><a href="#3-配置-SVN-信息" class="headerlink" title="3. 配置 SVN 信息"></a>3. 配置 SVN 信息</h2><h3 id="配置文件简介"><a href="#配置文件简介" class="headerlink" title="配置文件简介"></a>配置文件简介</h3><p>版本库中的配置目录 conf 有三个文件:</p><ul><li>authz 是权限控制文件  </li><li>passwd 是帐号密码文件  </li><li>svnserve.conf 是SVN服务综合配置文件  </li></ul><p>配置权限配置文件 authz<br><strong>示例代码：/data/svn/myproject/conf/authz</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[groups]            </span><br><span class="line">#用户组</span><br><span class="line">admin = admin,root,test  </span><br><span class="line">#用户组所对应的用户</span><br><span class="line">[/]                 </span><br><span class="line">#库目录权限</span><br><span class="line">@admin = rw         </span><br><span class="line">#用户组权限</span><br><span class="line">*=r               </span><br><span class="line">#非用户组权限</span><br></pre></td></tr></table></figure><p>配置账号密码文件 passwd<br><strong>示例代码：/data/svn/myproject/conf/passwd</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[users]</span><br><span class="line"># harry = harryssecret</span><br><span class="line"># sally = sallyssecret</span><br><span class="line">admin = 123456</span><br><span class="line">root = 123456</span><br><span class="line">test = 123456</span><br></pre></td></tr></table></figure><p>配置 SVN 服务综合配置文件 svnserve.conf<br><strong>示例代码：/data/svn/myproject/conf/svnserve.conf</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line"># force-username-case = none</span><br><span class="line"># 匿名访问的权限 可以是read、write，none，默认为read</span><br><span class="line">anon-access = none</span><br><span class="line">#使授权用户有写权限</span><br><span class="line">auth-access = write</span><br><span class="line">#密码数据库的路径</span><br><span class="line">password-db = passwd</span><br><span class="line">#访问控制文件</span><br><span class="line">authz-db = authz</span><br><span class="line">#认证命名空间，SVN会在认证提示里显示，并且作为凭证缓存的关键字</span><br><span class="line">realm = /data/svn/myproject</span><br><span class="line"></span><br><span class="line">[sasl]</span><br></pre></td></tr></table></figure><h2 id="4-启动-SVN-服务"><a href="#4-启动-SVN-服务" class="headerlink" title="4. 启动 SVN 服务"></a>4. 启动 SVN 服务</h2><h3 id="启动-SVN"><a href="#启动-SVN" class="headerlink" title="启动 SVN"></a>启动 SVN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnserve -d -r /data/svn</span><br></pre></td></tr></table></figure><h3 id="checkout-SVN项目"><a href="#checkout-SVN项目" class="headerlink" title="checkout SVN项目"></a>checkout SVN项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/workspace/myproject</span><br><span class="line">svn co svn://127.0.0.1/myproject /data/workspace/myproject --username root --password 123456 --force --no-auth-cache</span><br></pre></td></tr></table></figure><h3 id="提交文件到-SVN-服务器"><a href="#提交文件到-SVN-服务器" class="headerlink" title="提交文件到 SVN 服务器"></a>提交文件到 SVN 服务器</h3><p>从本地提交文件到 SVN 服务器，其中 root 密码为 /data/svn/myproject/conf/passwd 文件存储的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /data/workspace/myproject</span><br><span class="line">echo test &gt;&gt; test.txt</span><br><span class="line">svn add test.txt</span><br><span class="line">svn commit test.txt -m &apos;test&apos;</span><br></pre></td></tr></table></figure><p>提交成功后可以通过如下命令从本地项目删除文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/workspace/myproject</span><br><span class="line">rm -rf test.txt</span><br></pre></td></tr></table></figure><p>删除后可以通过 SVN 服务器恢复</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/workspace/myproject</span><br><span class="line">svn update</span><br></pre></td></tr></table></figure><p>清除SVN客户端密码方法：<br>邮件选择TortoiseSVN中的settings选项—Saved Data—右边会发现有个Authentication data,点击clear，即完成清空账号密码操作，确认即可。下次就会自动弹出登录框。</p><p>在eclipse的svn插件中，我们也会保存密码，那么要清除时，换账号登录，就稍微麻烦点：</p><ol><li><p>查看你的Eclipse中使用的是什么SVN 接口<br>windows &gt; preference &gt; Team &gt; SVN</p></li><li><p>如果是用的JavaHL, 找到以下目录并删除auth目录.<br>C:\Documents and Settings\User\Application Data\Subversion\</p></li><li><p>如果你用的SVNKit, 找到以下目录并删除.keyring文件.<br>eclipse\configuration\org.eclipse.core.runtime\</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> svn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 网络配置</title>
      <link href="/2018/11/23/ubuntuserver/"/>
      <url>/2018/11/23/ubuntuserver/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-查看所有网卡信息"><a href="#1-查看所有网卡信息" class="headerlink" title="1. 查看所有网卡信息"></a>1. 查看所有网卡信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure><h2 id="2-修改网卡配置文件"><a href="#2-修改网卡配置文件" class="headerlink" title="2. 修改网卡配置文件"></a>2. 修改网卡配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/network/interfaces</span><br></pre></td></tr></table></figure><ul><li>DHCP</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet dhcp</span><br></pre></td></tr></table></figure><ul><li>STATIC</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet static</span><br><span class="line"><span class="comment"># 克隆 mac 地址</span></span><br><span class="line"><span class="comment"># pre-up ifconfig ens33 hw ether &lt;MACADDR&gt; </span></span><br><span class="line">address &lt;IPADDR&gt;</span><br><span class="line">gateway &lt;GATEWAY&gt;</span><br><span class="line">netmask &lt;NETMASK&gt;</span><br><span class="line"><span class="comment"># network &lt;NETWORK&gt;</span></span><br><span class="line"><span class="comment"># broadcast &lt;BROADCAST&gt;</span></span><br><span class="line">dns-nameservers &lt;DNS&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim</title>
      <link href="/2018/11/22/vim/"/>
      <url>/2018/11/22/vim/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="编辑文件-etc-vimrc"><a href="#编辑文件-etc-vimrc" class="headerlink" title="编辑文件 /etc/vimrc"></a>编辑文件 /etc/vimrc</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">autocmd BufNewFile *.py,*.sh,*, exec &quot;:call SetTitle()&quot;</span><br><span class="line">let $author_name = &quot;jeremy&quot;</span><br><span class="line">let $filetype_name = strpart(expand(&quot;%&quot;), stridx(expand(&quot;%&quot;), &quot;.&quot;))</span><br><span class="line">let $file_name = strpart(expand(&quot;%&quot;), 0, stridx(expand(&quot;%&quot;), &quot;.&quot;))</span><br><span class="line"></span><br><span class="line">func SetTitle()</span><br><span class="line">if &amp;filetype == &apos;sh&apos;</span><br><span class="line">call setline(1, &quot;\#!/bin/bash&quot;)</span><br><span class="line">call setline(2, &quot;\# writen by: &quot;.$author_name)</span><br><span class="line">call setline(3, &quot;\# file name: &quot;.$file_name.$filetype_name)</span><br><span class="line">endif</span><br><span class="line">endfunc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VirtualBox 遇到的问题</title>
      <link href="/2018/11/21/virtualbox/"/>
      <url>/2018/11/21/virtualbox/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1、引导界面修改"><a href="#1、引导界面修改" class="headerlink" title="1、引导界面修改"></a>1、引导界面修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Shell&gt; FS0:</span><br><span class="line">FS0:\&gt; cd EFI</span><br><span class="line">FS0:\EFI&gt; cp centos\grubx64.efi BOOT\grubx64.efi</span><br></pre></td></tr></table></figure><h2 id="2、系统界面修改"><a href="#2、系统界面修改" class="headerlink" title="2、系统界面修改"></a>2、系统界面修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /boot/efi/EFI/centos/grubx64.efi /boot/efi/EFI/BOOT/grubx64.efi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> virtualbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FTP 教程</title>
      <link href="/2018/11/20/vsftpd/"/>
      <url>/2018/11/20/vsftpd/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-vsftpd"><a href="#1-安装-vsftpd" class="headerlink" title="1. 安装 vsftpd"></a>1. 安装 vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 selinux 状态</span></span><br><span class="line">getenforce</span><br><span class="line"><span class="comment"># 查看防火墙状态</span></span><br><span class="line">service firewalld status</span><br><span class="line"><span class="comment"># 安装 vsftpd</span></span><br><span class="line">yum -y install vsftpd</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br><span class="line"><span class="comment"># 启动 vsftpd 服务</span></span><br><span class="line">systemctl start vsftpd</span><br><span class="line"><span class="comment"># 防火墙开放 ftp 服务</span></span><br><span class="line">firewall-cmd --add-service=ftp --permanent</span><br><span class="line"><span class="comment"># 查看和更改 ftp 的 sebool 值</span></span><br><span class="line">getsebool -a | grep ftp</span><br><span class="line">setsebool ftpd_full_access on</span><br></pre></td></tr></table></figure><h2 id="2-配置-vsftpd"><a href="#2-配置-vsftpd" class="headerlink" title="2. 配置 vsftpd"></a>2. 配置 vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure><p>vsftpd.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 不允许匿名访问 ftp</span><br><span class="line">anonymous_enable=NO</span><br><span class="line"># 用户不允许切换上级目录</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line"># 设置时区</span><br><span class="line">use_localtime=YES</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改配置后重启 vsftpd</span></span><br><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure><h2 id="3-创建用户"><a href="#3-创建用户" class="headerlink" title="3. 创建用户"></a>3. 创建用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用户 [username]，不允许登陆，家目录为 [directory]</span></span><br><span class="line">useradd -s /sbin/nologin -m -d [directory] [username]</span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[password]"</span> | passwd --stdin [username]</span><br></pre></td></tr></table></figure><h2 id="4-验证"><a href="#4-验证" class="headerlink" title="4. 验证"></a>4. 验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 ftp 客户端</span></span><br><span class="line">yum -y install ftp</span><br><span class="line"><span class="comment"># 连接 ftp 服务器</span></span><br><span class="line">ftp [ip]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows LinuxSubSystem</title>
      <link href="/2018/11/19/wsl/"/>
      <url>/2018/11/19/wsl/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="安装-oh-my-zsh"><a href="#安装-oh-my-zsh" class="headerlink" title="安装 oh-my-zsh"></a>安装 <a href="https://ohmyz.sh/" target="_blank" rel="noopener">oh-my-zsh</a></h2><ul><li><p>curl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span><br></pre></td></tr></table></figure></li><li><p>wget</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c "$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)"</span><br></pre></td></tr></table></figure></li></ul><h2 id="更改默认-shell"><a href="#更改默认-shell" class="headerlink" title="更改默认 shell"></a>更改默认 shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s $(which zsh)</span><br></pre></td></tr></table></figure><h2 id="更改主题"><a href="#更改主题" class="headerlink" title="更改主题"></a>更改主题</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><p><img src="images/zshrc.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=&quot;agnoster&quot;</span><br><span class="line">DEFAULT_USER=&quot;jeremy&quot;</span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><blockquote><p>字体问题导致显示异常</p></blockquote><p><img src="images/zshlostfonts.png" alt></p><p>解决办法：Windows 环境安装 powerline-fonts 并设置控制台字体<br><a href="https://github.com/powerline/fonts.git" target="_blank" rel="noopener">https://github.com/powerline/fonts.git</a></p><p><img src="images/setpowerlinefonts.png" alt></p><blockquote><p>启动vim的时候会出现字体变回原来的新宋体的情况：</p></blockquote><p>win + R -&gt; 运行 -&gt; <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">HKEY_CURRENT_USER\Console\C:_Program Files_WindowsApps_CanonicalGroupLimited.Ubuntu18.04onWindows_1804.2018.817.0_x64__79rhkp1fndgsc_ubuntu1804.exe</span><br></pre></td></tr></table></figure></p><p>添加：CodePage (DWORD (32) 类型、值 0x01b5)</p><p><img src="images/regedit.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> wsl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix Proxy 分布式监控</title>
      <link href="/2018/11/18/zabbix%20_proxy/"/>
      <url>/2018/11/18/zabbix%20_proxy/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-MySQL、Zabbix-Prorxy"><a href="#1-安装-MySQL、Zabbix-Prorxy" class="headerlink" title="1. 安装 MySQL、Zabbix Prorxy"></a>1. 安装 MySQL、Zabbix Prorxy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 MySQL</span></span><br><span class="line">apt install mysql-server</span><br><span class="line"><span class="comment"># 安装 zabbix proxy</span></span><br><span class="line">wget https://repo.zabbix.com/zabbix/3.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.4-1+xenial_all.deb</span><br><span class="line">dpkg -i zabbix-release_3.4-1+xenial_all.deb</span><br><span class="line">apt update</span><br><span class="line">apt install zabbix-server-mysql zabbix-agent zabbix-proxy-mysql zabbix-get zabbix-sender</span><br></pre></td></tr></table></figure><h2 id="2-导入数据"><a href="#2-导入数据" class="headerlink" title="2. 导入数据"></a>2. 导入数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建 zabbix_proxy 数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> zabbix_proxy <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin;</span><br><span class="line"><span class="comment">--授权</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> zabbix_proxy.* <span class="keyword">to</span> zabbix@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'password'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql/schema.sql.gz | mysql -uzabbix -pzabbix zabbix</span><br></pre></td></tr></table></figure><h2 id="3-更改配置"><a href="#3-更改配置" class="headerlink" title="3. 更改配置"></a>3. 更改配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_proxy.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Server=192.168.6.30</span><br><span class="line">Hostname=Zabbix proxy</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_proxy.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_proxy.pid</span><br><span class="line">SocketDir=/var/run/zabbix</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line">ConfigFrequency=120</span><br><span class="line">DataSenderFrequency=1</span><br><span class="line">SNMPTrapperFile=/var/log/snmptrap/snmptrap.log</span><br><span class="line">Timeout=30</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class="line">FpingLocation=/usr/bin/fping</span><br><span class="line">Fping6Location=/usr/bin/fping6</span><br><span class="line">LogSlowQueries=3000</span><br></pre></td></tr></table></figure><h2 id="4-启动服务并设置开机启动"><a href="#4-启动服务并设置开机启动" class="headerlink" title="4. 启动服务并设置开机启动"></a>4. 启动服务并设置开机启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> zabbix-proxy zabbix-agent mysql</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 安装指南</title>
      <link href="/2018/11/17/zabbix_installation/"/>
      <url>/2018/11/17/zabbix_installation/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="CentOS-安装-zabbix3-4"><a href="#CentOS-安装-zabbix3-4" class="headerlink" title="CentOS 安装 zabbix3.4"></a>CentOS 安装 zabbix3.4</h2><h3 id="1-准备"><a href="#1-准备" class="headerlink" title="1. 准备"></a>1. 准备</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -i http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br><span class="line">yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br><span class="line">yum -y install php-fpm php php-mysql php-gd php-bcmath php-mbstring php-xml php-ldap</span><br></pre></td></tr></table></figure><h3 id="2-设置数据库"><a href="#2-设置数据库" class="headerlink" title="2. 设置数据库"></a>2. 设置数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqladmin -u root password 123456</span><br><span class="line">mysql -uroot -p</span><br><span class="line">password</span><br><span class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;zabbix&apos;;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure><h3 id="3-数据库导入数据"><a href="#3-数据库导入数据" class="headerlink" title="3. 数据库导入数据"></a>3. 数据库导入数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span><br></pre></td></tr></table></figure><h3 id="4-修改-zabbix-配置文件增加-DBPassword-zabbix"><a href="#4-修改-zabbix-配置文件增加-DBPassword-zabbix" class="headerlink" title="4. 修改 zabbix 配置文件增加 DBPassword=zabbix"></a>4. 修改 zabbix 配置文件增加 DBPassword=zabbix</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBPassword=zabbix</span><br></pre></td></tr></table></figure><h3 id="5-将时区设置为：亚洲-上海"><a href="#5-将时区设置为：亚洲-上海" class="headerlink" title="5. 将时区设置为：亚洲/上海"></a>5. 将时区设置为：亚洲/上海</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">php_value date.timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="6-启动服务，将服务设为开机启动"><a href="#6-启动服务，将服务设为开机启动" class="headerlink" title="6. 启动服务，将服务设为开机启动"></a>6. 启动服务，将服务设为开机启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-server zabbix-agent httpd</span><br><span class="line">systemctl enable zabbix-server zabbix-agent httpd</span><br></pre></td></tr></table></figure><h3 id="7-修改默认语言，文字配置"><a href="#7-修改默认语言，文字配置" class="headerlink" title="7. 修改默认语言，文字配置"></a>7. 修改默认语言，文字配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/share/zabbix/include/locales.inc.php</span><br><span class="line">cp simkai.ttf /usr/share/zabbix/fonts/</span><br><span class="line">vim /usr/share/zabbix/include/defines.inc.php</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 通过 jmx 监控 Tomcat</title>
      <link href="/2018/11/16/zabbix_jmx/"/>
      <url>/2018/11/16/zabbix_jmx/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-安装-jdk-和-zabbix-java-gateway"><a href="#1-安装-jdk-和-zabbix-java-gateway" class="headerlink" title="1. 安装 jdk 和 zabbix-java-gateway"></a>1. 安装 jdk 和 zabbix-java-gateway</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 openjdk 或者下载 tar.gz</span></span><br><span class="line">apt install openjdk-8-jdk</span><br><span class="line"><span class="comment"># 安装 zabbix-java-gateway</span></span><br><span class="line">apt install zabbix-java-gateway</span><br></pre></td></tr></table></figure><h2 id="2-修改服务器端配置"><a href="#2-修改服务器端配置" class="headerlink" title="2. 修改服务器端配置"></a>2. 修改服务器端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JavaGateway=192.168.6.30</span><br><span class="line">JavaGatewayPort=10052</span><br><span class="line">StartJavaPollers=50</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-server</span><br><span class="line">systemctl start zabbix-java-gateway</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-java-gateway</span><br></pre></td></tr></table></figure><h2 id="3-配置被监控-tomcat"><a href="#3-配置被监控-tomcat" class="headerlink" title="3. 配置被监控 tomcat"></a>3. 配置被监控 tomcat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /tomcat/bin/catalina.sh</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CATALINA_OPTS=<span class="string">"-Djava.rmi.server.hostname=&lt; 被监控 tomcat 主机 IP 地址 &gt; -Djavax.management.builder.initial= -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false"</span></span><br></pre></td></tr></table></figure><p>更改完成之后重启 tomcat 应用</p><h2 id="4-zabbix-web-配置"><a href="#4-zabbix-web-配置" class="headerlink" title="4. zabbix web 配置"></a>4. zabbix web 配置</h2><ul><li>添加被监控 tomcat</li></ul>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tomcat </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 通过 SNMP 进行监控</title>
      <link href="/2018/11/15/zabbix_snmp/"/>
      <url>/2018/11/15/zabbix_snmp/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h1 id="SNMP-监控-Linux"><a href="#SNMP-监控-Linux" class="headerlink" title="SNMP 监控 Linux"></a>SNMP 监控 Linux</h1><h2 id="1-被监控主机安装-net-snmp"><a href="#1-被监控主机安装-net-snmp" class="headerlink" title="1. 被监控主机安装 net-snmp"></a>1. 被监控主机安装 net-snmp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# yum install -y net-snmp</span><br></pre></td></tr></table></figure><h2 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2. 修改配置文件"></a>2. 修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vim /etc/snmp/snmpd.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># sec.name  source          community</span><br><span class="line">com2sec notConfigUser  default       public</span><br><span class="line"></span><br><span class="line">view    systemview    included   .1</span><br><span class="line">view    systemview    included   .1.3.6.1.2.1.1</span><br><span class="line">view    systemview    included   .1.3.6.1.2.1.25.1.1</span><br></pre></td></tr></table></figure><h2 id="3-启动"><a href="#3-启动" class="headerlink" title="3. 启动"></a>3. 启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# systemctl start snmpd.service</span><br><span class="line">[root@client ~]# netstat -nlp | grep 161</span><br></pre></td></tr></table></figure><h2 id="4-在-zabbix-server-上测试"><a href="#4-在-zabbix-server-上测试" class="headerlink" title="4. 在 zabbix server 上测试"></a>4. 在 zabbix server 上测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# yum install -y net-snmp</span><br><span class="line">[root@zabbix ~]# snmpwalk -v 2c -c zabbix 192.168.1.51 | wc -l</span><br></pre></td></tr></table></figure><h2 id="5-zabbix的web界面添加主机"><a href="#5-zabbix的web界面添加主机" class="headerlink" title="5. zabbix的web界面添加主机"></a>5. zabbix的web界面添加主机</h2><ul><li>添加模板</li></ul><p><img src="!--%EF%BF%BC15--" alt></p><ul><li>设置 communities</li></ul><p><img src="!--%EF%BF%BC16--" alt></p><h1 id="SNMP-监控-ESXI"><a href="#SNMP-监控-ESXI" class="headerlink" title="SNMP 监控 ESXI"></a>SNMP 监控 ESXI</h1><h2 id="1-开启-ESXI-的-SNMP-服务（允许所有主机访问）"><a href="#1-开启-ESXI-的-SNMP-服务（允许所有主机访问）" class="headerlink" title="1. 开启 ESXI 的 SNMP 服务（允许所有主机访问）"></a>1. 开启 ESXI 的 SNMP 服务（允许所有主机访问）</h2><ul><li>设置 communities</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli system snmp set --communities public</span><br></pre></td></tr></table></figure><ul><li>开启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli system snmp set --enable true</span><br></pre></td></tr></table></figure><ul><li>允许所有主机访问 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all true</span><br><span class="line">Already allowed all ip</span><br></pre></td></tr></table></figure><ul><li>设置防火墙</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true</span><br></pre></td></tr></table></figure><ul><li>重启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] /etc/init.d/snmpd restart</span><br><span class="line">root: snmpd Running from interactive shell, running command: esxcli system snmp set -e false.</span><br><span class="line">root: snmpd setting up resource reservations.</span><br><span class="line">root: snmpd opening firewall port(s) for notifications.</span><br><span class="line">root: snmpd watchdog for snmpd started.</span><br></pre></td></tr></table></figure><h2 id="2-开启-ESXI-主机的-SNMP-服务（允许特定主机访问）"><a href="#2-开启-ESXI-主机的-SNMP-服务（允许特定主机访问）" class="headerlink" title="2. 开启 ESXI 主机的 SNMP 服务（允许特定主机访问）"></a>2. 开启 ESXI 主机的 SNMP 服务（允许特定主机访问）</h2><ul><li>禁止所有主机访问 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all false</span><br></pre></td></tr></table></figure><ul><li>设置防火墙</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset allowedip add --ruleset-id snmp --ip-address 10.0.101.0/24</span><br><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true</span><br></pre></td></tr></table></figure><ul><li>重启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] /etc/init.d/snmpd restart</span><br></pre></td></tr></table></figure><h2 id="3-测试是否能获取-SNMP-数据"><a href="#3-测试是否能获取-SNMP-数据" class="headerlink" title="3. 测试是否能获取 SNMP 数据"></a>3. 测试是否能获取 SNMP 数据</h2><ul><li>在其他服务器上安装 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# yum -y install net-snmp net-snmp-utils net-snmp-devel</span><br></pre></td></tr></table></figure><ul><li>测试获取信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# snmpwalk -v 2c -c sunwoda 192.168.9.24:161 | wc -l</span><br><span class="line">4594</span><br></pre></td></tr></table></figure><h2 id="4-Zabbix-添加主机"><a href="#4-Zabbix-添加主机" class="headerlink" title="4. Zabbix 添加主机"></a>4. Zabbix 添加主机</h2><ul><li>添加模板</li></ul><p><img src="!--%EF%BF%BC17--" alt></p><ul><li>设置 communities</li></ul><p><img src="!--%EF%BF%BC18--" alt></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 企业微信告警</title>
      <link href="/2018/11/14/zabbix_wechat_alert/"/>
      <url>/2018/11/14/zabbix_wechat_alert/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="1-编辑-zabbix-server-conf-配置-zabbix-告警脚本路径"><a href="#1-编辑-zabbix-server-conf-配置-zabbix-告警脚本路径" class="headerlink" title="1. 编辑 zabbix_server.conf 配置 zabbix 告警脚本路径"></a>1. 编辑 zabbix_server.conf 配置 zabbix 告警脚本路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AlertScriptsPath=/usr/local/share/zabbix/alertscripts/</span><br></pre></td></tr></table></figure><h2 id="2-创建发送消息脚本"><a href="#2-创建发送消息脚本" class="headerlink" title="2. 创建发送消息脚本"></a>2. 创建发送消息脚本</h2><ul><li>编写脚本 vim wechat.py</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 基本信息</span></span><br><span class="line">CropID = <span class="string">'xxxxxxxxxx'</span></span><br><span class="line">Secret = <span class="string">'xxxxxxxxxx'</span></span><br><span class="line">agentid = <span class="string">'xxxxxxxxx'</span></span><br><span class="line">touser = <span class="string">'xxxxxxxxxx'</span> </span><br><span class="line"><span class="comment"># 获取Token</span></span><br><span class="line">GetToken =<span class="string">"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid="</span>+ CropID + <span class="string">"&amp;corpsecret="</span> + Secret</span><br><span class="line">headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">json_data = json.loads(requests.get(GetToken).content.decode())</span><br><span class="line">token = json_data[<span class="string">"access_token"</span>]</span><br><span class="line"><span class="comment"># 消息发送接口</span></span><br><span class="line">Purl = <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token="</span> + token</span><br><span class="line"><span class="comment"># 消息发送函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendmsg</span><span class="params">(message)</span>:</span></span><br><span class="line">    weixin_msg = &#123;</span><br><span class="line">        <span class="string">"touser"</span> : <span class="string">"TangYingJie"</span>,         </span><br><span class="line">        <span class="string">"msgtype"</span> : <span class="string">"text"</span>,</span><br><span class="line">        <span class="string">"agentid"</span> : <span class="number">1000002</span>,</span><br><span class="line">        <span class="string">"text"</span> : &#123;</span><br><span class="line">            <span class="string">"content"</span> : message</span><br><span class="line">         &#125;,</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">print</span> requests.post(Purl,json.dumps(weixin_msg),headers=headers)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    message = sys.argv[<span class="number">1</span>]      <span class="comment">#获取第二个参数</span></span><br><span class="line">    sendmsg(message)</span><br></pre></td></tr></table></figure><ul><li>测试脚本发送消息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./wechat.py 测试消息</span><br></pre></td></tr></table></figure><h2 id="3-进入-zabbix-主界面配置"><a href="#3-进入-zabbix-主界面配置" class="headerlink" title="3. 进入 zabbix 主界面配置"></a>3. 进入 zabbix 主界面配置</h2><h3 id="报警媒介类型"><a href="#报警媒介类型" class="headerlink" title="报警媒介类型"></a>报警媒介类型</h3><p><img src="!--%EF%BF%BC5--" alt></p><h3 id="用户-gt-报警媒介"><a href="#用户-gt-报警媒介" class="headerlink" title="用户 -&gt; 报警媒介"></a>用户 -&gt; 报警媒介</h3><p><img src="!--%EF%BF%BC6--" alt></p><h3 id="动作-gt-操作"><a href="#动作-gt-操作" class="headerlink" title="动作 -&gt; 操作"></a>动作 -&gt; 操作</h3><p><img src="!--%EF%BF%BC7--" alt></p><ul><li>默认接收人</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;TRIGGER.STATUS&#125; : &#123;TRIGGER.NAME&#125;</span><br></pre></td></tr></table></figure><ul><li>默认信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">当前状态 : &#123;TRIGGER.STATUS&#125;</span><br><span class="line">告警主机 : &#123;HOST.NAME&#125;</span><br><span class="line">告警地址 : &#123;HOST.IP&#125;</span><br><span class="line">告警时间 : &#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">告警等级 : &#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">告警信息 : &#123;TRIGGER.NAME&#125;</span><br><span class="line">监控取值 : &#123;ITEM.VALUE&#125;</span><br><span class="line">监控项目 : &#123;ITEM.NAME&#125;</span><br><span class="line">持续时间 : &#123;EVENT.AGE&#125;</span><br><span class="line">事件ID : &#123;ITEM.ID&#125;</span><br></pre></td></tr></table></figure><h3 id="动作-gt-恢复操作"><a href="#动作-gt-恢复操作" class="headerlink" title="动作 -&gt; 恢复操作"></a>动作 -&gt; 恢复操作</h3><p><img src="!--%EF%BF%BC8--" alt></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> python </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
