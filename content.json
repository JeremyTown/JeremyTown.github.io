{"meta":{"title":"ä½ çš„ğŸŒ›æˆ‘çš„â¤ï¸","subtitle":null,"description":null,"author":"Jeremy","url":"http://yoursite.com","root":"/"},"pages":[{"title":"about","date":"2019-07-23T07:44:29.000Z","updated":"2019-07-23T08:12:55.960Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":""}],"posts":[{"title":"Git æŒ‡å—","slug":"git","date":"2019-05-25T16:00:00.000Z","updated":"2019-07-23T07:19:40.893Z","comments":true,"path":"2019/05/26/git/","link":"","permalink":"http://yoursite.com/2019/05/26/git/","excerpt":"","text":"1. è·å– Git ä»“åº“åœ¨ç°æœ‰ç›®å½•ä¸­åˆå§‹åŒ–ä»“åº“1git init å…‹éš†ç°æœ‰çš„ä»“åº“1git clone https://github.com/libgit2/libgit2 mylibgit 2. è®°å½•æ¯æ¬¡æ›´æ–°åˆ°ä»“åº“æ£€æŸ¥å½“å‰æ–‡ä»¶çŠ¶æ€1git status è·Ÿè¸ªæ–°æ–‡ä»¶12git add READMEgit status æš‚å­˜å·²ä¿®æ”¹æ–‡ä»¶çŠ¶æ€ç®€è§ˆ12git status --shortgit status -s å¿½ç•¥æ–‡ä»¶ä½¿ç”¨ .gitignore æ–‡ä»¶ æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥ ï¼ƒ å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚ å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ glob æ¨¡å¼åŒ¹é…ã€‚ åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰å¼€å¤´é˜²æ­¢é€’å½’ã€‚ åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰ç»“å°¾æŒ‡å®šç›®å½•ã€‚ è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸ŠæƒŠå¹å·ï¼ˆ!ï¼‰å–åã€‚ glob æ¨¡å¼ æ˜Ÿå·ï¼ˆ*ï¼‰åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼› [abc] åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦ï¼› é—®å·ï¼ˆ?ï¼‰åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼› å¦‚æœåœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨çŸ­åˆ’çº¿åˆ†éš”ä¸¤ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºæ‰€æœ‰åœ¨è¿™ä¸¤ä¸ªå­—ç¬¦èŒƒå›´å†…çš„éƒ½å¯ä»¥åŒ¹é…ï¼› ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå·ï¼ˆ*) è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸­é—´ç›®å½•ã€‚ æŸ¥çœ‹å·²æš‚å­˜å’Œæœªæš‚å­˜çš„ä¿®æ”¹ æŸ¥çœ‹å°šæœªæš‚å­˜çš„æ–‡ä»¶æ›´æ–°äº†å“ªäº›éƒ¨åˆ† 1git diff æŸ¥çœ‹å·²æš‚å­˜çš„å°†è¦æ·»åŠ åˆ°ä¸‹æ¬¡æäº¤é‡Œçš„å†…å®¹ 12git diff --stagedgit diff --cached æäº¤æ›´æ–°1git commit -m \"first commit\" è·³è¿‡ä½¿ç”¨æš‚å­˜åŒºåŸŸ1git commit -a -m \"second commit\" ç§»é™¤æ–‡ä»¶1git rm [file_name] æŠŠæ–‡ä»¶ä» Git ä»“åº“ä¸­åˆ é™¤ï¼Œæ–‡ä»¶ä¿ç•™åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­ 1git rm --cached [file_name] ç§»åŠ¨æ–‡ä»¶1git mv file_from file_to 3. æŸ¥çœ‹æäº¤å†å²1git log 12345678git log -p -2 # -p æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å†…å®¹å·®å¼‚ï¼Œ-2 ä»…æ˜¾ç¤ºæœ€è¿‘ä¸¤æ¬¡æäº¤git log --stat # æŸ¥çœ‹æäº¤çš„ç®€ç•¥çš„ç»Ÿè®¡ä¿¡æ¯git log --oneline # å°†æ¯ä¸ªæäº¤æ”¾åœ¨ä¸€è¡Œæ˜¾ç¤ºgit log --shortgit log --fullgit log --fullergit log --pretty=onlinegit log --pretty=format:\"%h - %an, %ar : %s\" --graph # å®šåˆ¶è¦æ˜¾ç¤ºçš„è®°å½•æ ¼å¼ git log å¸¸ç”¨é€‰é¡¹ é€‰é¡¹ è¯´æ˜ -p æŒ‰è¡¥ä¸æ ¼å¼æ˜¾ç¤ºæ¯ä¸ªæ›´æ–°ä¹‹é—´çš„å·®å¼‚ â€“stat æ˜¾ç¤ºæ¯æ¬¡æ›´æ–°çš„æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡ä¿¡æ¯ã€‚ â€“shortstat åªæ˜¾ç¤º â€“stat ä¸­æœ€åçš„è¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤ç»Ÿè®¡ã€‚ â€“name-only ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•ã€‚ â€“name-status æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•ã€‚ â€“abbrev-commit ä»…æ˜¾ç¤º SHA-1 çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„ 40 ä¸ªå­—ç¬¦ã€‚ â€“relative-date ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ2 weeks agoâ€ï¼‰ã€‚ â€“graph æ˜¾ç¤º ASCII å›¾å½¢è¡¨ç¤ºçš„åˆ†æ”¯åˆå¹¶å†å²ã€‚ â€“pretty ä½¿ç”¨å…¶ä»–æ ¼å¼æ˜¾ç¤ºå†å²æäº¤ä¿¡æ¯ã€‚å¯ç”¨çš„é€‰é¡¹åŒ…æ‹¬ onelineï¼Œshortï¼Œfullï¼Œfuller å’Œ formatï¼ˆåè·ŸæŒ‡å®šæ ¼å¼ï¼‰ã€‚ git log --pretty=format å¸¸ç”¨çš„é€‰é¡¹ é€‰é¡¹ è¯´æ˜ %H æäº¤å¯¹è±¡ï¼ˆcommitï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸² %h æäº¤å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸² %T æ ‘å¯¹è±¡ï¼ˆtreeï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸² %t æ ‘å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸² %P çˆ¶å¯¹è±¡ï¼ˆparentï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸² %p çˆ¶å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸² %an ä½œè€…ï¼ˆauthorï¼‰çš„åå­— %ae ä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€ %ad ä½œè€…ä¿®è®¢æ—¥æœŸï¼ˆå¯ä»¥ç”¨ â€“date= é€‰é¡¹å®šåˆ¶æ ¼å¼ï¼‰ %ar ä½œè€…ä¿®è®¢æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º %cn æäº¤è€…ï¼ˆcommitterï¼‰çš„åå­— %ce æäº¤è€…çš„ç”µå­é‚®ä»¶åœ°å€ %cd æäº¤æ—¥æœŸ %cr æäº¤æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º %s æäº¤è¯´æ˜ é™åˆ¶è¾“å‡ºé•¿åº¦1git log --since=2.weeks é™åˆ¶ git log è¾“å‡ºçš„é€‰é¡¹ é€‰é¡¹ è¯´æ˜ -(n) ä»…æ˜¾ç¤ºæœ€è¿‘çš„ n æ¡æäº¤ â€“since, â€“after ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´ä¹‹åçš„æäº¤ â€“until, â€“before ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´ä¹‹å‰çš„æäº¤ â€“author ä»…æ˜¾ç¤ºæŒ‡å®šä½œè€…ç›¸å…³çš„æäº¤ â€“committer ä»…æ˜¾ç¤ºæŒ‡å®šæäº¤è€…ç›¸å…³çš„æäº¤ â€“grep ä»…æ˜¾ç¤ºå«æŒ‡å®šå…³é”®å­—çš„æäº¤ -S ä»…æ˜¾ç¤ºæ·»åŠ æˆ–ç§»é™¤äº†æŸä¸ªå…³é”®å­—çš„æäº¤ 4. æ’¤æ¶ˆæ“ä½œ1git commit --amend å–æ¶ˆæš‚å­˜çš„æ–‡ä»¶12# git reset HEAD &lt;file&gt; ...git reset HEAD CONTRIBUTING.md æ’¤æ¶ˆå¯¹æ–‡ä»¶çš„ä¿®æ”¹12# git checkout -- &lt;file&gt;git checkout -- CONTRIBUTING.md 5. è¿œç¨‹ä»“åº“çš„ä½¿ç”¨12345git clone https://github.com/schacon/ticgitgit remotegit remote -vgit remote add pb https://github.com/paulboone/ticgitgit fetch pb ä»è¿œç¨‹ä»“åº“ä¸­æŠ“å–ä¸æ‹‰å–1git fetch [remote-name] æ¨é€åˆ°è¿œç¨‹ä»“åº“1git push origin master æŸ¥çœ‹è¿œç¨‹ä»“åº“12# git remote show [remote-name]git remote show origin è¿œç¨‹ä»“åº“çš„ç§»é™¤ä¸é‡å‘½å12git remote rename pb paulgit remote rm paul 6. æ‰“æ ‡ç­¾åˆ—å‡ºæ ‡ç­¾12git taggit tag -l 'v1.8.5*' åˆ›å»ºæ ‡ç­¾é™„æ³¨æ ‡ç­¾123git tag -a v1.4 -m 'my version 1.4'git taggit show v1.4 # æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ä¸å¯¹åº”çš„æäº¤ä¿¡æ¯ è½»é‡æ ‡ç­¾12git tag v1.4-lwgit tag åæœŸæ‰“æ ‡ç­¾12git log --pretty=onelinegit tag -a v1.2 &lt;éƒ¨åˆ†æ ¡éªŒå’Œ&gt; # git tag -a v1.2 9fceb02 å…±äº«æ ‡ç­¾12git push origin v1.5git push origin --tags # ä¸€æ¬¡æ€§æ¨é€å…¨éƒ¨æ ‡ç­¾ æ£€å‡ºæ ‡ç­¾12# ä½¿ç”¨ git checkout -b [branchname] [tagname] åœ¨ç‰¹å®šçš„æ ‡ç­¾ä¸Šåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯git checkout -b version2 v2.0.0 7. Git åˆ«å12345678git config --global alias.co checkoutgit config --global alias.br branchgit config --global alias.ci commitgit config --global alias.st statusgit config --global alias.unstage 'reset HEAD --'git config --global alias.last 'log -1 HEAD'# æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œåœ¨å‘½ä»¤å‰é¢åŠ å…¥ ! ç¬¦å·git config --global alias.visual '!gitk'","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"git","slug":"git","permalink":"http://yoursite.com/tags/git/"}]},{"title":"Prometheus + Grafana","slug":"promethues","date":"2019-02-27T11:59:14.000Z","updated":"2019-07-23T07:16:50.815Z","comments":true,"path":"2019/02/27/promethues/","link":"","permalink":"http://yoursite.com/2019/02/27/promethues/","excerpt":"","text":"å®‰è£… GO12[root@master ~]# yum -y install go[root@mysqlnode05 go]# go version å®‰è£… prometheus12345[root@master ~]# tar -zxvf prometheus-2.7.1.linux-amd64.tar.gz[root@master ~]# mv prometheus-2.7.1.linux-amd64 /appdata/prometheus[root@master ~]# cd /appdata/prometheus/# ä¿®æ”¹prometheus.ymlæ–‡ä»¶ï¼Œé…ç½®targetså…¶ä¸­çš„IPå’Œç«¯å£åˆ™æ˜¯å¯¹åº”çš„exporterçš„ç›‘å¬ç«¯å£[root@master ~]# vim prometheus.yml 12345678910111213141516171819202122232425262728293031323334353637global: scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute. evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute. # scrape_timeout is set to the global default (10s).alerting: alertmanagers: - static_configs: - targets: # - alertmanager:9093rule_files: # - \"first_rules.yml\" # - \"second_rules.yml\"scrape_configs: # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config. - job_name: 'prometheus' static_configs: - targets: ['192.168.41.131:9090'] - job_name: 'master' static_configs: - targets: ['192.168.41.131:9100'] labels: instance: master - job_name: 'slave' static_configs: - targets: ['192.168.41.132:9100'] labels: instance: slave - job_name: 'mysql-master' static_configs: - targets: ['192.168.41.131:9104'] labels: instance: master - job_name: 'mysql-slave' static_configs: - targets: ['192.168.41.132:9104'] labels: instance: slave 12# å¯åŠ¨å¹¶é€šè¿‡webè®¿é—®[root@master ~]# /appdata/prometheus/prometheus --config.file /appdata/prometheus/prometheus.yml &gt;&gt; /appdata/prometheus/prometheus.log 2&gt;&amp;1 &amp; å®‰è£… mysqld_exporter123456789[root@master ~]# tar -zxvf mysqld_exporter-0.11.0.linux-amd64.tar.gz[root@master ~]# cp mysqld_exporter-0.11.0.linux-amd64/mysqld_exporter /appdata/prometheus/[root@master ~]# mysql -uroot -p# åˆ›å»ºä¸“ç”¨ç”¨æˆ·mysql&gt; create user 'prometheus'@'%' identified by 'xxxxxx';mysql&gt; grant REPLICATION CLIENT,PROCESS,SELECT ON *.* TO 'prometheus'@'%';mysql&gt; flush privileges;# åˆ›å»ºexporteré…ç½®æ–‡ä»¶[root@master ~]# vim /appdata/prometheus/.my.cnf 123[client]user=mysql_promepassword=Aa123456789 12# å¯åŠ¨mysqld_exporter[root@master ~]# /appdata/prometheus/mysqld_exporter --config.my-cnf /appdata/prometheus/.my.cnf &gt;&gt; /appdata/prometheus/mysqld_exporter.log 2&gt;&amp;1 &amp; å®‰è£… node_exporter1234[root@master ~]# tar -zxvf node_exporter-0.17.0.linux-amd64.tar.gz[root@master ~]# cp node_exporter-0.17.0.linux-amd64/node_exporter /appdata/prometheus/# å¯åŠ¨node_exporter[root@master ~]# /appdata/prometheus/node_exporter &gt;&gt; /appdata/prometheus/node_exporter.log 2&gt;&amp;1 &amp; æŸ¥çœ‹ target statusæµè§ˆå™¨è®¿é—® http://192.168.31.131:9090 å®‰è£… grafana12345[root@master ~]# wget https://dl.grafana.com/oss/release/grafana-6.0.0-1.x86_64.rpm [root@master ~]# yum -y install grafana-6.0.0-1.x86_64.rpm# å¯åŠ¨grafana[root@master ~]# systemctl enable grafana-server[root@master ~]# systemctl start grafana-server æ·»åŠ æ•°æ®æºæµè§ˆå™¨è®¿é—® http://192.168.31.131:3000","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"prometheus","slug":"prometheus","permalink":"http://yoursite.com/tags/prometheus/"},{"name":"grafana","slug":"grafana","permalink":"http://yoursite.com/tags/grafana/"}]},{"title":"MySQL å®‰è£…æŒ‡å—","slug":"mysql","date":"2019-02-17T16:00:00.000Z","updated":"2019-07-23T07:16:33.687Z","comments":true,"path":"2019/02/18/mysql/","link":"","permalink":"http://yoursite.com/2019/02/18/mysql/","excerpt":"","text":"1. å®‰è£…å¹¶åˆå§‹åŒ–æ•°æ®åº“1234567891011121314[root@master ~]# lsmysql-8.0.15-linux-glibc2.12-x86_64.tar.xz[root@master ~]# tar -Jxf mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz[root@master ~]# lsmysql-8.0.15-linux-glibc2.12-x86_64 mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz[root@master ~]# mkdir /appdata [root@master ~]# mv mysql-8.0.15-linux-glibc2.12-x86_64 /appdata/mysql[root@master ~]# cd /appdata/mysql/bin[root@master bin]# ./mysqld --verbose --help[root@master bin]# ./mysqld --initialize --user=mysql2019-02-17T13:24:47.271942Z 0 [Warning] [MY-011070] [Server] 'Disabling symbolic links using --skip-symbolic-links (or equivalent) is the default. Consider not using this option as it' is deprecated and will be removed in a future release.2019-02-17T13:24:47.272022Z 0 [System] [MY-013169] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server in progress as process 95172019-02-17T13:24:49.230753Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: fYd00.&lt;Ucx:02019-02-17T13:24:50.553995Z 0 [System] [MY-013170] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server has completed 2. ç¼–è¾‘è‡ªå®šä¹‰é…ç½®æ–‡ä»¶1[root@master ~]# vim /etc/my.cnf 1234567891011121314151617[mysqld]port=3306basedir=/appdata/mysqldatadir=/appdata/mysql/datasocket=/appdata/mysql/data/mysql.socklog-bin=mysql-binserver-id=1binlog_format=MIXEDgtid_mode = onenforce_gtid_consistency = 1log_slave_updates = 1max_allowed_packet = 128Minteractive_timeout = 28800000wait_timeout = 28800000[client]socket=/appdata/mysql/data/mysql.sock 3. å¯åŠ¨MySQL12[root@master ~]# cp /appdata/mysql/support-files/mysql.server /etc/init.d/[root@master ~]# vim /etc/init.d/mysql.server 12basedir=/appdata/mysqldatadir=/appdata/mysql/data 1[root@master ~]# /etc/init.d/mysql.server start 4. è®¾ç½®ä¸»ä»åŒæ­¥1[root@master ~]# mysql -uroot -pfYd00.&lt;Ucx:0 12345678910111213141516171819202122232425262728293031323334353637383940mysql&gt; ALTER USER root@'localhost' IDENTIFIED BY 'Abc123';Query OK, 0 rows affected (0.04 sec)mysql&gt; CREATE USER replication@'%' IDENTIFIED WITH 'mysql_native_password' BY 'replication';Query OK, 0 rows affected (0.04 sec)mysql&gt; grant replication slave on *.* to replication@'%';Query OK, 0 rows affected (0.00 sec)mysql&gt; ALTER TABLE mysql.slave_master_info ENGINE=InnoDB;Query OK, 0 rows affected (0.07 sec)Records: 0 Duplicates: 0 Warnings: 0mysql&gt; ALTER TABLE mysql.slave_relay_log_info ENGINE=InnoDB;Query OK, 0 rows affected (0.01 sec)Records: 0 Duplicates: 0 Warnings: 0mysql&gt; reset slave;Query OK, 0 rows affected (0.01 sec)mysql&gt; CHANGE MASTER TO MASTER_HOST=\"slave.example.com\",MASTER_USER='replication',MASTER_PASSWORD=\"replication\",MASTER_AUTO_POSITION=1;Query OK, 0 rows affected, 2 warnings (0.01 sec)mysql&gt; start slave;Query OK, 0 rows affected (0.01 sec)mysql&gt; show slave status\\G;*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: slave.example.com Master_User: replication Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000015 Read_Master_Log_Pos: 1567 Relay_Log_File: master-relay-bin.000003 Relay_Log_Pos: 456 Relay_Master_Log_File: mysql-bin.000015 Slave_IO_Running: Yes Slave_SQL_Running: Yes 5. é—®é¢˜å¤„ç† Error_code: MY-002061 ä¸å…¼å®¹çš„å˜åŒ–ï¼š åœ¨caching_sha2_passwordå’Œ sha256_passwordè®¤è¯æ’ä»¶æä¾›æ¯”æ›´å®‰å…¨çš„å¯†ç åŠ å¯† mysql_native_passwordæ’ä»¶ï¼Œå¹¶ caching_sha2_passwordæä¾›äº†æ¯”æ›´å¥½çš„æ€§èƒ½sha256_passwordã€‚ç”±äºè¿™äº›ä¼˜è¶Šçš„å®‰å…¨æ€§å’Œæ€§èƒ½ç‰¹æ€§ caching_sha2_passwordï¼Œå®ƒç°åœ¨æ˜¯é¦–é€‰çš„èº«ä»½éªŒè¯æ’ä»¶ï¼Œè€Œä¸”ä¹Ÿæ˜¯é»˜è®¤çš„èº«ä»½éªŒè¯æ’ä»¶è€Œä¸æ˜¯ mysql_native_passwordã€‚æ­¤æ›´æ”¹ä¼šå½±å“æœåŠ¡å™¨å’Œlibmysqlclientå®¢æˆ·ç«¯åº“ï¼š å¯¹äºæœåŠ¡å™¨ï¼Œdefault_authentication_plugin ç³»ç»Ÿå˜é‡çš„é»˜è®¤å€¼ ä»æ›´æ”¹ mysql_native_passwordä¸º caching_sha2_passwordã€‚ è¯¥libmysqlclientåº“å°†å…¶ caching_sha2_passwordè§†ä¸ºé»˜è®¤çš„èº«ä»½éªŒè¯æ’ä»¶è€Œä¸æ˜¯ mysql_native_passwordã€‚ æ­¤æ›´æ”¹ä»…å½±å“ç”¨äºåˆ›å»ºæ–°MySQLå¸æˆ·çš„èº«ä»½éªŒè¯æ’ä»¶ã€‚å¯¹äºå·²å‡çº§å®‰è£…ä¸­å·²å­˜åœ¨çš„å¸æˆ·ï¼Œå…¶èº«ä»½éªŒè¯æ’ä»¶ä¿æŒä¸å˜ã€‚ ä½¿ç”¨ç»è¿‡èº«ä»½éªŒè¯çš„å¸æˆ·çš„å®¢æˆ·ç«¯ caching_sha2_passwordå¿…é¡»ä½¿ç”¨å®‰å…¨è¿æ¥ï¼ˆä½¿ç”¨TCPä½¿ç”¨TLS / SSLå‡­æ®ï¼ŒUnixå¥—æ¥å­—æ–‡ä»¶æˆ–å…±äº«å†…å­˜åˆ¶ä½œï¼‰ï¼Œæˆ–ä½¿ç”¨RSAå¯†é’¥å¯¹æ”¯æŒå¯†ç äº¤æ¢çš„æœªåŠ å¯†è¿æ¥ã€‚æ­¤å®‰å…¨è¦æ±‚ä¸é€‚ç”¨ mysql_native_passswordï¼Œå› æ­¤äº¤æ¢æœº caching_sha2_passwordå¯èƒ½éœ€è¦å…¶ä»–é…ç½®ï¼ˆè¯·å‚é˜… ç¼“å­˜SHA-2å¯æ’å…¥èº«ä»½éªŒè¯ï¼‰ã€‚ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL 8.0ä¸­çš„å®¢æˆ·ç«¯è¿æ¥æ›´å–œæ¬¢ä½¿ç”¨TLS / SSLï¼Œå› æ­¤å·²æ»¡è¶³è¯¥é¦–é€‰é¡¹çš„å®¢æˆ·ç«¯å¯èƒ½ä¸éœ€è¦å…¶ä»–é…ç½®ã€‚ å› ä¸ºcaching_sha2_passwordç°åœ¨ä¹Ÿæ˜¯libmysqlclientå®¢æˆ·ç«¯åº“ä¸­çš„é»˜è®¤èº«ä»½éªŒè¯æ’ä»¶ï¼Œæ‰€ä»¥ èº«ä»½éªŒè¯éœ€è¦åœ¨å®¢æˆ·ç«¯/æœåŠ¡å™¨åè®®ä¸­è¿›è¡Œé¢å¤–çš„å¾€è¿”ï¼Œä»¥ä¾¿ä»MySQL 8.0å®¢æˆ·ç«¯è¿æ¥åˆ°ä½¿ç”¨mysql_native_passwordï¼ˆä»¥å‰çš„é»˜è®¤èº«ä»½éªŒè¯æ’ä»¶ï¼‰çš„å¸æˆ· ï¼Œé™¤éè°ƒç”¨å®¢æˆ·ç«¯ç¨‹åºä¸€ä¸ª â€“default-auth=mysql_native_password é€‰æ‹©ã€‚ ä¸å…¼å®¹ï¼šå°šæœªæ›´æ–°çš„å®¢æˆ·ç«¯å’Œè¿æ¥å™¨ caching_sha2_password æ— æ³•è¿æ¥åˆ°é€šè¿‡èº«ä»½éªŒè¯çš„å¸æˆ·ï¼Œcaching_sha2_password å› ä¸ºä»–ä»¬æ— æ³•å°†æ­¤æ’ä»¶è¯†åˆ«ä¸ºæœ‰æ•ˆã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·libmysqlclientä»MySQL 8.0.4æˆ–æ›´é«˜ç‰ˆæœ¬é‡æ–°é“¾æ¥å®¢æˆ·ç«¯ ï¼Œæˆ–è·å–å¯è¯†åˆ«çš„æ›´æ–°è¿æ¥å™¨ caching_sha2_passwordã€‚ ä¸å…¼å®¹ï¼šå°šæœªæ›´æ–°çš„å®¢æˆ·ç«¯å’Œè¿æ¥å™¨ caching_sha2_passwordå¯èƒ½æ— æ³•è¿æ¥åˆ°é…ç½®caching_sha2_passwordä¸ºé»˜è®¤èº«ä»½éªŒè¯æ’ä»¶çš„MySQL 8.0æœåŠ¡å™¨ ï¼Œç”šè‡³ä½¿ç”¨æœªé€šè¿‡èº«ä»½éªŒè¯çš„å¸æˆ·caching_sha2_passwordã€‚å‡ºç°æ­¤é—®é¢˜çš„åŸå› æ˜¯æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯æŒ‡å®šå…¶é»˜è®¤èº«ä»½éªŒè¯æ’ä»¶çš„åç§°ã€‚å¦‚æœå®¢æˆ·ç«¯æˆ–è¿æ¥å™¨åŸºäºæœªæ­£å¸¸å¤„ç†æ— æ³•è¯†åˆ«çš„é»˜è®¤èº«ä»½éªŒè¯æ’ä»¶çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨åè®®å®ç°ï¼Œåˆ™å¯èƒ½ä¼šå¤±è´¥å¹¶æ˜¾ç¤ºé”™è¯¯ã€‚ ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository","categories":[{"name":"database","slug":"database","permalink":"http://yoursite.com/categories/database/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/tags/mysql/"},{"name":"replication","slug":"replication","permalink":"http://yoursite.com/tags/replication/"}]},{"title":"Kubernetes ç¦»çº¿å®‰è£…","slug":"k8s","date":"2019-02-06T17:31:26.000Z","updated":"2019-07-23T07:16:12.800Z","comments":true,"path":"2019/02/07/k8s/","link":"","permalink":"http://yoursite.com/2019/02/07/k8s/","excerpt":"","text":"123456789101112131415161718192021cat /etc/hosts192.168.61.11 node1192.168.61.12 node2systemctl stop firewalldsystemctl disable firewalldsetenforce 0vim /etc/selinux/configSELINUX=disabledvim /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.ipv4.ip_forward = 1modprobe br_netfiltersysctl -p /etc/sysctl.d/k8s.conf kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶123456789101112cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF#!/bin/bashmodprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4EOFchmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4# æŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—lsmod | grep -e ip_vs -e nf_conntrack_ipv4 å®‰è£…Docker123456789101112131415sudo yum install -y yum-utils device-mapper-persistent-data lvm2# Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 3: æ›´æ–°å¹¶å®‰è£… Docker-CEsudo yum makecache fastyum list docker-ce.x86_64 --showduplicates |sort -ryum makecache fastyum install -y --setopt=obsoletes=0 \\ docker-ce-18.06.1.ce-3.el7systemctl start dockersystemctl enable docker 1iptables -nvL å®‰è£…kubeadmå’Œkubelet123456789101112cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOFyum install -y kubelet kubeadm kubectlsystemctl enable kubelet &amp;&amp; systemctl start kubelet 1234567kubelet â€“helpcat /etc/systemd/system/kubelet.service.d/10-kubeadm.confvim /etc/sysconfig/kubeletKUBELET_EXTRA_ARGS=--fail-swap-on=false ä½¿ç”¨kubeadm initåˆå§‹åŒ–é›†ç¾¤12345678910111213141516171819202122232425262728293031323334353637kubeadm config images list#!/bin/bashimages=(kube-apiserver:v1.13.3 kube-controller-manager:v1.13.3 kube-scheduler:v1.13.3 kube-proxy:v1.13.3 pause:3.1 etcd:3.2.24)for imageName in $&#123;images[@]&#125; ; do docker pull mirrorgooglecontainers/$imageName docker tag mirrorgooglecontainers/$imageName k8s.gcr.io/$imageName docker rmi mirrorgooglecontainers/$imageNamedone docker pull coredns/coredns:1.2.6 docker tag coredns/coredns:1.2.6 k8s.gcr.io/coredns:1.2.6 docker rmi coredns/coredns:1.2.6kubeadm init \\ --kubernetes-version=v1.13.0 \\ --pod-network-cidr=10.244.0.0/16 \\ --apiserver-advertise-address=192.168.41.132 \\ --ignore-preflight-errors=Swap# running with swap on is not supported. Please disable swap# æ·»åŠ --ignore-preflight-errors=Swapå‚æ•°å¿½ç•¥è¿™ä¸ªé”™è¯¯mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configkubeadm join 192.168.41.132:6443 --token e4xr2p.xvfc3dr6a4dvz8se --discovery-token-ca-cert-hash sha256:7f99258581c9118551ec500b61bf3d732ed6e31799e5074fc5f75b784633410akubectl get cs# é›†ç¾¤åˆå§‹åŒ–å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæ¸…ç†kubeadm reset å®‰è£…Pod Network1234mkdir -p ~/k8s/cd ~/k8swget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.ymlkubectl apply -f kube-flannel.yml","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"docker","slug":"docker","permalink":"http://yoursite.com/tags/docker/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"http://yoursite.com/tags/Kubernetes/"}]},{"title":"MySQL ç»„å¤åˆ¶","slug":"mgr","date":"2019-01-30T04:24:39.000Z","updated":"2019-07-23T07:16:27.273Z","comments":true,"path":"2019/01/30/mgr/","link":"","permalink":"http://yoursite.com/2019/01/30/mgr/","excerpt":"","text":"1. éƒ¨ç½²ç»„å¤åˆ¶å®ä¾‹å‡å®šMySQL Serverå·²ä¸‹è½½å¹¶è§£å‹ç¼©åˆ°åä¸ºçš„ç›®å½•ä¸­mysql-8.0ã€‚ä»¥ä¸‹è¿‡ç¨‹ä½¿ç”¨ä¸€å°ç‰©ç†è®¡ç®—æœºï¼Œå› æ­¤æ¯ä¸ªMySQLæœåŠ¡å™¨å®ä¾‹éƒ½éœ€è¦è¯¥å®ä¾‹çš„ç‰¹å®šæ•°æ®ç›®å½•ã€‚åœ¨åä¸ºçš„ç›®å½•ä¸­åˆ›å»ºæ•°æ®ç›®å½•data å¹¶åˆå§‹åŒ–æ¯ä¸ªç›®å½•ã€‚ 1234mkdir datamysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s1mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s2mysql-8.0/bin/mysqld --initialize-insecure --basedir=$PWD/mysql-8.0 --datadir=$PWD/data/s3 é‡Œé¢data/s1ï¼Œdata/s2ï¼Œ data/s3æ˜¯ä¸€ä¸ªåˆå§‹åŒ–çš„æ•°æ®ç›®å½•ï¼ŒåŒ…å«äº†MySQLç³»ç»Ÿæ•°æ®åº“å’Œç›¸å…³è¡¨ç­‰ç­‰ â€“initialize-insecureåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå®ƒä»…ç”¨äºç®€åŒ–æ•™ç¨‹ã€‚ 2. é…ç½®ç»„å¤åˆ¶å®ä¾‹ç»„Replication Serverè®¾ç½®è¦å®‰è£…å’Œä½¿ç”¨ç»„å¤åˆ¶æ’ä»¶ï¼Œå¿…é¡»æ­£ç¡®é…ç½®MySQL Serverå®ä¾‹ã€‚å»ºè®®å°†é…ç½®å­˜å‚¨åœ¨å®ä¾‹çš„é…ç½®æ–‡ä»¶ä¸­ã€‚ä»¥ä¸‹æ˜¯ç»„ä¸­ç¬¬ä¸€ä¸ªå®ä¾‹çš„é…ç½®ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ç§°ä¸ºs1ã€‚ä»¥ä¸‹éƒ¨åˆ†æ˜¾ç¤ºäº†ç¤ºä¾‹æœåŠ¡å™¨é…ç½®ã€‚ 12345678[mysqld]# server configurationdatadir=&lt;full_path_to_data&gt;/data/s1basedir=&lt;full_path_to_bin&gt;/mysql-8.0/port=24801socket=&lt;full_path_to_sock_dir&gt;/s1.sock è¿™äº›è®¾ç½®å°†MySQLæœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨å…ˆå‰åˆ›å»ºçš„æ•°æ®ç›®å½•ä»¥åŠæœåŠ¡å™¨åº”æ‰“å¼€çš„ç«¯å£å¹¶å¼€å§‹ä¾¦å¬ä¼ å…¥è¿æ¥ã€‚ ä½¿ç”¨éé»˜è®¤ç«¯å£24801æ˜¯å› ä¸ºåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä¸‰ä¸ªæœåŠ¡å™¨å®ä¾‹ä½¿ç”¨ç›¸åŒçš„ä¸»æœºåã€‚åœ¨å…·æœ‰ä¸‰å°ä¸åŒæœºå™¨çš„è®¾ç½®ä¸­ï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ ç»„å¤åˆ¶éœ€è¦æˆå‘˜ä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæˆå‘˜å¿…é¡»èƒ½å¤Ÿè§£ææ‰€æœ‰å…¶ä»–æˆå‘˜çš„ç½‘ç»œåœ°å€ã€‚ä¾‹å¦‚ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‰€æœ‰ä¸‰ä¸ªå®ä¾‹éƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œï¼Œå› æ­¤ä¸ºäº†ç¡®ä¿æˆå‘˜å¯ä»¥ç›¸äº’è”ç³»ï¼Œæ‚¨å¯ä»¥åœ¨é€‰é¡¹æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œä¾‹å¦‚ report_host=127.0.0.1ã€‚ å¤åˆ¶æ¡†æ¶ä»¥ä¸‹è®¾ç½®æ ¹æ®MySQLç»„å¤åˆ¶è¦æ±‚é…ç½®å¤åˆ¶ã€‚ 1234server_id=1gtid_mode=ONenforce_gtid_consistency=ONbinlog_checksum=NONE è¿™äº›è®¾ç½®å°†æœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ç¼–å·1ï¼Œä»¥å¯ç”¨å…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ï¼Œä»¥å…è®¸ä»…æ‰§è¡Œå¯ä½¿ç”¨GTIDå®‰å…¨è®°å½•çš„è¯­å¥ï¼Œä»¥åŠç¦ç”¨å†™å…¥å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—çš„äº‹ä»¶çš„æ ¡éªŒå’Œã€‚ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—©äº8.0.3çš„MySQLç‰ˆæœ¬ï¼Œå…¶ä¸­é»˜è®¤å€¼å·²é’ˆå¯¹å¤åˆ¶è¿›è¡Œäº†æ”¹è¿›ï¼Œåˆ™éœ€è¦å°†è¿™äº›è¡Œæ·»åŠ åˆ°æˆå‘˜çš„é€‰é¡¹æ–‡ä»¶ä¸­ã€‚ 12345log_bin=binloglog_slave_updates=ONbinlog_format=ROWmaster_info_repository=TABLErelay_log_info_repository=TABLE è¿™äº›è®¾ç½®æŒ‡ç¤ºæœåŠ¡å™¨æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œä½¿ç”¨åŸºäºè¡Œçš„æ ¼å¼ï¼Œå°†å¤åˆ¶å…ƒæ•°æ®å­˜å‚¨åœ¨ç³»ç»Ÿè¡¨è€Œä¸æ˜¯æ–‡ä»¶ä¸­ï¼Œå¹¶ç¦ç”¨äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶æ ¡éªŒå’Œã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ ç¬¬18.8.1èŠ‚â€œç»„å¤åˆ¶è¦æ±‚â€ã€‚ ç»„å¤åˆ¶è®¾ç½®æ­¤æ—¶ï¼Œè¯¥my.cnfæ–‡ä»¶ç¡®ä¿é…ç½®æœåŠ¡å™¨å¹¶æŒ‡ç¤ºåœ¨ç»™å®šé…ç½®ä¸‹å®ä¾‹åŒ–å¤åˆ¶åŸºç¡€ç»“æ„ã€‚ä»¥ä¸‹éƒ¨åˆ†é…ç½®æœåŠ¡å™¨çš„â€œç»„å¤åˆ¶â€è®¾ç½®ã€‚ 123456transaction_write_set_extraction=XXHASH64group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;group_replication_start_on_boot=offgroup_replication_local_address= &quot;127.0.0.1:24901&quot;group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;group_replication_bootstrap_group=off é…ç½® transaction_write_set_extraction æŒ‡ç¤ºæœåŠ¡å™¨å¯¹äºæ¯ä¸ªäº‹åŠ¡ï¼Œå®ƒå¿…é¡»æ”¶é›†å†™é›†å¹¶ä½¿ç”¨XXHASH64æ•£åˆ—ç®—æ³•å°†å…¶ç¼–ç ä¸ºæ•£åˆ—ã€‚ä»MySQL 8.0.2å¼€å§‹ï¼Œæ­¤è®¾ç½®æ˜¯é»˜è®¤è®¾ç½®ï¼Œå› æ­¤å¯ä»¥çœç•¥æ­¤è¡Œã€‚ é…ç½® group_replication_group_name å‘Šè¯‰æ’ä»¶å®ƒæ­£åœ¨åŠ å…¥æˆ–åˆ›å»ºçš„ç»„è¢«å‘½åä¸ºâ€aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaaâ€ï¼Œgroup_replication_group_nameçš„å€¼ å¿…é¡»æ˜¯æœ‰æ•ˆçš„UUIDã€‚åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ä¸ºç»„å¤åˆ¶äº‹ä»¶è®¾ç½®GTIDæ—¶ï¼Œå°†åœ¨å†…éƒ¨ä½¿ç”¨æ­¤UUIDã€‚ä½¿ç”¨SELECT UUID()ç”Ÿæˆä¸€ä¸ªUUIDã€‚ é…ç½® group_replication_start_on_boot æŒ‡ç¤ºæ’ä»¶åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ä¸è‡ªåŠ¨å¯åŠ¨æ“ä½œã€‚è¿™åœ¨è®¾ç½®ç»„å¤åˆ¶æ—¶å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒç¡®ä¿æ‚¨å¯ä»¥åœ¨æ‰‹åŠ¨å¯åŠ¨æ’ä»¶ä¹‹å‰é…ç½®æœåŠ¡å™¨ã€‚é…ç½®æˆå‘˜åï¼Œæ‚¨å¯ä»¥è®¾ç½® group_replication_start_on_boot ä¸ºonï¼Œä»¥ä¾¿åœ¨æœåŠ¡å™¨å¼•å¯¼æ—¶è‡ªåŠ¨å¯åŠ¨Group Replicationã€‚ é…ç½® group_replication_local_address å‘Šè¯‰æ’ä»¶ä½¿ç”¨ç½‘ç»œåœ°å€127.0.0.1å’Œç«¯å£24901ä¸ç»„ä¸­çš„å…¶ä»–æˆå‘˜è¿›è¡Œå†…éƒ¨é€šä¿¡ã€‚ ç»„å¤åˆ¶å°†æ­¤åœ°å€ç”¨äºæ¶‰åŠç»„é€šä¿¡å¼•æ“ï¼ˆXComï¼ŒPaxoså˜ä½“ï¼‰çš„è¿œç¨‹å®ä¾‹çš„å†…éƒ¨æˆå‘˜åˆ°æˆå‘˜è¿æ¥ã€‚æ­¤åœ°å€å¿…é¡»ä¸ç”¨äºSQLçš„ä¸»æœºåå’Œç«¯å£ä¸åŒï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨è¿è¡Œç»„å¤åˆ¶æ—¶ï¼Œå¿…é¡»ä¸ºç»„æˆå‘˜ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ä¿ç•™å®ƒã€‚ é…ç½®çš„ç½‘ç»œåœ°å€ group_replication_local_address å¿…é¡»å¯ç”±æ‰€æœ‰ç»„æˆå‘˜è§£æã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡å™¨å®ä¾‹ä½äºå…·æœ‰å›ºå®šç½‘ç»œåœ°å€çš„å…¶ä»–è®¡ç®—æœºä¸Šï¼Œåˆ™å¯ä»¥ä½¿ç”¨è®¡ç®—æœºçš„IPåœ°å€ï¼Œä¾‹å¦‚10.0.0.1ã€‚å¦‚æœä½¿ç”¨ä¸»æœºåï¼Œåˆ™å¿…é¡»ä½¿ç”¨å®Œå…¨é™å®šåç§°ï¼Œå¹¶ç¡®ä¿å®ƒå¯ä»¥é€šè¿‡DNSè§£æï¼Œå¹¶ä¸”é…ç½®æ­£ç¡® /etc/hostsæ–‡ä»¶æˆ–å…¶ä»–åç§°è§£æè¿‡ç¨‹ã€‚ä»MySQL 8.0.14å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨IPv6åœ°å€ï¼ˆæˆ–è§£æå®ƒä»¬çš„ä¸»æœºåï¼‰ä»¥åŠIPv4åœ°å€ã€‚ç»„å¯ä»¥åŒ…å«ä½¿ç”¨IPv6çš„æˆå‘˜å’Œä½¿ç”¨IPv4çš„æˆå‘˜çš„æ··åˆã€‚ å»ºè®®çš„ç«¯å£ group_replication_local_address æ˜¯33061ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨ä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œçš„ä¸‰ä¸ªæœåŠ¡å™¨å®ä¾‹ï¼Œå› æ­¤ç«¯å£24901åˆ°24903ç”¨äºå†…éƒ¨é€šä¿¡ç½‘ç»œåœ°å€ã€‚ group_replication_local_address Group Replicationä½¿ç”¨å®ƒä½œä¸ºå¤åˆ¶ç»„ä¸­ç»„æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚åªè¦ä¸»æœºåæˆ–IPåœ°å€éƒ½ä¸åŒï¼Œæ‚¨å°±å¯ä»¥ä¸ºå¤åˆ¶ç»„çš„æ‰€æœ‰æˆå‘˜ä½¿ç”¨ç›¸åŒçš„ç«¯å£ï¼Œå¹¶ä¸”å¦‚æœ¬æ•™ç¨‹æ‰€ç¤ºï¼Œåªè¦å…·æœ‰ç›¸åŒçš„ä¸»æœºåæˆ–IPåœ°å€ï¼Œå°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ä¸»æœºåæˆ–IPåœ°å€ã€‚æ¸¯å£éƒ½ä¸ä¸€æ ·ã€‚ é…ç½® group_replication_group_seeds è®¾ç½®ç»„æˆå‘˜çš„ä¸»æœºåå’Œç«¯å£ï¼Œæ–°æˆå‘˜ä½¿ç”¨å®ƒä»¬å»ºç«‹ä¸ç»„çš„è¿æ¥ã€‚è¿™äº›æˆå‘˜ç§°ä¸ºç§å­æˆå‘˜ã€‚å»ºç«‹è¿æ¥åï¼Œå°†åˆ—å‡ºç»„æˆå‘˜èº«ä»½ä¿¡æ¯ performance_schema.replication_group_membersã€‚é€šå¸¸ï¼Œ group_replication_group_seeds åˆ—è¡¨åŒ…å«hostname:portæ¯ä¸ªç»„æˆå‘˜çš„åˆ—è¡¨ group_replication_local_addressï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¯ä»¥é€‰æ‹©ç»„æˆå‘˜çš„å­é›†ä½œä¸ºç§å­ã€‚ è¯¥hostname:portåˆ—åœ¨ group_replication_group_seeds æ˜¯ç§å­æ„ä»¶çš„å†…éƒ¨ç½‘ç»œåœ°å€ï¼Œç”±è¢«é…ç½® group_replication_local_address ï¼Œè€Œä¸æ˜¯SQL hostname:portç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶ä¸”ä¾‹å¦‚åœ¨æ˜¾ç¤º performance_schema.replication_group_members è¡¨ä¸­ã€‚ å¯åŠ¨è¯¥ç»„çš„æœåŠ¡å™¨ä¸ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œå› ä¸ºå®ƒæ˜¯åˆå§‹æœåŠ¡å™¨ï¼Œå› æ­¤ï¼Œå®ƒè´Ÿè´£å¼•å¯¼ç»„ã€‚æ¢å¥è¯è¯´ï¼Œå¼•å¯¼è¯¥ç»„çš„æœåŠ¡å™¨ä¸Šçš„ä»»ä½•ç°æœ‰æ•°æ®éƒ½æ˜¯ç”¨ä½œä¸‹ä¸€ä¸ªåŠ å…¥æˆå‘˜çš„æ•°æ®ã€‚ç¬¬äºŒä¸ªæœåŠ¡å™¨è¿æ¥è¦æ±‚ç»„ä¸­å”¯ä¸€çš„æˆå‘˜åŠ å…¥ï¼Œç¬¬äºŒä¸ªæœåŠ¡å™¨ä¸Šçš„ä»»ä½•ç¼ºå¤±æ•°æ®éƒ½ä»å¼•å¯¼æˆå‘˜ä¸Šçš„æ–½ä¸»æ•°æ®ä¸­å¤åˆ¶ï¼Œç„¶åç»„æ‰©å±•ã€‚åŠ å…¥çš„ç¬¬ä¸‰ä¸ªæœåŠ¡å™¨å¯ä»¥è¦æ±‚è¿™ä¸¤ä¸ªæœåŠ¡å™¨ä¸­çš„ä»»ä½•ä¸€ä¸ªåŠ å…¥ï¼Œæ•°æ®è¢«åŒæ­¥åˆ°æ–°æˆå‘˜ï¼Œç„¶åè¯¥ç»„å†æ¬¡æ‰©å±•ã€‚ åœ¨åŒæ—¶åŠ å…¥å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œè¯·ç¡®ä¿å®ƒä»¬æŒ‡å‘å·²åœ¨è¯¥ç»„ä¸­çš„ç§å­æˆå‘˜ã€‚ä¸è¦ä½¿ç”¨ä¹ŸåŠ å…¥è¯¥ç»„çš„æˆå‘˜ä½œä¸ºç§å­ï¼Œå› ä¸ºä»–ä»¬åœ¨è”ç³»æ—¶å¯èƒ½å°šæœªåŠ å…¥è¯¥ç»„ã€‚ æœ€å¥½é¦–å…ˆå¯åŠ¨å¼•å¯¼ç¨‹åºæˆå‘˜ï¼Œç„¶åè®©å®ƒåˆ›å»ºç»„ã€‚ç„¶åä½¿å…¶æˆä¸ºæ­£åœ¨åŠ å…¥çš„å…¶ä½™æˆå‘˜çš„ç§å­æˆå‘˜ã€‚è¿™ç¡®ä¿äº†åœ¨è¿æ¥å…¶ä½™æˆå‘˜æ—¶å½¢æˆçš„ç»„ã€‚ ä¸æ”¯æŒåˆ›å»ºç»„å¹¶åŒæ—¶åŠ å…¥å¤šä¸ªæˆå‘˜ã€‚å®ƒå¯èƒ½æœ‰æ•ˆï¼Œä½†å¯èƒ½æ˜¯æ“ä½œç«äº‰ï¼Œç„¶ååŠ å…¥è¯¥ç»„çš„è¡Œä¸ºæœ€ç»ˆä¼šå‡ºé”™æˆ–è¶…æ—¶ã€‚ åŠ å…¥æˆå‘˜å¿…é¡»ä½¿ç”¨ç§å­æˆå‘˜åœ¨group_replication_group_seeds é€‰é¡¹ä¸­é€šå‘Šçš„ç›¸åŒåè®®ï¼ˆIPv4æˆ–IPv6ï¼‰ä¸ç§å­æˆå‘˜é€šä¿¡ ã€‚å‡ºäºç»„å¤åˆ¶çš„IPåœ°å€ç™½åå•çš„ç›®çš„ï¼Œç§å­æˆå‘˜ä¸Šçš„ç™½åå•å¿…é¡»åŒ…å«ç§å­æˆå‘˜æä¾›çš„åè®®çš„åŠ å…¥æˆå‘˜çš„IPåœ°å€ï¼Œæˆ–è€…è§£æä¸ºè¯¥åè®®çš„åœ°å€çš„ä¸»æœºåã€‚é™¤äº†åŠ å…¥æˆå‘˜ä¹‹å¤–ï¼Œè¿˜å¿…é¡»è®¾ç½®æ­¤åœ°å€æˆ–ä¸»æœºåå¹¶åˆ—å…¥ç™½åå• group_replication_local_address å¦‚æœè¯¥åœ°å€çš„åè®®ä¸ç§å­æˆå‘˜çš„é€šå‘Šåè®®ä¸åŒ¹é…ã€‚å¦‚æœåŠ å…¥æˆå‘˜æ²¡æœ‰é€‚å½“åè®®çš„ç™½åå•åœ°å€ï¼Œåˆ™æ‹’ç»å…¶è¿æ¥å°è¯•ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ ç¬¬18.5.1èŠ‚â€œIPåœ°å€ç™½åå•â€ã€‚ é…ç½® group_replication_bootstrap_group æŒ‡ç¤ºæ’ä»¶æ˜¯å¦å¼•å¯¼ç»„ã€‚ æ­¤é€‰é¡¹åªèƒ½åœ¨ä»»ä½•æ—¶å€™åœ¨ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ä¸Šä½¿ç”¨ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸€æ¬¡å¼•å¯¼ç»„æ—¶ï¼ˆæˆ–è€…åœ¨æ•´ä¸ªç»„å…³é—­å¹¶é‡æ–°å¤‡ä»½çš„æƒ…å†µä¸‹ï¼‰ã€‚å¦‚æœå¤šæ¬¡å¼•å¯¼ç»„ï¼Œä¾‹å¦‚å½“å¤šä¸ªæœåŠ¡å™¨å®ä¾‹è®¾ç½®äº†æ­¤é€‰é¡¹æ—¶ï¼Œåˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªäººå·¥åˆ†è£‚è„‘æƒ…æ™¯ï¼Œå…¶ä¸­å­˜åœ¨ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ä¸åŒç»„ã€‚åœ¨ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹è”æœºåç¦ç”¨æ­¤é€‰é¡¹ã€‚ç»„ä¸­æ‰€æœ‰æœåŠ¡å™¨çš„é…ç½®éå¸¸ç›¸ä¼¼ã€‚æ‚¨éœ€è¦æ›´æ”¹æœ‰å…³æ¯ä¸ªæœåŠ¡å™¨çš„ç»†èŠ‚ï¼ˆä¾‹å¦‚server_idï¼Œ datadirï¼Œ group_replication_local_addressï¼‰ã€‚æœ¬æ•™ç¨‹ç¨åå°†å¯¹æ­¤è¿›è¡Œè¯´æ˜ã€‚ 3. ç”¨æˆ·å‡­è¯ç»„å¤åˆ¶ä½¿ç”¨å¼‚æ­¥å¤åˆ¶åè®®æ¥å®ç° åˆ†å¸ƒå¼æ¢å¤è¿‡ç¨‹ä¾èµ–äºåä¸ºçš„å¤åˆ¶é€šé“group_replication_recoveryï¼Œè¯¥é€šé“ç”¨äºå°†æ¥è‡ªä¾›ä½“æˆå‘˜çš„äº‹åŠ¡è½¬ç§»åˆ°åŠ å…¥è¯¥ç»„çš„æˆå‘˜ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦è®¾ç½®å…·æœ‰æ­£ç¡®æƒé™çš„å¤åˆ¶ç”¨æˆ·ï¼Œä»¥ä¾¿ç»„å¤åˆ¶å¯ä»¥å»ºç«‹ç›´æ¥çš„æˆå‘˜åˆ°æˆå‘˜æ¢å¤å¤åˆ¶é€šé“ã€‚ ä½¿ç”¨é€‰é¡¹æ–‡ä»¶å¯åŠ¨æœåŠ¡å™¨ï¼š 1mysql-8.0/bin/mysqld --defaults-file=data/s1/s1.cnf ä½¿ç”¨è¯¥REPLICATION-SLAVEæƒé™åˆ›å»ºMySQLç”¨æˆ· ã€‚å¯ä»¥åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­æ•è·æ­¤è¿‡ç¨‹ï¼Œç„¶åæ‚¨å¯ä»¥ä¾é åˆ†å¸ƒå¼æ¢å¤æ¥å¤åˆ¶ç”¨äºåˆ›å»ºç”¨æˆ·çš„è¯­å¥ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ç¦ç”¨äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œç„¶ååœ¨æ¯ä¸ªæˆå‘˜ä¸Šæ‰‹åŠ¨åˆ›å»ºç”¨æˆ·ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¦é¿å…å°†æ›´æ”¹ä¼ æ’­åˆ°å…¶ä»–æœåŠ¡å™¨å®ä¾‹ã€‚è¦ç¦ç”¨äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œè¯·è¿æ¥åˆ°æœåŠ¡å™¨s1å¹¶å‘å‡ºä»¥ä¸‹è¯­å¥ï¼š 1mysql&gt; SET SQL_LOG_BIN=0; åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­rpl_userï¼Œå°†passwordæ˜¾ç¤ºå…·æœ‰å¯†ç  çš„ç”¨æˆ· ã€‚é…ç½®æœåŠ¡å™¨æ—¶ï¼Œè¯·ä½¿ç”¨åˆé€‚çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ 123mysql&gt; CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;mysql&gt; GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;mysql&gt; FLUSH PRIVILEGES; å¦‚æœç¦ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œåˆ™åœ¨åˆ›å»ºç”¨æˆ·åå†æ¬¡å¯ç”¨å®ƒã€‚ 1mysql&gt; SET SQL_LOG_BIN=1; é…ç½®ç”¨æˆ·åï¼Œä½¿ç”¨è¯¥ CHANGE MASTER TOè¯­å¥å°†æœåŠ¡å™¨é…ç½®ä¸ºgroup_replication_recoveryåœ¨ä¸‹æ¬¡éœ€è¦ä»å¦ä¸€ä¸ªæˆå‘˜æ¢å¤å…¶çŠ¶æ€æ—¶ä½¿ç”¨å¤åˆ¶é€šé“çš„ç»™å®šå‡­æ® ã€‚å‘å‡ºä»¥ä¸‹ï¼Œæ›¿æ¢ rpl_userå’Œ passwordä¸åˆ›å»ºç”¨æˆ·æ—¶ä½¿ç”¨çš„å€¼ã€‚ 12mysql&gt; CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos; \\\\ FOR CHANNEL &apos;group_replication_recovery&apos;; åˆ†å¸ƒå¼æ¢å¤æ˜¯åŠ å…¥ç»„çš„æœåŠ¡å™¨é‡‡å–çš„ç¬¬ä¸€æ­¥ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸ç»„æˆå‘˜ç›¸åŒçš„äº‹åŠ¡é›†ã€‚å¦‚æœæ²¡æœ‰ä¸ºgroup_replication_recovery å¤åˆ¶é€šé“æ­£ç¡®è®¾ç½®è¿™äº›å‡­æ®ï¼Œå¹¶ä¸”rpl_userå¦‚å›¾æ‰€ç¤ºï¼Œåˆ™æœåŠ¡å™¨æ— æ³•è¿æ¥åˆ°ä¾›ä½“æˆå‘˜å¹¶è¿è¡Œåˆ†å¸ƒå¼æ¢å¤è¿‡ç¨‹ä»¥ä¸å…¶ä»–ç»„æˆå‘˜åŒæ­¥ï¼Œå› æ­¤æœ€ç»ˆæ— æ³•åŠ å…¥è¯¥ç»„ã€‚ åŒæ ·ï¼Œå¦‚æœæœåŠ¡å™¨æ— æ³•é€šè¿‡æœåŠ¡å™¨æ­£ç¡®è¯†åˆ«å…¶ä»–æˆå‘˜ï¼Œhostnameåˆ™æ¢å¤è¿‡ç¨‹å¯èƒ½ä¼šå¤±è´¥ã€‚å»ºè®®è¿è¡ŒMySQLçš„æ“ä½œç³»ç»Ÿå…·æœ‰æ­£ç¡®é…ç½®çš„å”¯ä¸€ hostnameï¼Œä½¿ç”¨DNSæˆ–æœ¬åœ°è®¾ç½®ã€‚è¿™hostnameå¯ä»¥Member_hoståœ¨performance_schema.replication_group_members è¡¨æ ¼çš„åˆ—ä¸­ è¿›è¡ŒéªŒè¯ ã€‚å¦‚æœå¤šä¸ªç»„æˆå‘˜å¤–éƒ¨åŒ–hostnameæ“ä½œç³»ç»Ÿçš„é»˜è®¤ è®¾ç½®ï¼Œåˆ™æˆå‘˜å¯èƒ½æ— æ³•è§£æä¸ºæ­£ç¡®çš„æˆå‘˜åœ°å€è€Œæ— æ³•åŠ å…¥è¯¥ç»„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨report_hosté…ç½®hostnameç”±æ¯ä¸ªæœåŠ¡å™¨å¤–éƒ¨åŒ–çš„å”¯ä¸€ã€‚ ä½¿ç”¨ç»„å¤åˆ¶å’Œç¼“å­˜SHA-2ç”¨æˆ·å‡­æ®æ’ä»¶é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨MySQL 8ä¸­åˆ›å»ºçš„ç”¨æˆ·ä½¿ç”¨ ç¼“å­˜SHA-2å¯æ’å…¥èº«ä»½éªŒè¯ã€‚å¦‚æœrpl_useræ‚¨é…ç½®åˆ†å¸ƒå¼æ¢å¤ä½¿ç”¨ç¼“å­˜SHA-2è®¤è¯æ’ä»¶å¹¶æ²¡æœ‰ä½¿ç”¨å®‰å…¨å¥—æ¥å­—å±‚æ”¯æŒï¼ˆSSLï¼‰ çš„group_replication_recovery å¤åˆ¶é€šé“ï¼ŒRSAå¯†é’¥ç”¨äºå¯†ç äº¤æ¢ï¼Œåˆ›å»ºSSLå’ŒRSAè¯ä¹¦å’Œå¯†é’¥ï¼Œæ‚¨å¯ä»¥å°†rpl_useråº”è¯¥ä»ç»„ä¸­æ¢å¤å…¶çŠ¶æ€çš„æˆå‘˜çš„å…¬é’¥å¤åˆ¶ åˆ°è¯¥ç»„ï¼Œä¹Ÿå¯ä»¥å°†æèµ è€…é…ç½®ä¸ºåœ¨è¯·æ±‚æ—¶æä¾›å…¬é’¥ã€‚ æ›´å®‰å…¨çš„æ–¹æ³•æ˜¯å°†å…¬é’¥å¤åˆ¶ rpl_useråˆ°åº”è¯¥ä»æèµ è€…æ¢å¤ç»„çŠ¶æ€çš„æˆå‘˜ã€‚ç„¶åï¼Œæ‚¨éœ€è¦group_replication_recovery_public_key_path åœ¨åŠ å…¥ç»„çš„æˆå‘˜ä¸Šé…ç½® ç³»ç»Ÿå˜é‡ï¼Œå¹¶ä¸ºå…¶æä¾›å…¬é’¥çš„è·¯å¾„rpl_userã€‚ å¯é€‰åœ°ï¼Œä¸å¤ªå®‰å…¨çš„æ–¹æ³•æ˜¯è®¾ç½® group_replication_recovery_get_public_key=ON æèµ è€…ï¼Œä»¥ä¾¿ä»–ä»¬rpl_useråœ¨åŠ å…¥ç»„æ—¶æä¾›æˆå‘˜çš„å…¬é’¥ ã€‚æ— æ³•éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå› æ­¤åªæœ‰group_replication_recovery_get_public_key=ON åœ¨æ‚¨ç¡®å®šæ²¡æœ‰æœåŠ¡å™¨èº«ä»½è¢«æ³„éœ²çš„é£é™©æ—¶æ‰ä¼šè®¾ç½® ï¼Œä¾‹å¦‚é€šè¿‡ä¸­é—´äººæ”»å‡»ã€‚ 4. å¯åŠ¨ç»„å¤åˆ¶é…ç½®å¹¶å¯åŠ¨æœåŠ¡å™¨s1åï¼Œå®‰è£…ç»„å¤åˆ¶æ’ä»¶ã€‚è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘å‡ºä»¥ä¸‹å‘½ä»¤ï¼š 1INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;; mysql.sessionåœ¨åŠ è½½ç»„å¤åˆ¶ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å­˜åœ¨ã€‚ MySQL 8.0.2ç‰ˆä¸­æ·»åŠ äº†mysql.sessionã€‚å¦‚æœä½¿ç”¨æ—©æœŸç‰ˆæœ¬åˆå§‹åŒ–æ•°æ®å­—å…¸ï¼Œåˆ™å¿…é¡»è¿è¡Œ mysql_upgradeè¿‡ç¨‹ã€‚å¦‚æœæœªè¿è¡Œå‡çº§ï¼Œåˆ™ç»„å¤åˆ¶æ— æ³•ä»¥é”™è¯¯æ¶ˆæ¯å¯åŠ¨å°è¯•ä½¿ç”¨ç”¨æˆ·è®¿é—®æœåŠ¡å™¨æ—¶å‡ºç°é”™è¯¯ï¼šmysql.session@localhostã€‚ç¡®ä¿ç”¨æˆ·åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨æ›´æ–°åè¿è¡Œäº†mysql_upgradeã€‚ è¦æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²æˆåŠŸå®‰è£…ï¼Œè¯·å‘å‡º SHOW PLUGINS;å¹¶æ£€æŸ¥è¾“å‡ºã€‚å®ƒåº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹ï¼š 12345678910mysql&gt; SHOW PLUGINS;+----------------------------+----------+--------------------+----------------------+-------------+| Name | Status | Type | Library | License |+----------------------------+----------+--------------------+----------------------+-------------+| binlog | ACTIVE | STORAGE ENGINE | NULL | PROPRIETARY |(...)| group_replication | ACTIVE | GROUP REPLICATION | group_replication.so | PROPRIETARY |+----------------------------+----------+--------------------+----------------------+-------------+ è¦å¯åŠ¨è¯¥ç»„ï¼Œè¯·æŒ‡ç¤ºæœåŠ¡å™¨s1å¼•å¯¼è¯¥ç»„ï¼Œç„¶åå¯åŠ¨ç»„å¤åˆ¶ã€‚æ­¤å¼•å¯¼ç¨‹åºåº”ä»…ç”±å•ä¸ªæœåŠ¡å™¨å®Œæˆï¼Œè¯¥æœåŠ¡å™¨å¯åŠ¨ç»„å¹¶ä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆbootstrapé…ç½®é€‰é¡¹çš„å€¼æœªä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­çš„åŸå› ã€‚å¦‚æœå®ƒä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œåˆ™åœ¨é‡æ–°å¯åŠ¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å¼•å¯¼å…·æœ‰ç›¸åŒåç§°çš„ç¬¬äºŒä¸ªç»„ã€‚è¿™å°†å¯¼è‡´ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ä¸åŒç»„ã€‚åŒæ ·çš„æ¨ç†é€‚ç”¨äºåœ¨æ­¤é€‰é¡¹è®¾ç½®ä¸ºçš„æƒ…å†µä¸‹åœæ­¢å¹¶é‡æ–°å¯åŠ¨æ’ä»¶ONã€‚ 123SET GLOBAL group_replication_bootstrap_group=ON;START GROUP_REPLICATION;SET GLOBAL group_replication_bootstrap_group=OFF; ä¸€æ—¦START GROUP_REPLICATION è¯­å¥è¿”å›ï¼Œè¯¥é›†å›¢å·²å¯åŠ¨ã€‚æ‚¨å¯ä»¥æ£€æŸ¥è¯¥ç»„ç°åœ¨æ˜¯å¦å·²åˆ›å»ºï¼Œå¹¶ä¸”å…¶ä¸­åŒ…å«ä¸€ä¸ªæˆå‘˜ï¼š 123456mysql&gt; SELECT * FROM performance_schema.replication_group_members;+---------------------------+--------------------------------------+-------------+-------------+---------------+| CHANNEL_NAME | MEMBER_ID | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE |+---------------------------+--------------------------------------+-------------+-------------+---------------+| group_replication_applier | ce9be252-2b71-11e6-b8f4-00212844f856 | myhost | 24801 | ONLINE |+---------------------------+--------------------------------------+-------------+-------------+---------------+ æ­¤è¡¨ä¸­çš„ä¿¡æ¯ç¡®è®¤ç»„ä¸­æœ‰æˆå‘˜å…·æœ‰å”¯ä¸€æ ‡è¯†ç¬¦ ce9be252-2b71-11e6-b8f4-00212844f856ï¼Œå®ƒæ­£åœ¨ONLINEå¹¶ä¸”æ­£åœ¨myhost ä¾¦å¬ç«¯å£ä¸Šçš„å®¢æˆ·ç«¯è¿æ¥ 24801ã€‚ ä¸ºäº†è¯æ˜æœåŠ¡å™¨ç¡®å®åœ¨ä¸€ä¸ªç»„ä¸­å¹¶ä¸”å®ƒèƒ½å¤Ÿå¤„ç†è´Ÿè½½ï¼Œåˆ›å»ºä¸€ä¸ªè¡¨å¹¶å‘å…¶æ·»åŠ ä¸€äº›å†…å®¹ã€‚ 1234mysql&gt; CREATE DATABASE test;mysql&gt; USE test;mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL);mysql&gt; INSERT INTO t1 VALUES (1, &apos;Luis&apos;); æ£€æŸ¥è¡¨çš„å†…å®¹t1å’ŒäºŒè¿›åˆ¶æ—¥å¿—ã€‚ 123456789101112131415161718192021222324252627mysql&gt; SELECT * FROM t1;+----+------+| c1 | c2 |+----+------+| 1 | Luis |+----+------+mysql&gt; SHOW BINLOG EVENTS;+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+| binlog.000001 | 4 | Format_desc | 1 | 123 | Server ver: 8.0.2-gr080-log, Binlog ver: 4 || binlog.000001 | 123 | Previous_gtids | 1 | 150 | || binlog.000001 | 150 | Gtid | 1 | 211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos; || binlog.000001 | 211 | Query | 1 | 270 | BEGIN || binlog.000001 | 270 | View_change | 1 | 369 | view_id=14724817264259180:1 || binlog.000001 | 369 | Query | 1 | 434 | COMMIT || binlog.000001 | 434 | Gtid | 1 | 495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos; || binlog.000001 | 495 | Query | 1 | 585 | CREATE DATABASE test || binlog.000001 | 585 | Gtid | 1 | 646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos; || binlog.000001 | 646 | Query | 1 | 770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) || binlog.000001 | 770 | Gtid | 1 | 831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos; || binlog.000001 | 831 | Query | 1 | 899 | BEGIN || binlog.000001 | 899 | Table_map | 1 | 942 | table_id: 108 (test.t1) || binlog.000001 | 942 | Write_rows | 1 | 984 | table_id: 108 flags: STMT_END_F || binlog.000001 | 984 | Xid | 1 | 1011 | COMMIT /* xid=38 */ |+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+ å¦‚ä¸Šæ‰€ç¤ºï¼Œåˆ›å»ºäº†æ•°æ®åº“å’Œè¡¨å¯¹è±¡ï¼Œå¹¶å°†ç›¸åº”çš„DDLè¯­å¥å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ã€‚æ­¤å¤–ï¼Œæ•°æ®å·²æ’å…¥è¡¨ä¸­å¹¶å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ã€‚å½“ç»„æˆé•¿å¹¶ä¸”æ–°æˆå‘˜å°è¯•èµ¶ä¸Šå¹¶è”æœºæ—¶æ‰§è¡Œåˆ†å¸ƒå¼æ¢å¤æ—¶ï¼Œä¸‹ä¸€èŠ‚å°†è¯´æ˜äºŒè¿›åˆ¶æ—¥å¿—æ¡ç›®çš„é‡è¦æ€§ã€‚ 5. å‘ç»„æ·»åŠ å®ä¾‹æ­¤æ—¶ï¼Œè¯¥ç»„ä¸­æœ‰ä¸€ä¸ªæˆå‘˜æœåŠ¡å™¨s1ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›æ•°æ®ã€‚ç°åœ¨æ˜¯æ—¶å€™é€šè¿‡æ·»åŠ å…ˆå‰é…ç½®çš„å…¶ä»–ä¸¤ä¸ªæœåŠ¡å™¨æ¥æ‰©å±•ç»„ã€‚ æ·»åŠ ç¬¬äºŒä¸ªå®ä¾‹ä¸ºäº†æ·»åŠ ç¬¬äºŒä¸ªå®ä¾‹ï¼ŒæœåŠ¡å™¨s2ï¼Œé¦–å…ˆä¸ºå®ƒåˆ›å»ºé…ç½®æ–‡ä»¶ã€‚é…ç½®ç±»ä¼¼äºç”¨äºæœåŠ¡å™¨s1çš„é…ç½®ï¼Œé™¤äº†è¯¸å¦‚æ•°æ®ç›®å½•çš„ä½ç½®ï¼Œs2å°†è¦ç›‘å¬çš„ç«¯å£æˆ–å…¶ä¹‹å¤–çš„é…ç½® server_idã€‚è¿™äº›ä¸åŒçš„è¡Œåœ¨ä¸‹é¢çš„åˆ—è¡¨ä¸­çªå‡ºæ˜¾ç¤ºã€‚ 1234567891011121314151617181920212223242526[mysqld]# server configurationdatadir=&lt;full_path_to_data&gt;/data/s2basedir=&lt;full_path_to_bin&gt;/mysql-8.0/port=24802socket=&lt;full_path_to_sock_dir&gt;/s2.sock## Replication configuration parameters#server_id=2gtid_mode=ONenforce_gtid_consistency=ONbinlog_checksum=NONE## Group Replication configuration#transaction_write_set_extraction=XXHASH64group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;group_replication_start_on_boot=offgroup_replication_local_address= &quot;127.0.0.1:24902&quot;group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;group_replication_bootstrap_group= off ä¸æœåŠ¡å™¨s1çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä½¿ç”¨é€‰é¡¹æ–‡ä»¶å¯åŠ¨æœåŠ¡å™¨ã€‚ 1mysql-8.0/bin/mysqld --defaults-file=data/s2/s2.cnf ç„¶åæŒ‰å¦‚ä¸‹æ–¹å¼é…ç½®æ¢å¤å‡­æ®ã€‚è¿™äº›å‘½ä»¤ä¸è®¾ç½®æœåŠ¡å™¨s1æ—¶ä½¿ç”¨çš„å‘½ä»¤ç›¸åŒï¼Œå› ä¸ºç”¨æˆ·åœ¨ç»„å†…å…±äº«ã€‚åœ¨s2ä¸Šå‘å¸ƒä»¥ä¸‹è¯­å¥ã€‚ 123456SET SQL_LOG_BIN=0;CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;SET SQL_LOG_BIN=1;CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos; \\\\ FOR CHANNEL &apos;group_replication_recovery&apos;; å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ç¼“å­˜SHA-2èº«ä»½éªŒè¯æ’ä»¶ï¼ˆMySQL 8ä¸­çš„é»˜è®¤è®¾ç½®ï¼‰ï¼Œè¯·å‚é˜… ä½¿ç”¨ç»„å¤åˆ¶å’Œç¼“å­˜SHA-2ç”¨æˆ·å‡­æ®æ’ä»¶ã€‚ å®‰è£…ç»„å¤åˆ¶æ’ä»¶å¹¶å¼€å§‹å°†æœåŠ¡å™¨åŠ å…¥ç»„çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹ç¤ºä¾‹ä»¥ä¸éƒ¨ç½²æœåŠ¡å™¨s1æ—¶ç›¸åŒçš„æ–¹å¼å®‰è£…æ’ä»¶ã€‚ 1mysql&gt; INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;; å°†æœåŠ¡å™¨s2æ·»åŠ åˆ°ç»„ä¸­ã€‚ 1mysql&gt; START GROUP_REPLICATION; ä¸ä¹‹å‰çš„æ­¥éª¤ï¼ˆä¸s1ä¸Šæ‰§è¡Œçš„æ­¥éª¤ç›¸åŒï¼‰ä¸åŒï¼Œæ­¤å¤„çš„åŒºåˆ«åœ¨äºï¼Œ åœ¨å¯åŠ¨ç»„å¤åˆ¶ä¹‹å‰ä¸ä¼šå‘å‡ºSET GLOBAL group_replication_bootstrap_group=ON;ï¼Œå› ä¸ºè¯¥ç»„å·²ç”±æœåŠ¡å™¨s1åˆ›å»ºå¹¶å¼•å¯¼ã€‚æ­¤æ—¶ï¼Œåªéœ€å°†æœåŠ¡å™¨s2æ·»åŠ åˆ°ç°æœ‰ç»„ä¸­ã€‚ å½“ç»„å¤åˆ¶æˆåŠŸå¯åŠ¨å¹¶ä¸”æœåŠ¡å™¨åŠ å…¥ç»„æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ super_read_onlyå˜é‡ã€‚é€šè¿‡super_read_only åœ¨æˆå‘˜çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸ºONï¼Œå¯ä»¥ç¡®ä¿å› ä»»ä½•åŸå› å¯åŠ¨ç»„å¤åˆ¶æ—¶å‡ºç°æ•…éšœçš„æœåŠ¡å™¨ä¸æ¥å—äº‹åŠ¡ã€‚å¦‚æœæœåŠ¡å™¨åº”å°†è¯¥ç»„ä½œä¸ºè¯»å†™å®ä¾‹åŠ å…¥ï¼Œä¾‹å¦‚ä½œä¸ºå•ä¸»ç»„ä¸­çš„ä¸»è¦ç»„æˆ–å¤šä¸»ç»„çš„æˆå‘˜ï¼Œåˆ™å½“è¯¥ super_read_onlyå˜é‡è®¾ç½®ä¸ºONæ—¶ï¼Œåˆ™åœ¨åŠ å…¥æ—¶å°†å…¶è®¾ç½®ä¸ºOFFç¾¤ç»„ã€‚ performance_schema.replication_group_members å†æ¬¡ æ£€æŸ¥ è¡¨æ˜¾ç¤ºè¯¥ç»„ä¸­ç°åœ¨æœ‰ä¸¤ä¸ª ONLINEæœåŠ¡å™¨ã€‚ 1234567mysql&gt; SELECT * FROM performance_schema.replication_group_members;+---------------------------+--------------------------------------+-------------+-------------+---------------+| CHANNEL_NAME | MEMBER_ID | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE |+---------------------------+--------------------------------------+-------------+-------------+---------------+| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost | 24801 | ONLINE || group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost | 24802 | ONLINE |+---------------------------+--------------------------------------+-------------+-------------+---------------+ ç”±äºæœåŠ¡å™¨s2ä¹Ÿæ ‡è®°ä¸ºONLINEï¼Œå®ƒå¿…é¡»å·²ç»è‡ªåŠ¨èµ¶ä¸ŠæœåŠ¡å™¨s1ã€‚éªŒè¯å®ƒç¡®å®å·²ä¸æœåŠ¡å™¨s1åŒæ­¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738mysql&gt; SHOW DATABASES LIKE &apos;test&apos;;+-----------------+| Database (test) |+-----------------+| test |+-----------------+mysql&gt; SELECT * FROM test.t1;+----+------+| c1 | c2 |+----+------+| 1 | Luis |+----+------+mysql&gt; SHOW BINLOG EVENTS;+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+| binlog.000001 | 4 | Format_desc | 2 | 123 | Server ver: 8.0.3-log, Binlog ver: 4 || binlog.000001 | 123 | Previous_gtids | 2 | 150 | || binlog.000001 | 150 | Gtid | 1 | 211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos; || binlog.000001 | 211 | Query | 1 | 270 | BEGIN || binlog.000001 | 270 | View_change | 1 | 369 | view_id=14724832985483517:1 || binlog.000001 | 369 | Query | 1 | 434 | COMMIT || binlog.000001 | 434 | Gtid | 1 | 495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos; || binlog.000001 | 495 | Query | 1 | 585 | CREATE DATABASE test || binlog.000001 | 585 | Gtid | 1 | 646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos; || binlog.000001 | 646 | Query | 1 | 770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) || binlog.000001 | 770 | Gtid | 1 | 831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos; || binlog.000001 | 831 | Query | 1 | 890 | BEGIN || binlog.000001 | 890 | Table_map | 1 | 933 | table_id: 108 (test.t1) || binlog.000001 | 933 | Write_rows | 1 | 975 | table_id: 108 flags: STMT_END_F || binlog.000001 | 975 | Xid | 1 | 1002 | COMMIT /* xid=30 */ || binlog.000001 | 1002 | Gtid | 1 | 1063 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&apos; || binlog.000001 | 1063 | Query | 1 | 1122 | BEGIN || binlog.000001 | 1122 | View_change | 1 | 1261 | view_id=14724832985483517:2 || binlog.000001 | 1261 | Query | 1 | 1326 | COMMIT |+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+ å¦‚ä¸Šæ‰€ç¤ºï¼Œç¬¬äºŒå°æœåŠ¡å™¨å·²æ·»åŠ åˆ°ç»„ä¸­ï¼Œå¹¶è‡ªåŠ¨ä»æœåŠ¡å™¨s1å¤åˆ¶äº†æ›´æ”¹ã€‚æ ¹æ®åˆ†å¸ƒå¼æ¢å¤è¿‡ç¨‹ï¼Œè¿™æ„å‘³ç€åœ¨åŠ å…¥ç»„ä¹‹åå¹¶ä¸”åœ¨è¢«å£°æ˜åœ¨çº¿ä¹‹å‰ï¼ŒæœåŠ¡å™¨s2å·²ç»è‡ªåŠ¨è¿æ¥åˆ°æœåŠ¡å™¨s1å¹¶ä»ä¸­è·å–ä¸¢å¤±çš„æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°†äº‹åŠ¡ä»ç¼ºå°‘çš„s1çš„äºŒè¿›åˆ¶æ—¥å¿—å¤åˆ¶åˆ°å®ƒåŠ å…¥ç»„çš„æ—¶é—´ç‚¹ã€‚ æ·»åŠ å…¶ä»–å®ä¾‹å‘ç»„æ·»åŠ å…¶ä»–å®ä¾‹ä¸æ·»åŠ ç¬¬äºŒä¸ªæœåŠ¡å™¨çš„æ­¥éª¤é¡ºåºåŸºæœ¬ç›¸åŒï¼Œåªæ˜¯å¿…é¡»æ›´æ”¹é…ç½®ï¼Œå› ä¸ºå¿…é¡»æ›´æ”¹æœåŠ¡å™¨s2ã€‚æ€»ç»“æ‰€éœ€çš„å‘½ä»¤ï¼š åˆ›å»ºé…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425[mysqld]# server configurationdatadir=&lt;full_path_to_data&gt;/data/s3basedir=&lt;full_path_to_bin&gt;/mysql-8.0/port=24803socket=&lt;full_path_to_sock_dir&gt;/s3.sock## Replication configuration parameters#server_id=3gtid_mode=ONenforce_gtid_consistency=ONbinlog_checksum=NONE## Group Replication configuration#group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;group_replication_start_on_boot=offgroup_replication_local_address= &quot;127.0.0.1:24903&quot;group_replication_group_seeds= &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;group_replication_bootstrap_group= off å¯åŠ¨æœåŠ¡å™¨ 1mysql-8.0/bin/mysqld --defaults-file=data/s3/s3.cnf é…ç½®group_replication_recoveryé€šé“çš„æ¢å¤å‡­æ®ã€‚ 1234567SET SQL_LOG_BIN=0;CREATE USER rpl_user@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;GRANT REPLICATION SLAVE ON *.* TO rpl_user@&apos;%&apos;;FLUSH PRIVILEGES;SET SQL_LOG_BIN=1;CHANGE MASTER TO MASTER_USER=&apos;rpl_user&apos;, MASTER_PASSWORD=&apos;password&apos; \\\\FOR CHANNEL &apos;group_replication_recovery&apos;; å®‰è£…Group Replicationæ’ä»¶å¹¶å¯åŠ¨å®ƒã€‚ 12INSTALL PLUGIN group_replication SONAME &apos;group_replication.so&apos;;START GROUP_REPLICATION; æ­¤æ—¶ï¼ŒæœåŠ¡å™¨s3å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼Œå·²åŠ å…¥è¯¥ç»„å¹¶èµ¶ä¸Šè¯¥ç»„ä¸­çš„å…¶ä»–æœåŠ¡å™¨ã€‚performance_schema.replication_group_members å†æ¬¡å’¨è¯¢ è¡¨è¯å®äº†è¿™ç§æƒ…å†µã€‚ 12345678mysql&gt; SELECT * FROM performance_schema.replication_group_members;+---------------------------+--------------------------------------+-------------+-------------+---------------+| CHANNEL_NAME | MEMBER_ID | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE |+---------------------------+--------------------------------------+-------------+-------------+---------------+| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost | 24801 | ONLINE || group_replication_applier | 7eb217ff-6df3-11e6-966c-00212844f856 | myhost | 24803 | ONLINE || group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost | 24802 | ONLINE |+---------------------------+--------------------------------------+-------------+-------------+---------------+ åœ¨æœåŠ¡å™¨s2æˆ–æœåŠ¡å™¨s1ä¸Šå‘å‡ºç›¸åŒçš„æŸ¥è¯¢ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥éªŒè¯æœåŠ¡å™¨s3æ˜¯å¦ä¹Ÿèµ¶ä¸Šäº†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142mysql&gt; SHOW DATABASES LIKE &apos;test&apos;;+-----------------+| Database (test) |+-----------------+| test |+-----------------+mysql&gt; SELECT * FROM test.t1;+----+------+| c1 | c2 |+----+------+| 1 | Luis |+----+------+mysql&gt; SHOW BINLOG EVENTS;+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+| binlog.000001 | 4 | Format_desc | 3 | 123 | Server ver: 8.0.3-log, Binlog ver: 4 || binlog.000001 | 123 | Previous_gtids | 3 | 150 | || binlog.000001 | 150 | Gtid | 1 | 211 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&apos; || binlog.000001 | 211 | Query | 1 | 270 | BEGIN || binlog.000001 | 270 | View_change | 1 | 369 | view_id=14724832985483517:1 || binlog.000001 | 369 | Query | 1 | 434 | COMMIT || binlog.000001 | 434 | Gtid | 1 | 495 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&apos; || binlog.000001 | 495 | Query | 1 | 585 | CREATE DATABASE test || binlog.000001 | 585 | Gtid | 1 | 646 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&apos; || binlog.000001 | 646 | Query | 1 | 770 | use `test`; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) || binlog.000001 | 770 | Gtid | 1 | 831 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&apos; || binlog.000001 | 831 | Query | 1 | 890 | BEGIN || binlog.000001 | 890 | Table_map | 1 | 933 | table_id: 108 (test.t1) || binlog.000001 | 933 | Write_rows | 1 | 975 | table_id: 108 flags: STMT_END_F || binlog.000001 | 975 | Xid | 1 | 1002 | COMMIT /* xid=29 */ || binlog.000001 | 1002 | Gtid | 1 | 1063 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&apos; || binlog.000001 | 1063 | Query | 1 | 1122 | BEGIN || binlog.000001 | 1122 | View_change | 1 | 1261 | view_id=14724832985483517:2 || binlog.000001 | 1261 | Query | 1 | 1326 | COMMIT || binlog.000001 | 1326 | Gtid | 1 | 1387 | SET @@SESSION.GTID_NEXT= &apos;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:6&apos; || binlog.000001 | 1387 | Query | 1 | 1446 | BEGIN || binlog.000001 | 1446 | View_change | 1 | 1585 | view_id=14724832985483517:3 || binlog.000001 | 1585 | Query | 1 | 1650 | COMMIT |+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+","categories":[{"name":"database","slug":"database","permalink":"http://yoursite.com/categories/database/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/tags/mysql/"},{"name":"mgr","slug":"mgr","permalink":"http://yoursite.com/tags/mgr/"}]},{"title":"ä½¿ç”¨ Powerline ç¾åŒ–ç»ˆç«¯","slug":"powerline","date":"2019-01-28T16:00:00.000Z","updated":"2019-07-23T07:16:47.146Z","comments":true,"path":"2019/01/29/powerline/","link":"","permalink":"http://yoursite.com/2019/01/29/powerline/","excerpt":"","text":"å®‰è£… python3Ubuntu 1[root@ubuntu ~]# sudo apt install python3 python3-pip å®‰è£… powerline1234567891011[root@ubuntu ~]# python3 -m pip install powerline-status[root@ubuntu ~]# python3 -m pip show powerline-statusName: powerline-statusVersion: 2.7Summary: The ultimate statusline/prompt utility.Home-page: https://github.com/powerline/powerlineAuthor: Kim SilkebaekkenAuthor-email: kim.silkebaekken+vim@gmail.comLicense: MITLocation: /usr/local/lib/python3.6/dist-packagesRequires: è®¾ç½® bash1[root@ubuntu ~]# vim ~/.bashrc 1234powerline-daemon -qPOWERLINE_BASH_CONTINUATION=1POWERLINE_BASH_SELECT=1. /usr/local/lib/python3.6/dist-packages/powerline/bindings/bash/powerline.sh æ•ˆæœå›¾ è®¾ç½® vim1[root@ubuntu ~]# vim ~/.vimrc 123set rtp+=/usr/local/lib/python3.6/dist-packages/powerline/bindings/vim/set laststatus=2set t_Co=256 æ•ˆæœå›¾","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"powerline","slug":"powerline","permalink":"http://yoursite.com/tags/powerline/"}]},{"title":"MySQL å¸¸ç”¨å‡½æ•°","slug":"mysql_function","date":"2019-01-14T16:00:00.000Z","updated":"2019-07-23T07:16:30.560Z","comments":true,"path":"2019/01/15/mysql_function/","link":"","permalink":"http://yoursite.com/2019/01/15/mysql_function/","excerpt":"","text":"æ–‡æœ¬å¤„ç†å‡½æ•° å‡½æ•°å è¯´æ˜ left( ) è¿”å›ä¸²å·¦è¾¹çš„å­—ç¬¦ right( ) è¿”å›ä¸²å³è¾¹çš„å­—ç¬¦ length( ) è¿”å›ä¸²çš„é•¿åº¦ locate( ) æ‰¾å‡ºä¸²çš„ä¸€ä¸ªå­ä¸² lower( ) å°†ä¸²è½¬æ¢ä¸ºå°å†™ upper( ) å°†ä¸²è½¬æ¢ä¸ºå¤§å†™ ltrim( ) å»æ‰ä¸²å·¦è¾¹çš„ç©ºæ ¼ rtrim( ) å»æ‰ä¸²å³è¾¹çš„ç©ºæ ¼ soundex( ) è¿”å›ä¸²çš„SOUNDEXå€¼ substring( ) è¿”å›å­ä¸²çš„å­—ç¬¦ ## æ—¥æœŸå’Œæ—¶é—´å¤„ç†å‡½æ•° å‡½æ•°å è¯´æ˜ adddate( ) å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ addtime( ) å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ curdate( ) è¿”å›å½“å‰æ—¥æœŸ curtime( ) è¿”å›å½“å‰æ—¶é—´ date( ) è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† datediff( ) è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® date_add( ) é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° date_format( ) è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² day( ) è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† dayofweek( ) å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡  hour( ) è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† minute( ) è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† month( ) è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† now( ) è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ second( ) è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† time( ) è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† year( ) è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† æ•°å€¼å¤„ç†å‡½æ•° å‡½æ•°å è¯´æ˜ abs( ) è¿”å›ä¸€ä¸ªæ•°çš„ç»å¯¹å€¼ cos( ) è¿”å›ä¸€ä¸ªè§’åº¦çš„ä½™å¼¦ exp( ) è¿”å›ä¸€ä¸ªæ•°çš„æŒ‡æ•°å€¼ mod( ) è¿”å›é™¤æ“ä½œçš„ä½™æ•° pi( ) è¿”å›åœ†å‘¨ç‡ rand( ) è¿”å›ä¸€ä¸ªéšæœºæ•° sin( ) è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£å¼¦ sqrt( ) è¿”å›ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹ tan( ) è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£åˆ‡ èšé›†å‡½æ•° å‡½æ•°å è¯´æ˜ avg( ) è¿”å›æŸåˆ—çš„å¹³å‡å€¼ count( ) è¿”å›æŸåˆ—çš„è¡Œæ•° max( ) è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ min( ) è¿”å›æŸåˆ—çš„æœ€å°å€¼ sum( ) è¿”å›æŸåˆ—å€¼ä¹‹å’Œ","categories":[{"name":"database","slug":"database","permalink":"http://yoursite.com/categories/database/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/tags/mysql/"}]},{"title":"uWSGI éƒ¨ç½² Django åº”ç”¨","slug":"uwsgi","date":"2019-01-06T16:00:00.000Z","updated":"2019-07-23T07:17:22.755Z","comments":true,"path":"2019/01/07/uwsgi/","link":"","permalink":"http://yoursite.com/2019/01/07/uwsgi/","excerpt":"","text":"demoé¡¹ç›®çš„ç›®å½•ç»“æ„ 1234567891011121314demo/â”œâ”€â”€ db.sqlite3â”œâ”€â”€ demoâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ __pycache__â”‚ â”‚ â”œâ”€â”€ __init__.cpython-36.pycâ”‚ â”‚ â”œâ”€â”€ settings.cpython-36.pycâ”‚ â”‚ â”œâ”€â”€ urls.cpython-36.pycâ”‚ â”‚ â””â”€â”€ wsgi.cpython-36.pycâ”‚ â”œâ”€â”€ settings.pyâ”‚ â”œâ”€â”€ urls.pyâ”‚ â””â”€â”€ wsgi.pyâ”œâ”€â”€ manage.pyâ””â”€â”€ requirements.txt å®‰è£…ç›¸å…³å·¥å…·å’Œä¾èµ–12[root@uwsgi ~]# yum -y install git wget httpd vim # å®‰è£…ç›¸å…³å·¥å…·[root@uwsgi ~]# yum -y install gcc zlib* openssl-devel # å®‰è£…ç¼–è¯‘å·¥å…·å’Œä¾èµ–åº“ å®‰è£… Python ç¯å¢ƒrhelç³»åˆ—æ— æ³•é€šè¿‡yumç›´æ¥å®‰è£…python3ï¼Œéœ€è¦æºç ç¼–è¯‘å®‰è£… 123456789101112[root@uwsgi ~]# pwd # æŸ¥çœ‹å½“å‰ç›®å½•/root[root@uwsgi ~]# wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz # ä¸‹è½½python3.6.5[root@uwsgi ~]# tar -zxvf Python-3.6.5.tgz # è§£å‹[root@uwsgi ~]# cd Python-3.6.5[root@uwsgi Python-3.6.5]# pwd # æŸ¥çœ‹å½“å‰ç›®å½•/root/Python-3.6.5[root@uwsgi Python-3.6.5]# ./configure # ç¼–è¯‘[root@uwsgi Python-3.6.5]# make &amp;&amp; make install # å®‰è£…[root@uwsgi Python-3.6.5]# which python3 # æŸ¥çœ‹python3çš„è·¯å¾„/usr/local/bin/python3 å®‰è£… uWSGI1[root@uwsgi ~]# python3 -m pip install uwsgi å®‰è£…é…ç½®è™šæ‹Ÿç¯å¢ƒ1234567[root@uwsgi ~]# python3 -m pip install virtualenv # å®‰è£…è™šæ‹Ÿç¯å¢ƒ[root@uwsgi ~]# virtualenv -p /usr/local/bin/python3 /venv # é…ç½®è™šæ‹Ÿç¯å¢ƒ[root@uwsgi ~]# source /venv/bin/activate # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ(venv) [root@uwsgi ~]# pip install -r /root/demo/requirements.txt # å®‰è£…é¡¹ç›®ä¾èµ–(venv) [root@uwsgi ~]# pip freeze # æŸ¥çœ‹ä¾èµ–åº“æ˜¯å¦å®‰è£…(venv) [root@uwsgi ~]# deactivate # å–æ¶ˆæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ[root@uwsgi ~]# ä¿®æ”¹ ALLOW_HOSTS1[root@uwsgi ~]# vim demo/demo/settings.py # ç¼–è¾‘é¡¹ç›®ä¸­çš„ settings.py 1ALLOWED_HOSTS = [\"192.168.41.130\",] é…ç½® uWSGI12[root@uwsgi ~]# mkdir -p /var/log/uwsgi # åˆ›å»º uwsgi çš„æ—¥å¿—ç›®å½•[root@uwsgi ~]# vim /etc/uwsgi.ini # åˆ›å»º uwsgi.ini é…ç½®æ–‡ä»¶ 1234567891011[uwsgi]chdir=/root/demohttp=192.168.41.130:8000home=/venvmodule=demo.wsgi:applicationmaster=Truepidfile=/tmp/demo.pidmax-requests=5000daemonize=/var/log/uwsgi/demo.logenv=LANG=en_US.UTF-8buffer-size=32768 å¯åŠ¨ uWSGI1[root@uwsgi ~]# uwsgi --init /etc/uwsgi.ini # ä»¥ /etc/uwsgi.ini é…ç½®å¯åŠ¨ uwsgi æ³¨æ„äº‹é¡¹ è·¯å¾„ è¯´æ˜ /root/demo é¡¹ç›®è·¯å¾„ /usr/local/bin/python3 python3é»˜è®¤å®‰è£…è·¯å¾„ /etc/uwsgi.ini uwsgié…ç½®æ–‡ä»¶ /var/log/uwsgi/demo.log uwsgiæ—¥å¿—æ–‡ä»¶ /venv pythonè™šæ‹Ÿç¯å¢ƒè·¯å¾„ æœªå®‰è£…zlib*ï¼š 1zipimport.ZipImportError: can&apos;t decompress data; zlib not available # ç¼–è¯‘æ—¶æŠ¥é”™ æœªå®‰è£…opensslã€openssl-develï¼š 1pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available # pip å®‰è£… uwsgi æ—¶æŠ¥é”™ uwsgi æ— æ³•è®¿é—®ï¼Œæ—¥å¿—æŠ¥é”™ï¼š 1invalid request block size: 21573 (max 4096)...skip # åœ¨ /etc/uwsgi.ini ä¸­æ·»åŠ  buffer-size=32768","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"}]},{"title":"ä½¿ç”¨ oh-my-posh ç¾åŒ– PowerShell","slug":"oh-my-posh","date":"2019-01-04T16:00:00.000Z","updated":"2019-07-23T07:16:43.319Z","comments":true,"path":"2019/01/05/oh-my-posh/","link":"","permalink":"http://yoursite.com/2019/01/05/oh-my-posh/","excerpt":"","text":"è‹±æ–‡å­—ä½“æ˜¯æ”¯æŒPowerLineçš„DejaVuSansMonoå­—ä½“ï¼Œä¸­æ–‡å­—ä½“æ˜¯æ–‡æ³‰é©¿ç­‰å®½å¾®ç±³é»‘å­—ä½“ï¼‰ï¼Œå¹¶å°†ç»ˆç«¯å­—ä½“è®¾ç½®ä¸ºæ”¯æŒPowerLineçš„å­—ä½“ã€‚ç„¶åå¼€å§‹å®‰è£…oh-my-poshï¼ˆè¯¥æ­¥éª¤å¯èƒ½éœ€è¦æŸç§â€œè¾ƒä¸ºç¨³å®šâ€çš„ç½‘ç»œç¯å¢ƒï¼‰ã€‚åœ¨ç®¡ç†å‘˜æƒé™çš„PowerShellä¸‹æ‰§è¡ŒæŒ‡ä»¤ 1Set-ExecutionPolicy Bypass è¯¥æŒ‡ä»¤æ—¨åœ¨å…è®¸åŠ è½½å¹¶è¿è¡Œä»»æ„è„šæœ¬ã€‚å¯èƒ½ä¼šé€ æˆå®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åªè¦æœ‰æ€æ¯’è½¯ä»¶åœ¨å°±æ— éœ€æ‹…å¿ƒï¼Œæ¯•ç«Ÿæ²¡æœ‰äººä¼šæ— èŠåˆ°å¯¹ä¸€ä¸ªæ™®é€šçš„è®¡ç®—æœºç”¨æˆ·è¿›è¡Œé’ˆå¯¹æ€§æ”»å‡»ã€‚ ç„¶åå®‰è£…oh-my-poshçš„ä¾èµ–å’Œoh-my-poshæœ¬èº« 12Install-Module posh-git -Scope CurrentUserInstall-Module oh-my-posh -Scope CurrentUser å®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥é€šè¿‡ 1Import-Module oh-my-posh æ¥å°è¯•å¯ç”¨è¿™ä¸ªæ¨¡ç»„ã€‚ä¹‹åå°±å¯ä»¥ä½¿ç”¨ 1Set-Themeä¸»é¢˜å è¿™ç§æ ¼å¼çš„æŒ‡ä»¤æ¥åˆ‡æ¢ä¸åŒçš„æ˜¾ç¤ºé£æ ¼ã€‚ç¤ºä¾‹å›¾ä¸­çš„ä¸»é¢˜æ˜¯åŸºäºAgnosteræ”¹é€ çš„ï¼Œé»˜è®¤ä¸»é¢˜æ–‡ä»¶ä½äº ITä¹‹å®¶å­¦é™¢ï¼šä½¿ç”¨oh-my-poshç¾åŒ–Win10 PowerShell æ¥ä¸‹æ¥ä¾¿æ˜¯åœ¨PowerShellå¯åŠ¨æ—¶åŠ è½½è¿™ä¸ªæ¨¡ç»„äº†ã€‚ç±»ä¼¼äºLinux Bashçš„.bashrcï¼ŒPowerShellä¹Ÿæä¾›ç±»ä¼¼çš„Profileæ–‡ä»¶ç”¨äºåœ¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ã€‚è¾“å…¥ 1Test-Path $profile å¹¶æ‰§è¡Œï¼Œä»¥ç¡®å®šprofileæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœè¿”å›Falseï¼Œåˆ™åº”è¯¥æ‰§è¡Œï¼š 1New-Item -path $profile -type fileâ€“force æ¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚ç„¶åå»å¾€Profileçš„ç›®å½•ï¼ˆé€šå¸¸æ˜¯ä½ çš„æ–‡æ¡£ä¸‹çš„WindowsPowerShellç›®å½•ä¸‹ï¼‰ï¼Œä¿®æ”¹é‚£ä¸ªåç¼€ä¸ºps1çš„Profileæ–‡ä»¶ï¼ŒåŠ å…¥ä¸€è¡ŒImport-Module oh-my-poshå³å¯ã€‚ ä¸€åˆ‡å®Œæˆä¹‹åï¼ŒPowerShellåº”è¯¥æ¯”åŸå…ˆç¾è§‚äº†ä¸å°‘ï¼Œè€Œä¸”æç¤ºç¬¦çš„åŠŸèƒ½æ›´å¼ºäº†ã€‚åŸºäºoh-my-poshæ¡†æ¶ï¼Œè¿˜èƒ½è‡ªå·±ç¼–å†™æ›´å¤šçš„ä¸»é¢˜ã€‚","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"windows","slug":"windows","permalink":"http://yoursite.com/tags/windows/"},{"name":"powershell","slug":"powershell","permalink":"http://yoursite.com/tags/powershell/"}]},{"title":"jenkins å…¥é—¨æŒ‡å—","slug":"jenkins","date":"2019-01-03T16:00:00.000Z","updated":"2019-07-23T07:16:06.219Z","comments":true,"path":"2019/01/04/jenkins/","link":"","permalink":"http://yoursite.com/2019/01/04/jenkins/","excerpt":"","text":"sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.reposudo rpm â€“import https://pkg.jenkins.io/redhat-stable/jenkins.io.key yum install jenkins","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"jenkins","slug":"jenkins","permalink":"http://yoursite.com/tags/jenkins/"},{"name":"ci","slug":"ci","permalink":"http://yoursite.com/tags/ci/"}]},{"title":"gitlab-ce å…¥å‘æŒ‡å—","slug":"gitlab","date":"2019-01-02T16:00:00.000Z","updated":"2019-07-23T07:15:42.175Z","comments":true,"path":"2019/01/03/gitlab/","link":"","permalink":"http://yoursite.com/2019/01/03/gitlab/","excerpt":"","text":"æ›´æ–°è½¯ä»¶åŒ…1yum update -y é…ç½®é˜²ç«å¢™1[root@gitlab ~]# vim /etc/sysctl.conf 1net.ipv4.ip_forward = 1 å¯ç”¨å¹¶å¯åŠ¨é˜²ç«å¢™ 12[root@gitlab ~]# systemctl enable firewalld[root@gitlab ~]# systemctl start firewalld æ”¾é€š HTTPã€HTTPS 12[root@gitlab ~]# firewall-cmd --add-service=http --permanent[root@gitlab ~]# firewall-cmd --add-service=https --permanent é‡è½½å…¥é˜²ç«å¢™ 1[root@gitlab ~]# systemctl reload firewalld å®‰è£… postfixGitLab éœ€è¦ä½¿ç”¨ postfix æ¥å‘é€é‚®ä»¶ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ SMTP æœåŠ¡å™¨ 1[root@gitlab ~]# vim /etc/postfix/main.cf 12# inet_protocols = allinet_protocols = ipv4 å¯ç”¨å¹¶å¯åŠ¨ postfix 1[root@gitlab ~]# systemctl restart postfix é…ç½® swapç”±äº GitLab è¾ƒä¸ºæ¶ˆè€—èµ„æºï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºäº¤æ¢åˆ†åŒºï¼Œä»¥é™ä½ç‰©ç†å†…å­˜çš„å‹åŠ›ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœæœåŠ¡å™¨é…ç½®å¤Ÿé«˜ï¼Œåˆ™ä¸å¿…é…ç½®äº¤æ¢åˆ†åŒºã€‚ æ–°å»º 2 GB å¤§å°çš„äº¤æ¢åˆ†åŒº 1[root@gitlab ~]# dd if=/dev/zero of=/root/swapfile bs=1M count=2048 æ ¼å¼åŒ–ä¸ºäº¤æ¢åˆ†åŒºæ–‡ä»¶å¹¶å¯ç”¨ 12[root@gitlab ~]# mkswap /root/swapfile[root@gitlab ~]# swapon /root/swapfile æ·»åŠ è‡ªå¯ç”¨ 1[root@gitlab ~]# vim /etc/fstab 1/root/swapfile swap swap defaults 0 0 å®‰è£… GitLab å°†è½¯ä»¶æºä¿®æ”¹ä¸ºå›½å†…æº 1[root@gitlab ~]# vim /etc/yum.repos.d/gitlab-ce.repo 12345[gitlab-ce]name=Gitlab CE Repositorybaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/gpgcheck=0enabled=1 å®‰è£… GitLab 12[root@gitlab ~]# yum makecache[root@gitlab ~]# yum install -y gitlab-ce 12345678910111213141516171819202122 *. *. *** *** ***** ***** .****** ******* ******** ******** ,,,,,,,,,***********,,,,,,,,,,,,,,,,,,,,*********,,,,,,,,,,,.,,,,,,,,,,,*******,,,,,,,,,,,, ,,,,,,,,,*****,,,,,,,,,. ,,,,,,,****,,,,,, .,,,***,,,, ,*,. _______ __ __ __ / ____(_) /_/ / ____ _/ /_ / / __/ / __/ / / __ `/ __ \\/ /_/ / / /_/ /___/ /_/ / /_/ /\\____/_/\\__/_____/\\__,_/_.___/Thank you for installing GitLab! é…ç½® HTTPS è¯ä¹¦ ç”Ÿæˆ key æ–‡ä»¶ 1[root@gitlab ~]# openssl genrsa -out \"/etc/gitlab/ssl/gitlab.example.com.key\" è¾“å‡ºï¼š 1234Generating RSA private key, 2048 bit long modulus.........................................................................................................+++..............................................................+++e is 65537 (0x10001) ç”Ÿæˆ csr æ–‡ä»¶ 1[root@gitlab ssl]# openssl req -new -key \"/etc/gitlab/ssl/gitlab.example.com.key\" -out \"/etc/gitlab/ssl/gitlab.example.com.csr\" è¾“å‡ºï¼š 12345678910111213141516171819You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter &apos;.&apos;, the field will be left blank.-----Country Name (2 letter code) [XX]:cnState or Province Name (full name) []:szLocality Name (eg, city) [Default City]:szOrganization Name (eg, company) [Default Company Ltd]:exampleOrganizational Unit Name (eg, section) []:Common Name (eg, your name or your server&apos;s hostname) []:gitlab.example.comEmail Address []:admin@example.comPlease enter the following &apos;extra&apos; attributesto be sent with your certificate requestA challenge password []:passwordAn optional company name []: ç”Ÿæˆ crt æ–‡ä»¶ 1[root@gitlab ~]# openssl x509 -req -days 365 -in \"/etc/gitlab/ssl/gitlab.example.com.csr\" -signkey \"/etc/gitlab/ssl/gitlab.example.com.key\" -out \"/etc/gitlab/ssl/gitlab.example.com.crt\" è¾“å‡ºï¼š 123Signature oksubject=/C=cn/ST=sz/L=sz/O=example/CN=gitlab.example.com/emailAddress=admin@example.comGetting Private key ç”Ÿæˆ dhparams.pem 1[root@gitlab ssl]# openssl dhparam -out /etc/gitlab/ssl/dhparams.pem 2048 åˆå§‹åŒ– GitLab é…ç½® GitLab 1[root@gitlab ~]# vim /etc/gitlab/gitlab.rb 12345external_url &apos;http://gitlab.example.com&apos;nginx[&apos;redirect_http_to_https&apos;] = truenginx[&apos;ssl_certificate&apos;] = &quot;/etc/gitlab/ssl/gitlab.example.com.crt&quot;nginx[&apos;ssl_certificate_key&apos;] = &quot;/etc/gitlab/ssl/gitlab.example.com.key&quot;nginx[&apos;ssl_dhparam&apos;] = &quot;/etc/gitlab/ssl/dhparams.pem&quot; åˆå§‹åŒ– GitLab 1[root@gitlab ~]# gitlab-ctl reconfigure ä¿®æ”¹ nginx é…ç½® 1[root@gitlab ~]# vim /var/opt/gitlab/nginx/conf/gitlab-http.conf 12345678910111213141516server &#123; listen *:80; rewrite ^(.*)$ https://$host$1 permanent; # æ–°å¢ server_name gitlab.example.com; server_tokens off; ## Don&apos;t show the nginx version number, a security best practice location / &#123; return 301 https://gitlab.example.com:443$request_uri; &#125; access_log /var/log/gitlab/nginx/gitlab_access.log gitlab_access; error_log /var/log/gitlab/nginx/gitlab_error.log;&#125; é‡å¯ gitlab 1[root@gitlab ~]# gitlab-ctl restart","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"gitlab","slug":"gitlab","permalink":"http://yoursite.com/tags/gitlab/"}]},{"title":"ä½¿ç”¨ Ambari éƒ¨ç½² Hadoop é›†ç¾¤","slug":"ambari","date":"2018-12-17T16:00:00.000Z","updated":"2019-07-23T07:15:03.007Z","comments":true,"path":"2018/12/18/ambari/","link":"","permalink":"http://yoursite.com/2018/12/18/ambari/","excerpt":"","text":"é…ç½®æœ¬åœ°yumæºå®‰è£…httpd1yum install httpd -y åœ¨å®˜æ–¹ä¸‹è½½é•œåƒæ–‡ä»¶123456wget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari.repowget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/hdp.repowget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari-2.6.1.0-centos7.tar.gzwget http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/centos7/HDP-UTILS-1.1.0.22-centos7.tar.gzwget http://public-repo-1.hortonworks.com/HDP-GPL/centos7/2.x/updates/2.6.4.0/HDP-GPL-2.6.4.0-centos7-rpm.tar.gzwget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/HDP-2.6.4.0-centos7-rpm.tar.gz å°†å¯¹åº”çš„taråŒ…è§£å‹åˆ°httpdçš„æ–‡ä»¶ç›®å½•12345cd /var/www/htmltar -zxvf ambari-2.6.1.0-centos7.tar.gztar -zxvf HDP-2.6.4.0-centos7-rpm.tar.gz tar -zxvf HDP-GPL-2.6.4.0-centos7-rpm.tar.gz tar -zxvf HDP-UTILS-1.1.0.22-centos7.tar.gz é…ç½®åŸºç¡€æºï¼Œåˆ›å»ºhadoopçš„repoæ–‡ä»¶12# ambari æºvim /etc/yum.repo.d/ambari.repo 1234567[ambari-2.6.1.0]name=ambari Version - ambari-2.6.1.0baseurl=http://192.168.10.11/ambari/centos7/2.6.1.0-143gpgcheck=1gpgkey=http://192.168.10.11/ambari/centos7/2.6.1.0-143/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1 12# hadoopæºvim /etc/yum.repo.d/hdp.repo 123456789101112131415161718192021222324#VERSION_NUMBER=2.6.4.0-91[HDP-2.6.4.0]name=HDP Version - HDP-2.6.4.0baseurl=http://192.168.10.11/HDP/centos7/2.6.4.0-91gpgcheck=1gpgkey=http://192.168.10.11/HDP/centos7/2.6.4.0-91/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1[HDP-UTILS-1.1.0.22]name=HDP-UTILS Version - HDP-UTILS-1.1.0.22baseurl=http://192.168.10.11/HDP-UTILS/centos7/1.1.0.22/gpgcheck=1gpgkey=http://192.168.10.11/HDP-UTILS/centos7/1.1.0.22/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1[HDP-GPL-2.6.4.0]name=HDP-GPL Version - HDP-GPL-2.6.4.0baseurl=http://192.168.10.11/HDP-GPL/centos7/2.6.4.0-91gpgcheck=1gpgkey=http://192.168.10.11/HDP-GPL/centos7/2.6.4.0-91/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1 å¯åŠ¨httpd12systemctl enable httpdsystemctl start httpd å°†æœ¬åœ°æºçš„repoé…ç½®æ‹·è´åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œå¹¶åˆ›å»ºç¼“å­˜123scp /etc/yum.repos.d/ambari.repo 192.168.135.4:/etc/yum.repos.d/scp /etc/yum.repos.d/ambari.repo 192.168.135.5:/etc/yum.repos.d/scp /etc/yum.repos.d/hdp.repo 192.168.135.6:/etc/yum.repos.d/ åœ¨å„ä¸ªèŠ‚ç‚¹åˆ›å»ºç¼“å­˜ï¼š 12yum clean allyum makecache fast åˆå§‹åŒ–ç¯å¢ƒå„ä¸ªèŠ‚ç‚¹å®‰è£…java-1.8.0-openjdk1yum install java-1.8.0-openjdk -y è§£æä¸»æœºå123echo \"192.168.135.4 node2\" &gt;&gt; /etc/hostsecho \"192.168.135.5 node3\" &gt;&gt; /etc/hostsecho \"192.168.135.6 node4\" &gt;&gt; /etc/hosts åˆ›å»ºä¸»æœºä¿¡ä»»å…³ç³»1234ssh-keygenssh-copy-id node-1ssh-copy-id node-2ssh-copy-id node-3 å®‰è£…é…ç½®æ•°æ®åº“123yum install mariadb-server -ysystemctl enable mariadbsystemctl start mariadb åˆ›å»ºæ•°æ®åº“1mysql 123456789set password=password('123456');grant all on *.* to root@localhost identified by '123456';grant all on *.* to root@'%' identified by '123456';create database ambari default character set utf8;grant all on ambari.* to ambari@localhost identified by 'bigdata';grant all on ambari.* to ambari@'%' identified by 'bigdata';create database hive default character set utf8;grant all on hive.* to hive@localhost identified by 'hive';grant all on hive.* to hive@'%' identified by 'hive'; å®‰è£…AmabriæœåŠ¡åœ¨node-1ä¸Šå®‰è£…ambari-server,å¹¶å¯åŠ¨é…ç½®å‘å¯¼12yum install ambari-server -yambari-server setup æŒ‰ç…§é…ç½®å‘å¯¼ä¿¡æ¯ã€é…ç½®ç”¨æˆ·ã€java_home123456789101112131415161718192021222324252627282930313233343536373839404142434445ambari-server setupUsing python /usr/bin/pythonSetup ambari-serverChecking SELinux...SELinux status is 'disabled'Customize user account for ambari-server daemon [y/n] (n)? yEnter user account for ambari-server daemon (root):ambari Adjusting ambari-server permissions and ownership...Checking firewall status...Checking JDK...[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7[3] Custom JDK==============================================================================Enter choice (1): 3WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.Path to JAVA_HOME: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre # å¡«å†™java_homeValidating JDK on Ambari Server...done.Checking GPL software agreement...GPL License for LZO: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.htmlEnable Ambari Server to download and install GPL Licensed LZO packages [y/n] (n)? nCompleting setup...Configuring database...Enter advanced database configuration [y/n] (n)? y Configuring database...==============================================================================Choose one of the following options:[1] - PostgreSQL (Embedded)[2] - Oracle[3] - MySQL / MariaDB[4] - PostgreSQL[5] - Microsoft SQL Server (Tech Preview)[6] - SQL Anywhere[7] - BDB==============================================================================Enter choice (1): 3Hostname (localhost): Port (3306): Database name (ambari): Username (ambari): Enter Database Password (bigdata): Configuring ambari database...WARNING: Before starting Ambari Server, you must copy the MySQL JDBC driver JAR file to /usr/share/java and set property \"server.jdbc.driver.path=[path/to/custom_jdbc_driver]\" in ambari.properties.Press &lt;enter&gt; to continue. åˆ°ä¸Šé¢ä¸€æ­¥æ—¶ï¼Œæ ¹æ®æç¤ºä¸Šä¼ mysqlçš„jdbcé©±åŠ¨ï¼Œå¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šjdbcé©±åŠ¨æ–‡ä»¶ä½ç½®ï¼š123456cd /usr/share/javalltar xf mysql-connector-java-5.1.45.tar.gz mv mysql-connector-java-5.1.45/mysql-connector-java-5.1.45-bin.jar ./# ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼švim /etc/ambari-server/conf/ambari.properties 1server.jdbc.driver.path=/usr/share/java/mysql-connector-java-5.1.45-bin.jar é…ç½®å®Œæˆåç»§ç»­ï¼Œä¼šå‡ºç°å¦‚ä¸‹æç¤ºï¼š Press to continue.Configuring remote database connection propertiesâ€¦WARNING: Before starting Ambari Server, you must run the following DDL against the database to create the schema: /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sqlProceed with configuring remote database connection properties [y/n] (y)? å‡ºç°ä¸Šè¿°æç¤ºæ—¶ï¼Œæ ¹æ®ä¿¡æ¯å¯¼å…¥æ•°æ®åº“1mysql -uroot -p ambari &lt; /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql å¯åŠ¨æœåŠ¡1ambari-server start","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"ambari","slug":"ambari","permalink":"http://yoursite.com/tags/ambari/"},{"name":"hadoop","slug":"hadoop","permalink":"http://yoursite.com/tags/hadoop/"}]},{"title":"Ansible è‡ªåŠ¨åŒ–è¿ç»´å®æˆ˜","slug":"ansible","date":"2018-12-16T16:00:00.000Z","updated":"2019-07-23T07:15:13.338Z","comments":true,"path":"2018/12/17/ansible/","link":"","permalink":"http://yoursite.com/2018/12/17/ansible/","excerpt":"","text":"Ad-Hocå‘½ä»¤ç®€ä»‹å¹¶è¡Œå’ŒShellå‘½ä»¤è®©æˆ‘ä»¬ä½¿ç”¨Ansibleçš„å‘½ä»¤è¡Œå·¥å…·é‡å¯atlantaçš„æ‰€æœ‰WebæœåŠ¡å™¨ï¼Œä¸€æ¬¡10ä¸ªã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®SSHä»£ç†ï¼Œä»¥ä¾¿å®ƒèƒ½è®°ä½æˆ‘ä»¬çš„å‡­æ®ï¼š 12ssh-agent bashssh-add ~/.ssh/id_rsa playbook 1234567[nginx]name=nginx repobaseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/gpgcheck=0enabled=1","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"ansible","slug":"ansible","permalink":"http://yoursite.com/tags/ansible/"},{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"}]},{"title":"Arch Linux å…¥å‘æŒ‡å—","slug":"archlinux_install","date":"2018-12-15T16:00:00.000Z","updated":"2019-07-23T07:15:16.271Z","comments":true,"path":"2018/12/16/archlinux_install/","link":"","permalink":"http://yoursite.com/2018/12/16/archlinux_install/","excerpt":"","text":"ç³»ç»Ÿå®‰è£…è¿æ¥ç½‘ç»œ1wifi-menu ç£ç›˜åˆ†åŒº123456fdisk -lfdisk /dev/sda# 1. å…ˆå°†ç¡¬ç›˜æ ¼å¼è½¬æ¢ä¸º GPT# 2. åˆ›å»º sda1 EFI åˆ†åŒº 200M# 3. åˆ›å»º ada2 boot åˆ†åŒº 1G# 4. å‰©ä¸‹çš„ sda3 Linux LVM åˆ†åŒº 1234# æ ¼å¼åŒ–ä¸‰ä¸ªåˆ†åŒºmkfs.vfat -F32 /dev/sda1mkfs.ext4 /dev/sda2mkfs.xfs /dev/sda3 æŸ¥çœ‹ç¡¬ç›˜çš„åˆ†åŒºæƒ…å†µ1lsblk -l åˆ›å»ºå¹¶æŒ‚è½½ç›®å½•12345678# ä¸€å®šè¦å…ˆæŒ‚è½½ /mntmount /dev/sda3 /mnt# åˆ›å»º boot æ–‡ä»¶å¤¹å¹¶æŒ‚è½½mkdir /mnt/bootmount /dev/sda2 /mnt/boot# åˆ›å»º efi æ–‡ä»¶å¤¹å¹¶æŒ‚è½½mkdir /mnt/boot/efimount /dev/sda1 /mnt/boot/efi å®‰è£…åŸºæœ¬ç³»ç»Ÿ1pacstrap /mnt base ç”Ÿæˆ fstab1genfstab -U /mnt &gt;&gt; /mnt/etc/fstab Change root åˆ°æ–°å®‰è£…çš„ç³»ç»Ÿ12arch-chroot /mntpacman -S vim net-tools Locale12# ç¼–è¾‘åœ°åŒºä¿¡æ¯ç”Ÿæˆæ–‡ä»¶vim /etc/locale.gen 1234# ç”Ÿæˆåœ°åŒºä¿¡æ¯locale-gen# å†™è¿›é…ç½®æ–‡ä»¶echo LANG=zh_CN.UTF-8 &gt; /etc/locale.conf è®¾ç½®æ—¶åŒº12ln -S /usr/share/zoneinfo/Asia/Shanghai /etc/localtimehwclock --localtime ä¸»æœºå12echo myhostname &gt; /etc/hostnamevim /etc/hosts Root å¯†ç 1passwd å®‰è£… GRUB1234pacman -S grub-efi-x86_64pacman -S efibootmgrgrub-install --efi-directory=/boot/efi --bootloader-id=arch --recheckgrub-mkconfig -o /boot/grub/grub.cfg é‡å¯12345exitumount /mnt/boot/efiumount /mnt/bootumount /mntreboot å®‰è£…å›¾å½¢åŒ–ç•Œé¢è®¾ç½® archlinux æº1vim /etc/pacman.d/mirrorlist æ›´æ–°æºå¹¶ä¸”å®‰è£…yaourt:1pacman -Syu yaourt å®‰è£…é©±åŠ¨ è§¦æ‘¸æ¿é©±åŠ¨ 1pacman -S xf86-input-libinput xf86-input-synaptics æ˜¾ç¤ºé©±åŠ¨ 123pacman -S xf86-video-intelpacman -S mesa-libgl libva-intel-driver libvdpau-va-glmesa-demospacman -S nvidia nvidia-settings å£°éŸ³ 1pacman -S alsa-utils æ— çº¿ç½‘å¡å®‰è£…BCM4322 123pacman -S linux-firmwarepacman -S linux-headersyaourt -S broadcom-wl-dkms å®‰è£…Deepinæ¡Œé¢ç¯å¢ƒ 1.å®‰è£…Xorgå’Œå…¶å·¥å…·åŒ… 1pacman -S xorg-server xorg-xinit 2.DDEåŸºæœ¬ç¯å¢ƒå®‰è£… 123pacman -S deepin deepin-extra lightdmpacman -S file-roller evince gedit thunderbird gpicviewpacman -S unrar unzip p7zip 3.ä¿®æ”¹lightdm.confä½¿ç”¨ç™»å½•ç®¡ç†å™¨ 123/etc/lightdm/lightdm.confgreeter-session=lightdm-deepin-greetersystemctl enable lightdm 4.é…ç½®ç½‘ç»œè¿æ¥ 12pacman -S networkmanagersystemctl enable NetworkManager å®‰è£…å¸¸ç”¨è½¯ä»¶ 1.æœç‹—è¾“å…¥æ³•å®‰è£… 12pacman -S fcitx fcitx-configtoolpacman -S fcitx-sougoupinyin åœ¨ç”¨æˆ·ç›®å½•ä¸‹æ·»åŠ ä¸ªé…ç½®æ–‡ä»¶ï¼š 1234nano ~/.xprofileexport GTK_IM_MODULE=fcitxexport QT_IM_MODULE=fcitxexport XMODIFIERS=@im=fcitx 1pacman -S opencc ï¼ˆç®€ä½“å’Œç¹ä½“äº’ç›¸è½¬æ¢çš„åº“ï¼‰ 2.æµè§ˆå™¨ 1234pacman -S chromiumpacman -S google-chromepacman -S firefoxpacman -S git","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"archlinux","slug":"archlinux","permalink":"http://yoursite.com/tags/archlinux/"}]},{"title":"Linux æ–‡æœ¬å¤„ç†å™¨ä¹‹ awk","slug":"awk","date":"2018-12-14T16:00:00.000Z","updated":"2019-07-23T07:15:19.255Z","comments":true,"path":"2018/12/15/awk/","link":"","permalink":"http://yoursite.com/2018/12/15/awk/","excerpt":"","text":"12345678910111213awk 'BEGIN&#123;FS=\"[:]\"&#125; &#123;aa+=$3&#125; END&#123;print \"æ‰€ç”¨çš„UIDçš„å’Œæ˜¯:\",aa&#125;' passwdFS awk 'BEGIN&#123;FS=\"[:]\"&#125; /root/&#123;print $1,$2&#125;' passwdOFS awk 'BEGIN&#123;FS=\"[:]\";OFS=\"---\"&#125; /root/&#123;print $1,$2&#125;' passwdNF awk -F: '&#123;print NF&#125;' passwdRS awk 'BEGIN&#123;FS=\"[,]\";RS=\" \"&#125;&#123;print $2&#125;' bb.txtORS awk 'BEGIN&#123;FS=\"[:]\";ORS=\"---\"&#125;&#123;print $0&#125;' passwdFILENAME awk -F\"[:]\" '&#123;print FILENAME&#125;' passwdNR awk '&#123;print NR&#125;' a.txt b.txtFNR awk '&#123;print NR&#125;' a.txt b.txt# NR==FNR æ­¤æ—¶å¤„ç†çš„æ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶# NR!=FNR æ­¤æ—¶å¤„ç†çš„æ˜¯ç¬¬äºŒä¸ªæ–‡ä»¶awk 'NR==FNR&#123;print FILENAME&#125; NR!=FNR&#123;print FILENAME&#125;' a.txt b.txtif awk -F[:] '&#123;if($3&lt;=1000)&#123;print $1\"æ˜¯rootç”¨æˆ·\"&#125;else&#123;print $1\"æ˜¯æ™®é€šç”¨æˆ·\"&#125;&#125;' /etc/passwd å˜é‡å å±æ€§ $0 å½“å‰è®°å½• $1~$n å½“å‰è®°å½•çš„ç¬¬nä¸ªå­—æ®µ FS è¾“å…¥å­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ RS è¾“å…¥è®°å½•åˆ†å‰²ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ NF å½“å‰è®°å½•ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œå°±æ˜¯æœ‰å¤šå°‘åˆ— NR å·²ç»è¯»å‡ºçš„è®°å½•æ•°ï¼Œå°±æ˜¯è¡Œå·ï¼Œä»1å¼€å§‹ OFS è¾“å‡ºå­—ç¬¦åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¹Ÿæ˜¯ç©ºæ ¼ ORS è¾“å‡ºçš„è®°å½•åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦","categories":[{"name":"shell","slug":"shell","permalink":"http://yoursite.com/categories/shell/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"http://yoursite.com/tags/shell/"}]},{"title":"CentOS Oracle 12c å®‰è£…æŒ‡å—","slug":"centos_install_oracle12c","date":"2018-12-13T16:00:00.000Z","updated":"2019-07-23T07:15:29.545Z","comments":true,"path":"2018/12/14/centos_install_oracle12c/","link":"","permalink":"http://yoursite.com/2018/12/14/centos_install_oracle12c/","excerpt":"","text":"1. ä¼˜åŒ–ã€å®‰è£…å¿…è¦çš„å·¥å…·1234567[root@oracle12c ~]$ yum -y install unzip vim lrzsz[root@oracle12c ~]$ setenforce 0[root@oracle12c ~]$ sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config[root@oracle12c ~]$ reboot[root@oracle12c ~]$ sed -i &apos;s/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/&apos; /etc/ssh/sshd_config[root@oracle12c ~]$ sed -i &apos;s/#UseDNS yes/UseDNS no/&apos; /etc/ssh/sshd_config[root@oracle12c ~]$ service sshd restart 2. å®‰è£…ä¾èµ–1[root@oracle12c ~]$ yum -y install binutils compat-libcap1 compat-libstdc++-33 compat-libstdc++-33*.i686 elfutils-libelf-devel gcc gcc-c++ glibc*.i686 glibc glibc-devel glibc-devel*.i686 ksh libgcc*.i686 libgcc libstdc++ libstdc++*.i686 libstdc++-devel libstdc++-devel*.i686 libaio libaio*.i686 libaio-devel libaio-devel*.i686 make sysstat unixODBC unixODBC*.i686 unixODBC-devel unixODBC-devel*.i686 libXp 3. å»ºç«‹ç”¨æˆ·å’Œç»„12345[root@oracle12c ~]$ groupadd oinstall[root@oracle12c ~]$ groupadd dba[root@oracle12c ~]$ groupadd oper[root@oracle12c ~]$ useradd -g oinstall -G dba,oper oracle[root@oracle12c ~]$ echo oracle | passwd --stdin oracle 4. åˆ›å»ºå®‰è£…ã€å¤‡ä»½ç›®å½•12[root@oracle12c ~]$ mkdir -p /u01/app/oracle/product/12.2.0[root@oracle12c ~]$ chown -R oracle:oinstall /u01 5. æ›´æ”¹å…±äº«å†…å­˜1[root@oracle12c ~]$ echo &quot;shmfs /dev/shm tmpfs size=12g 0&quot; &gt;&gt; /etc/fstab 6. ä¿®æ”¹å†…æ ¸å‚æ•°1[root@oracle12c ~]$ vim /etc/sysctl.conf 1234567891011121314fs.file-max = 6815744kernel.sem = 250 32000 100 128kernel.shmmni = 4096kernel.shmall = 4294967296kernel.shmmax = 4398046511104kernel.panic_on_oops = 1net.core.rmem_default = 262144net.core.rmem_max = 4194304net.core.wmem_default = 262144net.core.wmem_max = 1048576net.ipv4.conf.all.rp_filter = 2net.ipv4.conf.default.rp_filter = 2fs.aio-max-nr = 1048576net.ipv4.ip_local_port_range = 9000 65500 1[root@oracle12c ~]$ sysctl -p 7. æ”¹æ–‡ä»¶é™åˆ¶1[root@oracle12c ~]$ vim /etc/security/limits.conf 12345oracle soft nproc 2047oracle hard nproc 16384oracle soft nofile 1024oracle hard nofile 65536oracle soft stack 10240 8. ä¿®æ”¹ç™»é™†é…ç½®æ–‡ä»¶1[root@oracle12c ~]$ vim /etc/pam.d/login 1session required pam_limits.so 9. ä¿®æ”¹ ulimit1[root@oracle12c ~]$ vim /etc/profile 12345678if [ $USER = &quot;oracle&quot; ]; then if [ $SHELL = &quot;/bin/ksh&quot; ]; then ulimit -p 16384 ulimit -n 65536a else ulimit -u 16384 -n 65536 fifi 10. ä¿®æ”¹ç¯å¢ƒå˜é‡1[root@oracle12c ~]$ vim ~/.bash_profile 1234567PATH=$PATH:$HOME/.local/bin:$HOME/bin:$ORACLE_HOME/binORACLE_BASE=/u01/app/oracleORACLE_HOME=$ORACLE_BASE/product/12.2.0ORACLE_SID=orclexport ORACLE_BASE ORACLE_HOME ORACLE_SIDexport NLS_LANG=&quot;AMERICAN_AMERICA.UTF8&quot;export PATH 11. ä¿®æ”¹ hosts æ–‡ä»¶1[root@oracle12c ~]$ vim /etc/hosts 1[ipaddr] oracle12c 12. ä¸Šä¼ å®‰è£…åŒ… linuxx64_12201_database.zip1[oracle@oracle12c ~]$ rz 13. é™é»˜å®‰è£…æ•°æ®åº“è½¯ä»¶12[oracle@oracle12c ~]$ cd database[oracle@oracle12c database]$ ./runInstaller -silent -ignoreSysPrereqs -ignorePrereq -responseFile /home/oracle/database/response/db_install.rsp /home/oracle/database/response/db_install.rsp 1234567891011121314151617oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v12.2.0oracle.install.option=INSTALL_DB_SWONLYUNIX_GROUP_NAME=dbaINVENTORY_LOCATION=/u01/app/oracle/oraInventoryORACLE_HOME=/u01/app/oracle/product/12.2.0ORACLE_BASE=/u01/app/oracleoracle.install.db.InstallEdition=EEoracle.install.db.OSDBA_GROUP=dbaoracle.install.db.OSOPER_GROUP=dbaoracle.install.db.OSBACKUPDBA_GROUP=dbaoracle.install.db.OSDGDBA_GROUP=dbaoracle.install.db.OSKMDBA_GROUP=dbaoracle.install.db.OSRACDBA_GROUP=dbaoracle.install.db.CLUSTER_NODES=oracle.install.db.isRACOneInstall=falseSECURITY_UPDATES_VIA_MYORACLESUPPORT=falseDECLINE_SECURITY_UPDATES=true 14. å»ºç«‹æ•°æ®åº“1[oracle@oracle12c ~]$ $ORACLE_HOME/bin/dbca -silent -createDatabase -templateName General_Purpose.dbc -gdbname orcl -sid orcl -responseFile NO_VALUE -characterSet AL32UTF8 -memoryPercentage 50 -emConfiguration LOCAL root ç”¨æˆ·ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 12[root@oracle12c ~]$ /oracle/oraInventory/orainstRoot.sh[root@oracle12c ~]$ /oracle/product/12.2.0/root.sh 15. ä¿®æ”¹å‚æ•°1[oracle@oracle12c ~]$ sqlplus / as sysdba 12345678910111213141516171819202122232425262728293031323334353637383940SQL&gt; alter system set sga_target=0 scope=spfile;SQL&gt; alter system set pga_aggregate_target=0 scope=spfile;SQL&gt; alter system set db_files=2000 scope=spfile;SQL&gt; alter system set memory_max_target=12g scope=spfile;SQL&gt; alter system set memory_target=8g scope=spfile;SQL&gt; alter system set LOG_ARCHIVE_DEST_1='LOCATION=/backup/arch' scope=spfile;SQL&gt; alter SYSTEM set db_recovery_file_dest_size=4096M scope=spfile;SQL&gt; alter system set undo_retention=3600 scope=spfile;SQL&gt; alter system set processes=6000 scope=spfile;SQL&gt; alter system set sessions=8000 scope=spfile;SQL&gt; alter system set open_cursors=2000 scope=both;SQL&gt; create pfile='/tmp/pfile01.ora' from spfile;SQL&gt; alter system set filesystemio_options='asynch' scope=spfile;SQL&gt; alter system set disk_asynch_io=true SCOPE=SPFILE;SQL&gt; create directory expdp_dir as '/backup/expdp';SQL&gt; grant write,read on directory expdp_dir to public;SQL&gt; alter database add logfile group 4 '/u01/app/oracle/oradata/orcl/redo04.log' size 1G;SQL&gt; alter database add logfile group 5 '/u01/app/oracle/oradata/orcl/redo05.log' size 1G;SQL&gt; alter database add logfile group 6 '/u01/app/oracle/oradata/orcl/redo06.log' size 1G;SQL&gt; alter system switch logfile;SQL&gt; alter system switch logfile;SQL&gt; alter system switch logfile;SQL&gt; alter system checkpoint;SQL&gt; alter database drop logfile group 1;SQL&gt; alter database drop logfile group 2;SQL&gt; alter database drop logfile group 3;SQL&gt; host rm -rf /u01/app/oracle/oradata/orcl/redo0[1-3].logSQL&gt; alter database add logfile group 1 '/u01/app/oracle/oradata/orcl/redo01.log' size 1G;SQL&gt; alter database add logfile group 2 '/u01/app/oracle/oradata/orcl/redo02.log' size 1G;SQL&gt; alter database add logfile group 3 '/u01/app/oracle/oradata/orcl/redo03.log' size 1G; SQL&gt; alter system switch logfile;SQL&gt; alter system switch logfile;SQL&gt; alter system switch logfile;SQL&gt; alter system checkpoint;SQL&gt; shutdown immediateSQL&gt; startup mountSQL&gt; alter database archivelog;SQL&gt; alter database open;SQL&gt; alter profile default limit FAILED_LOGIN_ATTEMPTS unlimited;SQL&gt; create pfile='/tmp/pfile02.ora' from spfile; 16. ä¿®æ”¹ Oracle æœåŠ¡å¯åŠ¨é…ç½®1[root@oracle12c ~]$ vim /etc/oratab 1orcl:/u01/app/oracle/product/12.2.0:Y","categories":[{"name":"database","slug":"database","permalink":"http://yoursite.com/categories/database/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"oracle","slug":"oracle","permalink":"http://yoursite.com/tags/oracle/"}]},{"title":"Docker å…¥å‘æŒ‡å—","slug":"docker","date":"2018-12-11T16:00:00.000Z","updated":"2019-07-23T07:15:32.979Z","comments":true,"path":"2018/12/12/docker/","link":"","permalink":"http://yoursite.com/2018/12/12/docker/","excerpt":"","text":"1. Docker å®‰è£… Ubuntu 123456789101112131415161718# step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·sudo apt updatesudo apt -y install apt-transport-https ca-certificates curl software-properties-common# step 2: å®‰è£…GPGè¯ä¹¦curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -# Step 3: å†™å…¥è½¯ä»¶æºä¿¡æ¯sudo add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\"# Step 4: æ›´æ–°å¹¶å®‰è£… Docker-CEsudo apt -y updatesudo apt -y install docker-ce# å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE:# Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬:# apt-cache madison docker-ce# docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages# docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages# Step 2: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSION ä¾‹å¦‚ä¸Šé¢çš„ 17.03.1~ce-0~ubuntu-xenial)# sudo apt-get -y install docker-ce=[VERSION] CentOS 1234567891011121314151617181920212223242526# step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·yum install -y yum-utils device-mapper-persistent-data lvm2# Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 3: æ›´æ–°å¹¶å®‰è£… Docker-CEyum makecache fastyum -y install docker-ce# Step 4: å¼€å¯DockeræœåŠ¡service docker start# æ³¨æ„ï¼š# å®˜æ–¹è½¯ä»¶æºé»˜è®¤å¯ç”¨äº†æœ€æ–°çš„è½¯ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¼–è¾‘è½¯ä»¶æºçš„æ–¹å¼è·å–å„ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚å®˜æ–¹å¹¶æ²¡æœ‰å°†æµ‹è¯•ç‰ˆæœ¬çš„è½¯ä»¶æºç½®ä¸ºå¯ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ã€‚åŒç†å¯ä»¥å¼€å¯å„ç§æµ‹è¯•ç‰ˆæœ¬ç­‰ã€‚# vim /etc/yum.repos.d/docker-ce.repo# å°† [docker-ce-test] ä¸‹æ–¹çš„ enabled=0 ä¿®æ”¹ä¸º enabled=1## å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE:# Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬:# yum list docker-ce.x86_64 --showduplicates | sort -r# Loading mirror speeds from cached hostfile# Loaded plugins: branch, fastestmirror, langpacks# docker-ce.x86_64 17.03.1.ce-1.el7.centos docker-ce-stable# docker-ce.x86_64 17.03.1.ce-1.el7.centos @docker-ce-stable# docker-ce.x86_64 17.03.0.ce-1.el7.centos docker-ce-stable# Available Packages# Step2 : å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSION ä¾‹å¦‚ä¸Šé¢çš„ 17.03.0.ce.1-1.el7.centos)# sudo yum -y install docker-ce-[VERSION] 2.3. å¸¸è§é—®é¢˜ é˜²ç«å¢™çš„é—®é¢˜ 123# CentOS 7 firewalld è®¾ç½®ï¼Œæ·»åŠ ç›¸åº”ç«¯å£firewall-cmd --permanent --add-port 80/tcpfirewall-cmd --reload IPv4 forwarding is disabled. Networking will not work. 12# vim /usr/lib/sysctl.d/00-system.conf åœ¨æœ€åæ·»åŠ ä¸€è¡Œnet.ipv4.ip_forward=1","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"docker","slug":"docker","permalink":"http://yoursite.com/tags/docker/"}]},{"title":"æ­å»ºåŸºäº HDFS ç¢ç‰‡æ–‡ä»¶å­˜å‚¨æœåŠ¡","slug":"hdfs","date":"2018-12-09T16:00:00.000Z","updated":"2019-07-23T07:15:46.102Z","comments":true,"path":"2018/12/10/hdfs/","link":"","permalink":"http://yoursite.com/2018/12/10/hdfs/","excerpt":"","text":"å‡†å¤‡ Java ç¯å¢ƒ123yum -y install java-1.8.0-openjdk*java -versionvim /etc/profile 123export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdkexport PATH=$PATH:$JAVA_HOME/binexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar 1source /etc/profile å‡†å¤‡ HDFS ç¯å¢ƒé…ç½® SSHå…ˆåæ‰§è¡Œå¦‚ä¸‹ä¸¤è¡Œå‘½ä»¤ï¼Œé…ç½® SSH ä»¥æ— å¯†ç æ¨¡å¼ç™»é™†ï¼š 12ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsacat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys æ¥ç€å¯ä»¥éªŒè¯ä¸‹ï¼Œåœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥èƒ½ä½¿ç”¨ ssh å‘½ä»¤æˆåŠŸè¿æ¥æœ¬æœºï¼š å®‰è£… Hadoop123456# åˆ›å»º /data/hadoop ç›®å½•ï¼Œç„¶åè¿›å…¥è¯¥ç›®å½•ï¼šmkdir -p /data/hadoop &amp;&amp; cd $_# ä¸‹è½½å¹¶è§£å‹ Hadoopï¼šwget http://archive.apache.org/dist/hadoop/core/hadoop-2.7.1/hadoop-2.7.1.tar.gztar -zxvf hadoop-2.7.1.tar.gzmv hadoop-2.7.1 hadoop &amp;&amp; mv $_ /usr/local/ ä¿®æ”¹ Hadoop ç¯å¢ƒé…ç½®æ–‡ä»¶ 1vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh 1export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk æŸ¥çœ‹ä¸‹ Hadoop çš„ç‰ˆæœ¬ï¼š 1/usr/local/hadoop/bin/hadoop version ä¿®æ”¹ Hadoop é…ç½®ç”±äºæˆ‘ä»¬çš„å®è·µç¯å¢ƒæ˜¯åœ¨å•æœºä¸‹è¿›è¡Œçš„ï¼Œæ‰€ä»¥æ­¤å¤„æŠŠ Hadoop é…ç½®ä¸ºä¼ªåˆ†å¸ƒå¼æ¨¡å¼ã€‚æ–°å»ºè‹¥å¹²ä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬åœ¨åç»­çš„é…ç½®ä¸­ä»¥åŠ HDFS å’Œ Hadoop çš„å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°è¿™äº›æ–‡ä»¶å¤¹ï¼š 1cd /usr/local/hadoop &amp;&amp; mkdir -p tmp dfs/name dfs/data ä¿®æ”¹ HDFS é…ç½®æ–‡ä»¶ core-site.xml 1vim /usr/local/hadoop/etc/hadoop/core-site.xml 12345678910&lt;configuration&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/usr/local/hadoop/tmp&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://localhost:9000&lt;/value&gt; &lt;/property&gt; &lt;/configuration&gt; ä¿®æ”¹ HDFS é…ç½®æ–‡ä»¶ hdfs-site.xml 1vim /usr/local/hadoop/etc/hadoop/hdfs-site.xml 123456789101112131415161718&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;file:/usr/local/hadoop/dfs/name&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;value&gt;file:/usr/local/hadoop/dfs/data&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.permissions&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; &lt;/configuration&gt; ä¿®æ”¹ HDFS é…ç½®æ–‡ä»¶ yarn-site.xml 1vim /usr/local/hadoop/etc/hadoop/yarn-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt; &lt;/configuration&gt; å¯åŠ¨ Hadoop 12345678910cd /usr/local/hadoop/bin/# å¯¹ HDFS æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ ¼å¼åŒ–ï¼š./hdfs namenode -format# æ¥ç€è¿›å…¥å¦‚ä¸‹ç›®å½•cd /usr/local/hadoop/sbin/# å…ˆåæ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªè„šæœ¬å¯åŠ¨ Hadoop./start-dfs.sh./start-yarn.sh# éªŒè¯ Hadoop æ˜¯å¦å¯åŠ¨æˆåŠŸï¼šjps åœ¨æµè§ˆå™¨ä¸­è®¿é—®å¦‚ä¸‹é“¾æ¥ï¼Œåº”è¯¥èƒ½æ­£å¸¸è®¿é—®ï¼š http://&lt;æ‚¨çš„ IP åœ°å€&gt;:50070/explorer.html#/æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®è·µä¸‹å¦‚ä½•å°†ç¢ç‰‡æ–‡ä»¶å­˜å‚¨åˆ° HDFS ä¸­ã€‚ å­˜å‚¨ç¢ç‰‡æ–‡ä»¶å‡†å¤‡ç¢ç‰‡æ–‡ä»¶123456# åˆ›å»ºç›®å½•ç”¨äºå­˜æ”¾ç¢ç‰‡æ–‡ä»¶ï¼Œè¿›å…¥è¯¥ç›®å½•ï¼šmkdir -p /data/file &amp;&amp; cd /data/file# æ–°å»ºä¸€æ‰¹ç¢ç‰‡æ–‡ä»¶åˆ°è¯¥ç›®å½•ä¸‹i=1; while [ $i -le 99 ]; do name=`printf \"test%02d.txt\" $i`; touch \"$name\"; i=$(($i+1)); donels å°†ç¢ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨ HDFS ä¸­12# åœ¨ HDFS ä¸Šæ–°å»ºç›®å½•/usr/local/hadoop/bin/hadoop fs -mkdir /dest æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨æ˜¯è®¿é—®å¦‚ä¸‹é“¾æ¥ï¼Œå¯ä»¥çœ‹åˆ° /dest ç›®å½•å·²åˆ›å»ºï¼Œä½†æ˜¯æš‚æ—¶è¿˜æ²¡æœ‰å†…å®¹ï¼š http://&lt;æ‚¨çš„ IP åœ°å€&gt;:50070/explorer.html#/dest ä¸Šä¼ ç¢ç‰‡æ–‡ä»¶123456groupadd supergroupusermod -a -G supergroup root# å°†ä¹‹å‰åˆ›å»ºçš„ç¢ç‰‡æ–‡ä»¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼šcd /data/file &amp;&amp; /usr/local/hadoop/bin/hadoop fs -put *.txt /dest/usr/local/hadoop/bin/hadoop fs -ls /dest# åœ¨ä¸Šä¼ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€å…ˆåˆ›å»º HDFS ç”¨æˆ·ç»„ supergroupï¼Œç„¶åå°† root ç”¨æˆ·æ·»åŠ åˆ°è¯¥ç»„ä¸­ï¼Œå¦åˆ™ä¼šå› æƒé™é—®é¢˜é¡µæŠ¥å‘Šå¼‚å¸¸ã€‚ è®¿é—®æœåŠ¡åœ¨æµè§ˆå™¨æ˜¯è®¿é—®å¦‚ä¸‹é“¾æ¥ï¼Œå¯ä»¥çœ‹åˆ° /dest ç›®å½•çš„æ–‡ä»¶å†…å®¹ï¼š 1http://&lt;æ‚¨çš„ IP åœ°å€&gt;:50070/explorer.html#/dest","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"hadoop","slug":"hadoop","permalink":"http://yoursite.com/tags/hadoop/"}]},{"title":"Hexo æ‰“é€ é™æ€åšå®¢","slug":"hexo","date":"2018-12-08T16:00:00.000Z","updated":"2019-07-23T07:15:49.414Z","comments":true,"path":"2018/12/09/hexo/","link":"","permalink":"http://yoursite.com/2018/12/09/hexo/","excerpt":"","text":"1npm install hexo-deployer-git --save ä¿®æ”¹ä¸»é¡µé…ç½®æ–‡ä»¶ _config.yml1post_asset_folder : true å®‰è£…æœ¬åœ°å›¾ç‰‡æ’ä»¶1npm install hexo-asset-image --save ç”Ÿæˆæ–°çš„åšæ–‡1hexo n &quot;xxx&quot; æ­¤æ—¶ /source/_posts/ ä¸‹ä¼šç”ŸæˆåŒåæ–‡ä»¶å¤¹ åšæ–‡å¼•å…¥å›¾ç‰‡1![](xxx/xxx.jpg)","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"blog","slug":"blog","permalink":"http://yoursite.com/tags/blog/"},{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"},{"name":"nodejs","slug":"nodejs","permalink":"http://yoursite.com/tags/nodejs/"}]},{"title":"history æ·»åŠ æ—¶é—´æˆ³","slug":"bash_history","date":"2018-12-07T16:00:00.000Z","updated":"2019-07-23T07:15:22.346Z","comments":true,"path":"2018/12/08/bash_history/","link":"","permalink":"http://yoursite.com/2018/12/08/bash_history/","excerpt":"","text":"æ·»åŠ ç¯å¢ƒå˜é‡1[root@client ~]# vim /etc/profile 12HISTTIMEFORMAT=\"%Y-%m-%d %H:%M:%S\"export HISTTIMEFORMAT","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"http://yoursite.com/tags/shell/"}]},{"title":"jekyll æ‰“é€ é™æ€åšå®¢","slug":"Jekyll","date":"2018-12-06T16:00:00.000Z","updated":"2019-07-23T07:16:02.944Z","comments":true,"path":"2018/12/07/Jekyll/","link":"","permalink":"http://yoursite.com/2018/12/07/Jekyll/","excerpt":"","text":"1. å®‰è£…ä¹‹å‰å…ˆå®‰è£…ä¾èµ–åŒ…1sudo apt-get install ruby ruby-dev build-essential 2. æ·»åŠ ç¯å¢ƒå˜é‡1234echo '# Install Ruby Gems to ~/gems' &gt;&gt; ~/.bashrcecho 'export GEM_HOME=$HOME/gems' &gt;&gt; ~/.bashrcecho 'export PATH=$HOME/gems/bin:$PATH' &gt;&gt; ~/.bashrcsource ~/.bashrc 3. å®‰è£… Jekyll1gem install jekyll bundler 4. ä½¿ç”¨ bundle æ›´æ–° Jekyll123jekyll --versiongem list jekyllbundle update jekyll 5. ä½¿ç”¨ gem æ›´æ–° Jekyll1gem update jekyll 6. æ›´æ–° Rubygems1gem update --system 7. å®‰è£…é¢„è§ˆç‰ˆ1234## å®‰è£…æœ€æ–°é¢„è§ˆç‰ˆgem install jekyll --pre## å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Jekyllgem install jekyll -v '2.0.0.alpha.1' 8. æºç å®‰è£…12345git clone git://github.com/jekyll/jekyll.gitcd jekyllscript/bootstrapbundle exec rake buildls pkg/*.gem | head -n 1 | xargs gem install -l","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"ruby","slug":"ruby","permalink":"http://yoursite.com/tags/ruby/"},{"name":"jekyll","slug":"jekyll","permalink":"http://yoursite.com/tags/jekyll/"},{"name":"blog","slug":"blog","permalink":"http://yoursite.com/tags/blog/"}]},{"title":"Keepalive å®‰è£…ä¸é…ç½®","slug":"keepalive","date":"2018-12-05T16:00:00.000Z","updated":"2019-07-23T07:16:18.777Z","comments":true,"path":"2018/12/06/keepalive/","link":"","permalink":"http://yoursite.com/2018/12/06/keepalive/","excerpt":"","text":"1. å®‰è£… keepalive1[root@centos ~]# yum -y install keepalived","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"keepalive","slug":"keepalive","permalink":"http://yoursite.com/tags/keepalive/"}]},{"title":"Linux ç½‘ç»œç®¡ç†","slug":"managenetwork","date":"2018-12-04T16:00:00.000Z","updated":"2019-07-23T07:16:24.666Z","comments":true,"path":"2018/12/05/managenetwork/","link":"","permalink":"http://yoursite.com/2018/12/05/managenetwork/","excerpt":"","text":"1. ARP é«˜é€Ÿç¼“å­˜1234567891011121314151617181920212223242526```Usage: arp [-vn] [&lt;HW&gt;] [-i &lt;if&gt;] [-a] [&lt;hostname&gt;] &lt;-Display ARP cache arp [-v] [-i &lt;if&gt;] -d &lt;host&gt; [pub] &lt;-Delete ARP entry arp [-vnD] [&lt;HW&gt;] [-i &lt;if&gt;] -f [&lt;filename&gt;] &lt;-Add entry from file arp [-v] [&lt;HW&gt;] [-i &lt;if&gt;] -s &lt;host&gt; &lt;hwaddr&gt; [temp] &lt;-Add entry arp [-v] [&lt;HW&gt;] [-i &lt;if&gt;] -Ds &lt;host&gt; &lt;if&gt; [netmask &lt;nm&gt;] pub &lt;-&apos;&apos;- -a display (all) hosts in alternative (BSD) style -e display (all) hosts in default (Linux) style -s, --set set a new ARP entry -d, --delete delete a specified entry -v, --verbose be verbose -n, --numeric don&apos;t resolve names -i, --device specify network interface (e.g. eth0) -D, --use-device read &lt;hwaddr&gt; from given device -A, -p, --protocol specify protocol family -f, --file read new entries from file or from /etc/ethers &lt;HW&gt;=Use &apos;-H &lt;hw&gt;&apos; to specify hardware address type. Default: ether List of possible hardware types (which support ARP): ash (Ash) ether (Ethernet) ax25 (AMPR AX.25) netrom (AMPR NET/ROM) rose (AMPR ROSE) arcnet (ARCnet) dlci (Frame Relay DLCI) fddi (Fiber Distributed Data Interface) hippi (HIPPI) irda (IrLAP) x25 (generic X.25) infiniband (InfiniBand) eui64 (Generic EUI-64)2. arpwatchï¼šç›‘å¬ ARP è®°å½•3. arpingï¼šå‘é€ ARP è¯·æ±‚åˆ°ä¸€ä¸ªç›¸é‚»ä¸»æœº4. fingerï¼šæŸ¥æ‰¾å¹¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯5. ifconfigï¼šè®¾ç½®ç½‘ç»œæ¥å£6. iwconfigï¼šè®¾ç½®æ— çº¿ç½‘å¡7. hostnameï¼šæ˜¾ç¤ºä¸»æœºå8. ifupï¼šæ¿€æ´»è®¾å¤‡9. ifdownï¼šç¦ç”¨ç½‘ç»œè®¾å¤‡10. mii-toolï¼šè°ƒæ•´ç½‘å¡æ¨¡å¼11. routeï¼šè®¾ç½®è·¯ç”±è¡¨12. netstatï¼šæŸ¥çœ‹ç½‘ç»œè¿æ¥13. pingï¼šæ£€æµ‹ä¸»æœºçš„è¿é€šæ€§14. tracerouteï¼šæ£€æŸ¥æ•°æ®åŒ…æ‰€ç»è¿‡çš„è·¯ç”±å™¨15. wgetï¼šä¸‹è½½æ–‡ä»¶16. telnetï¼šè¿œç¨‹ç™»é™†17. ethtoolï¼šæŸ¥è¯¢åŠè®¾ç½®ç½‘å¡å‚æ•°18. tcï¼šæ˜¾ç¤ºå’Œç»´æŠ¤æµé‡æ§åˆ¶è®¾ç½®","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"network","slug":"network","permalink":"http://yoursite.com/tags/network/"}]},{"title":"Linux æ—¶åŒºè®¾ç½®","slug":"timezone","date":"2018-12-03T16:00:00.000Z","updated":"2019-07-23T07:17:12.585Z","comments":true,"path":"2018/12/04/timezone/","link":"","permalink":"http://yoursite.com/2018/12/04/timezone/","excerpt":"","text":"1. æ—¶é—´è®¾ç½®æŸ¥çœ‹ã€è®¾ç½®ç¡¬ä»¶æ—¶é—´12345hwclock --showclock --show## æœˆ/æ—¥/å¹´æ—¶:åˆ†:ç§’hwclock --set --date=\"06/18/14 14:55\"clock --set --date=\"06/18/14 14:55\" ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é’ŸåŒæ­¥1234567## hcä»£è¡¨ç¡¬ä»¶æ—¶é—´ï¼Œsysä»£è¡¨ç³»ç»Ÿæ—¶é—´## ç¡¬ä»¶æ—¶é’ŸåŒæ­¥ç³»ç»Ÿæ—¶é’Ÿhwclock --hctosysclock --hctosys## ç³»ç»Ÿæ—¶é’ŸåŒæ­¥ç¡¬ä»¶æ—¶é’Ÿhwclock --systohcclock --systohc åŒæ­¥ ntp æœåŠ¡å™¨123456## å®‰è£… ntpã€ntpdateyum -y install ntpntpdate &lt;IP&gt;## æ·»åŠ å®šæ—¶ä»»åŠ¡crontab -e0 0 * * * /usr/sbin/ntpdate &lt;IP&gt; 2. æ—¶åŒºè®¾ç½®tzselect1TZ='Asia/Shanghai'; export TZ ä¿®æ”¹é…ç½®æ–‡ä»¶1234vim etc/sysconfig/clockZONE=Asia/Shanghairm /etc/localtimeln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 12345timedatectltimedatectl list-timezonestimedatectl set-timezone Asia/Shanghaiyum -y install ntpvim /etc/ntp.conf","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"http://yoursite.com/tags/shell/"}]},{"title":"Linux èšåˆé“¾è·¯","slug":"team","date":"2018-12-02T16:00:00.000Z","updated":"2019-07-23T07:17:09.497Z","comments":true,"path":"2018/12/03/team/","link":"","permalink":"http://yoursite.com/2018/12/03/team/","excerpt":"","text":"broadcastï¼ˆå¯å°†æ•°æ®ä¼ é€åˆ°æ‰€æœ‰ç«¯å£ï¼‰round-robinï¼ˆå¯æŒ‰é¡ºåºå°†æ•°æ®ä¼ é€åˆ°æ‰€æœ‰ç«¯å£ï¼‰active-backupï¼ˆä½¿ç”¨ä¸€ä¸ªç«¯å£æˆ–é“¾æ¥æ—¶å…¶ä»–åˆ™å¤„äºå¤‡ç”¨çŠ¶æ€ï¼‰loadbalanceï¼ˆä½¿ç”¨ä¸»åŠ¨ Tx è´Ÿè½½å¹³è¡¡åŠåŸºäº BPF çš„ Tx ç«¯å£é€‰æ‹©ç¨‹åºï¼‰lacpï¼ˆé‡‡ç”¨ 802.3ad é“¾æ¥åˆå¹¶æ§åˆ¶åè®®ï¼‰ 1. å®‰è£… teamdé»˜è®¤ä¸ä¼šå®‰è£…ç½‘ç»œæˆç»„å®ˆæŠ¤è¿›ç¨‹ teamdã€‚è¦å®‰è£… teamd 1yum -y install teamd 2. æ·»åŠ é…ç½®1234567891011121314151617181920# ä½¿ç”¨åç§° team-ServerA åˆ›å»ºæ–°çš„æˆç»„æ¥å£nmcli connection add type team ifname team-ServerAnmcli con show team-ServerA# æ›´æ”¹ä¸ºæˆç»„åˆ†é…çš„åç§°ï¼šnmcli con mod old-team-name connection.id new-team-name# è½½å…¥æˆç»„é…ç½®æ–‡ä»¶nmcli connection modify team-name team.config JSON-config# æ£€æŸ¥ team.config å±æ€§nmcli con show team-name | grep team.config# åœ¨ Team0 ä¸­æ·»åŠ åä¸º Team0-port1 çš„æ¥å£ eth0nmcli con add type team-slave con-name Team0-port1 ifname eth0 master Team0# æ·»åŠ å¦ä¸€ä¸ªåä¸º Team0-port2 çš„æ¥å£ eth1nmcli con add type team-slave con-name Team0-port2 ifname eth1 master Team0# æ¿€æ´»ç«¯å£nmcli connection up Team0-port1nmcli connection up Team0-port2# éªŒè¯æ˜¯å¦å·²æ¿€æ´»æˆç»„æ¥å£ip link# æˆ–è€…ä½¿ç”¨å‘½ä»¤å¯ç”¨è¯¥æ¥å£ç»„nmcli connection up Team0 3. é…ç½®æ–‡ä»¶è¦åˆ›å»ºç½‘ç»œæˆç»„ï¼Œä½œä¸ºæˆç»„ç«¯å£æˆ–é“¾æ¥æ¥å£çš„è™šæ‹Ÿæ¥å£éœ€è¦ä¸€ä¸ª JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚å¿«æ·çš„æ–¹æ³•æ˜¯å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨æœ‰ root æˆæƒçš„ç¼–è¾‘å™¨è¿›è¡Œç¼–è¾‘ã€‚ 1234# åˆ—å‡ºå¯ç”¨ç¤ºä¾‹é…ç½®æ–‡ä»¶ls /usr/share/doc/teamd-*/example_configs/# è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åŒ…å«çš„æ–‡ä»¶ä¹‹ä¸€ï¼Œæ¯”å¦‚ activebackup_ethtool_1.confï¼šcat /usr/share/doc/teamd-*/example_configs/activebackup_ethtool_1.conf","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"network","slug":"network","permalink":"http://yoursite.com/tags/network/"}]},{"title":"Linux ç½‘å¡ç»‘å®š","slug":"bond","date":"2018-12-01T16:00:00.000Z","updated":"2019-07-23T07:15:25.748Z","comments":true,"path":"2018/12/02/bond/","link":"","permalink":"http://yoursite.com/2018/12/02/bond/","excerpt":"","text":"1. å¸¸è§çš„ç½‘å¡ç»‘å®šé©±åŠ¨æ¨¡å¼: mod=0 (balance-rr) Round-robin è¡¡æŠ¡å¾ªç¯ç­–ç•¥ç‰¹ç‚¹ï¼šä¼ è¾“æ•°æ®åŒ…é¡ºåºæ˜¯ä¾æ¬¡ä¼ è¾“ï¼ˆå³ï¼šç¬¬1ä¸ªåŒ…èµ°eth0ï¼Œä¸‹ä¸€ä¸ªåŒ…å°±èµ°eth1.ä¸€ç›´å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æœ€åä¸€ä¸ªä¼ è¾“å®Œæ¯•ï¼‰ï¼Œæ­¤æ¨¡å¼æä¾›è´Ÿè½½å¹³è¡¡å’Œå®¹é”™èƒ½åŠ›ï¼›ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¦‚æœä¸€ä¸ªè¿æ¥æˆ–è€…ä¼šè¯çš„æ•°æ®åŒ…ä»ä¸åŒçš„æ¥å£å‘å‡ºçš„è¯ï¼Œä¸­é€”å†ç»è¿‡ä¸åŒçš„é“¾è·¯ï¼Œåœ¨å®¢æˆ·ç«¯å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°æ•°æ®åŒ…æ— åºåˆ°è¾¾çš„é—®é¢˜ï¼Œè€Œæ— åºåˆ°è¾¾çš„æ•°æ®åŒ…éœ€è¦é‡æ–°è¦æ±‚è¢«å‘é€ï¼Œè¿™æ ·ç½‘ç»œçš„ååé‡å°±ä¼šä¸‹é™ mode=1 (active-backup) ä¸»-å¤‡ä»½ç­–ç•¥ç‰¹ç‚¹ï¼šåªæœ‰ä¸€ä¸ªè®¾å¤‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå½“ä¸€ä¸ªå®•æ‰å¦ä¸€ä¸ªé©¬ä¸Šç”±å¤‡ä»½è½¬æ¢ä¸ºä¸»è®¾å¤‡ã€‚macåœ°å€æ˜¯å¤–éƒ¨å¯è§å¾—ï¼Œä»å¤–é¢çœ‹æ¥ï¼Œbondçš„MACåœ°å€æ˜¯å”¯ä¸€çš„ï¼Œä»¥é¿å…switch(äº¤æ¢æœº)å‘ç”Ÿæ··ä¹±ã€‚æ­¤æ¨¡å¼åªæä¾›äº†å®¹é”™èƒ½åŠ›ï¼›ç”±æ­¤å¯è§æ­¤ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›é«˜ç½‘ç»œè¿æ¥çš„å¯ç”¨æ€§ï¼Œä½†æ˜¯å®ƒçš„èµ„æºåˆ©ç”¨ç‡è¾ƒä½ï¼Œåªæœ‰ä¸€ä¸ªæ¥å£å¤„äºå·¥ä½œçŠ¶æ€ï¼Œåœ¨æœ‰ N ä¸ªç½‘ç»œæ¥å£çš„æƒ…å†µä¸‹ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸º1/N mode=2 (balance-xor) XOR policy å¹³è¡¡ç­–ç•¥ç‰¹ç‚¹ï¼šåŸºäºæŒ‡å®šçš„ä¼ è¾“HASHç­–ç•¥ä¼ è¾“æ•°æ®åŒ…ã€‚ç¼ºçœçš„ç­–ç•¥æ˜¯ï¼š(æºMACåœ°å€ XOR ç›®æ ‡MACåœ°å€) % slaveæ•°é‡ã€‚å…¶ä»–çš„ä¼ è¾“ç­–ç•¥å¯ä»¥é€šè¿‡xmit_hash_policyé€‰é¡¹æŒ‡å®šï¼Œæ­¤æ¨¡å¼æä¾›è´Ÿè½½å¹³è¡¡å’Œå®¹é”™èƒ½åŠ› mode=3 (broadcast) å¹¿æ’­ç­–ç•¥ç‰¹ç‚¹ï¼šåœ¨æ¯ä¸ªslaveæ¥å£ä¸Šä¼ è¾“æ¯ä¸ªæ•°æ®åŒ…ï¼Œæ­¤æ¨¡å¼æä¾›äº†å®¹é”™èƒ½åŠ› mode=4 (802.3ad) IEEE 802.3ad åŠ¨æ€é“¾æ¥èšåˆç‰¹ç‚¹ï¼šåˆ›å»ºä¸€ä¸ªèšåˆç»„ï¼Œå®ƒä»¬å…±äº«åŒæ ·çš„é€Ÿç‡å’ŒåŒå·¥è®¾å®šã€‚æ ¹æ®802.3adè§„èŒƒå°†å¤šä¸ªslaveå·¥ä½œåœ¨åŒä¸€ä¸ªæ¿€æ´»çš„èšåˆä½“ä¸‹ã€‚å¤–å‡ºæµé‡çš„slaveé€‰ä¸¾æ˜¯åŸºäºä¼ è¾“hashç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥é€šè¿‡xmit_hash_policyé€‰é¡¹ä»ç¼ºçœçš„XORç­–ç•¥æ”¹å˜åˆ°å…¶ä»–ç­–ç•¥ã€‚éœ€è¦æ³¨æ„çš„ æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¼ è¾“ç­–ç•¥éƒ½æ˜¯802.3adé€‚åº”çš„ï¼Œå°¤å…¶è€ƒè™‘åˆ°åœ¨802.3adæ ‡å‡†43.2.4ç« èŠ‚æåŠçš„åŒ…ä¹±åºé—®é¢˜ã€‚ä¸åŒçš„å®ç°å¯èƒ½ä¼šæœ‰ä¸åŒçš„é€‚åº”æ€§ã€‚å¿…è¦æ¡ä»¶ï¼šæ¡ä»¶1ï¼šethtoolæ”¯æŒè·å–æ¯ä¸ªslaveçš„é€Ÿç‡å’ŒåŒå·¥è®¾å®šæ¡ä»¶2ï¼šswitch(äº¤æ¢æœº)æ”¯æŒIEEE 802.3ad Dynamic link aggregationæ¡ä»¶3ï¼šå¤§å¤šæ•°switch(äº¤æ¢æœº)éœ€è¦ç»è¿‡ç‰¹å®šé…ç½®æ‰èƒ½æ”¯æŒ802.3adæ¨¡å¼ mode=5 (balance-tlb) Adaptive transmit load balancing é€‚é…å™¨ä¼ è¾“è´Ÿè½½å‡è¡¡ç‰¹ç‚¹ï¼šä¸éœ€è¦ä»»ä½•ç‰¹åˆ«çš„switch(äº¤æ¢æœº)æ”¯æŒçš„é€šé“bondingã€‚åœ¨æ¯ä¸ªslaveä¸Šæ ¹æ®å½“å‰çš„è´Ÿè½½ï¼ˆæ ¹æ®é€Ÿåº¦è®¡ç®—ï¼‰åˆ†é…å¤–å‡ºæµé‡ã€‚å¦‚æœæ­£åœ¨æ¥å—æ•°æ®çš„slaveå‡ºæ•…éšœäº†ï¼Œå¦ä¸€ä¸ªslaveæ¥ç®¡å¤±è´¥çš„slaveçš„MACåœ°å€ã€‚å¿…è¦æ¡ä»¶ï¼šethtoolæ”¯æŒè·å–æ¯ä¸ªslaveçš„é€Ÿç‡ mode=6 (balance-alb) Adaptive load balancing é€‚é…å™¨é€‚åº”æ€§è´Ÿè½½å‡è¡¡ç‰¹ç‚¹ï¼šè¯¥æ¨¡å¼åŒ…å«äº†balance-tlbæ¨¡å¼ï¼ŒåŒæ—¶åŠ ä¸Šé’ˆå¯¹IPV4æµé‡çš„æ¥æ”¶è´Ÿè½½å‡è¡¡(receive load balance, rlb)ï¼Œè€Œä¸”ä¸éœ€è¦ä»»ä½•switch(äº¤æ¢æœº)çš„æ”¯æŒã€‚æ¥æ”¶è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡ARPåå•†å®ç°çš„ã€‚bondingé©±åŠ¨æˆªè·æœ¬æœºå‘é€çš„ARPåº”ç­”ï¼Œå¹¶æŠŠæºç¡¬ä»¶åœ°å€æ”¹å†™ä¸ºbondä¸­æŸä¸ªslaveçš„å”¯ä¸€ç¡¬ä»¶åœ°å€ï¼Œä»è€Œä½¿å¾—ä¸åŒçš„å¯¹ç«¯ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶åœ°å€è¿›è¡Œé€šä¿¡ã€‚ 2. ä½¿ç”¨ nmcli å·¥å…·é…ç½®ç½‘å¡ç»‘å®š12345678nmcli con add type bond con-name mybond0 ifname bond0 mode balance-albnmcli con add type bond-slave ifname ens37 master mybond0nmcli con add type bond-slave ifname ens38 master mybond0nmcli con up bond-slave-ens7nmcli con modify mybond0 ipv4.method manualnmcli con modify mybond0 ipv4.addresses 192.168.78.137/24nmcli con modify mybond0 ipv4.gateway 192.168.78.2nmcli con modify mybond0 ipv4.dns 192.168.78.2 3. ä½¿ç”¨å‘½ä»¤è¡Œç•Œé¢é…ç½®ç½‘å¡ç»‘å®š12# æ˜¾ç¤º boding æ¨¡å—ä¿¡æ¯modinfo bonding 3.1 åˆ›å»ºé¢‘é“ç»‘å®šæ¥å£åœ¨ /etc/sysconfig/network-scripts/ ç›®å½•ä¸­åˆ›å»ºåä¸º ifcfg-bondN çš„æ–‡ä»¶ï¼Œä½¿ç”¨æ¥å£å·ç æ›¿æ¢ Nï¼Œæ¯”å¦‚ 0ã€‚ 123456789DEVICE=bond0NAME=bond0TYPE=BondBONDING_MASTER=yesIPADDR=192.168.1.1PREFIX=24ONBOOT=yesBOOTPROTO=noneBONDING_OPTS=&quot;bonding parameters separated by spaces&quot; 3.2 åˆ›å»ºä»å±æ¥å£1234567DEVICE=ethNNAME=bond0-slaveTYPE=EthernetBOOTPROTO=noneONBOOT=yesMASTER=bond0SLAVE=yes 3.3 æ¿€æ´»é¢‘é“ç»‘å®š1234567ifup ifcfg-eth0ifup ifcfg-eth1# ç”Ÿæ•ˆæ›´æ”¹# nmcli con load /etc/sysconfig/network-script/ifcfg-devicenmcli con reload# æŸ¥çœ‹ç½‘å¡ç»‘å®šæ¥å£çŠ¶æ€ip link show","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"network","slug":"network","permalink":"http://yoursite.com/tags/network/"}]},{"title":"Tomcat é…ç½®ä¸ä¼˜åŒ–","slug":"tomcat","date":"2018-11-30T16:00:00.000Z","updated":"2019-07-23T07:17:15.912Z","comments":true,"path":"2018/12/01/tomcat/","link":"","permalink":"http://yoursite.com/2018/12/01/tomcat/","excerpt":"","text":"1. JVM é…ç½®æ·»åŠ  tomcat ç®¡ç†å‘˜1[root@server ~]# vim /tomcat/conf/tomcat-users.xml 123&lt;role rolename=\"manager-gui\"/&gt;&lt;role rolename=\"admin-gui\"/&gt;&lt;user username=\"manager\" password=\"manager\" roles=\"admin-gui,manager-gui\"/&gt; ä¿®æ”¹ JVM è™šæ‹Ÿå†…å­˜ 1JAVA_OPTS=\"-server -Xms1024m -Xmx1024m -Xmn256m -XX:PermSize=512m -XX:MaxPermSize=1024m -XX:ReservedCodeCacheSize=256M -Djava.awt.headless=true -Dfile.encoding=utf-8\" å †è®¾ç½®ï¼š -Xms=n åˆå§‹å †å¤§å°-Xmx=n æœ€å¤§å †å¤§å°-XX:NewSize=n è®¾ç½®å¹´è½»ä»£å¤§å°-XX:NewRatio=n è®¾ç½®å¹´è½»ä»£å’Œå¹´è€ä»£çš„æ¯”å€¼.å¦‚:ä¸º3,è¡¨ç¤ºå¹´è½»ä»£ä¸å¹´è€ä»£æ¯”å€¼ä¸º1:3,å¹´è½»ä»£å æ•´ä¸ªå¹´è½»ä»£å¹´è€ä»£å’Œçš„1/4-XX:SurvivorRatio=n å¹´è½»ä»£ä¸­EdenåŒºä¸ä¸¤ä¸ªSurvivoråŒºçš„æ¯”å€¼.æ³¨æ„SurvivoråŒºæœ‰ä¸¤ä¸ª.å¦‚:3,è¡¨ç¤ºEden:Survivor=3:2,ä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/5-XX:MaxPermSize=n è®¾ç½®æŒä¹…ä»£å¤§å° æ”¶é›†å™¨è®¾ç½®ï¼š -XX:+UseSerialGC è®¾ç½®ä¸²è¡Œæ”¶é›†å™¨-XX:+UseParallelGC è®¾ç½®å¹¶è¡Œæ”¶é›†å™¨-XX:+UseParalledlOldGC è®¾ç½®å¹¶è¡Œå¹´è€ä»£æ”¶é›†å™¨-XX:+UseConcMarkSweepGC è®¾ç½®å¹¶å‘æ”¶é›†å™¨ åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ï¼š -XX:+PrintGC-XX:+PrintGCDetails-XX:+PrintGCTimeStamps-Xloggc:filename å¹¶è¡Œæ”¶é›†å™¨è®¾ç½®ï¼š -XX:ParallelGCThreads=n è®¾ç½®å¹¶è¡Œæ”¶é›†å™¨æ”¶é›†æ—¶ä½¿ç”¨çš„CPUæ•°.å¹¶è¡Œæ”¶é›†çº¿ç¨‹æ•°.-XX:MaxGCPauseMillis=n è®¾ç½®å¹¶è¡Œæ”¶é›†æœ€å¤§æš‚åœæ—¶é—´-XX:GCTimeRatio=n è®¾ç½®åƒåœ¾å›æ”¶æ—¶é—´å ç¨‹åºè¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”.å…¬å¼ä¸º1/(1+n)å¹¶å‘æ”¶é›†å™¨è®¾ç½®-XX:+CMSIncrementalMode è®¾ç½®ä¸ºå¢é‡æ¨¡å¼.é€‚ç”¨äºå•CPUæƒ…å†µ.-XX:ParallelGCThreads=n è®¾ç½®å¹¶å‘æ”¶é›†å™¨å¹´è½»ä»£æ”¶é›†æ–¹å¼ä¸ºå¹¶è¡Œæ”¶é›†æ—¶,ä½¿ç”¨çš„CPUæ•°.å¹¶è¡Œæ”¶é›†çº¿ç¨‹æ•° 2. apr å®‰è£…å®‰è£…ä¾èµ–1[root@server ~]# yum -y install gcc expat-devel å®‰è£… apr123[root@server ~]# mkdir /usr/local/apr[root@server apr-1.6.3]# ./configure --prefix=/usr/local/apr[root@server apr-1.6.3]# make &amp;&amp; make install å®‰è£… apr-util12[root@server apr-util-1.6.1]# ./configure --prefix=/usr/local/apr --with-apr=/usr/local/apr[root@server apr-util-1.6.1]# make &amp;&amp; make install å®‰è£… tomcat-native123[root@server ~]# cd tomcat-native-1.2.17-src/native/[root@server native]# ./configure --prefix=/usr/local/apr --with-apr=/usr/local/apr --with-java-home=/usr/java/jdk1.7.0_80/[root@server native]# make &amp;&amp; make install ä¿®æ”¹ tomcat é…ç½®1[root@server ~]# vim /tomcat/bin/catalina.sh 12# æ·»åŠ  CATALINA_OPTSCATALINA_OPTS=\"-Djava.library.path=/usr/local/apr/lib\" 1[root@server ~]# vim /tomcat/conf/server.xml 123456789101112&lt;Connector port=\"8001\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" executor=\"tomcatThreadPool\" maxThreads=\"1000\" enableLookups=\"false\" acceptCount=\"1000\" connectionTimeout=\"30000\" redirectPort=\"9100\" maxPostSize=\"8388608\" maxParameterCount=\"40000\" disableUploadTimeout=\"true\" URIEncoding=\"UTF-8\"/&gt; 3. SSLEngine ErroræŸ¥çœ‹ tomcat æ—¥å¿—ï¼Œå‡ºç° SSLEngine Errororg.apache.catalina.core.AprLifecycleListener.lifecycleEvent Failed to initialize the SSLEngine.{:.error} è§£å†³åŠæ³•1[root@server ~]# vim /tomcat/conf/server.xml 1&lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"off\" /&gt;","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"tomcat","slug":"tomcat","permalink":"http://yoursite.com/tags/tomcat/"}]},{"title":"LVS","slug":"lvs","date":"2018-11-29T16:00:00.000Z","updated":"2019-07-23T07:16:21.879Z","comments":true,"path":"2018/11/30/lvs/","link":"","permalink":"http://yoursite.com/2018/11/30/lvs/","excerpt":"","text":"1. å®‰è£… ipvsadm1[root@centos ~]# yum -y install ipvsadm 2. ipvsadm ç”¨æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768[root@centos ~]# ipvsadm --helpipvsadm v1.27 2008/5/15 (compiled with popt and IPVS v1.2.1)Usage: ipvsadm -A|E -t|u|f service-address [-s scheduler] [-p [timeout]] [-M netmask] [--pe persistence_engine] [-b sched-flags] ipvsadm -D -t|u|f service-address ipvsadm -C ipvsadm -R ipvsadm -S [-n] ipvsadm -a|e -t|u|f service-address -r server-address [options] ipvsadm -d -t|u|f service-address -r server-address ipvsadm -L|l [options] ipvsadm -Z [-t|u|f service-address] ipvsadm --set tcp tcpfin udp ipvsadm --start-daemon state [--mcast-interface interface] [--syncid sid] ipvsadm --stop-daemon state ipvsadm -hCommands:Either long or short options are allowed. --add-service -A add virtual service with options --edit-service -E edit virtual service with options --delete-service -D delete virtual service --clear -C clear the whole table --restore -R restore rules from stdin --save -S save rules to stdout --add-server -a add real server with options --edit-server -e edit real server with options --delete-server -d delete real server --list -L|-l list the table --zero -Z zero counters in a service or all services --set tcp tcpfin udp set connection timeout values --start-daemon start connection sync daemon --stop-daemon stop connection sync daemon --help -h display this help messageOptions: --tcp-service -t service-address service-address is host[:port] --udp-service -u service-address service-address is host[:port] --fwmark-service -f fwmark fwmark is an integer greater than zero --ipv6 -6 fwmark entry uses IPv6 --scheduler -s scheduler one of rr|wrr|lc|wlc|lblc|lblcr|dh|sh|sed|nq, the default scheduler is wlc. --pe engine alternate persistence engine may be sip, not set by default. --persistent -p [timeout] persistent service --netmask -M netmask persistent granularity mask --real-server -r server-address server-address is host (and port) --gatewaying -g gatewaying (direct routing) (default) --ipip -i ipip encapsulation (tunneling) --masquerading -m masquerading (NAT) --weight -w weight capacity of real server --u-threshold -x uthreshold upper threshold of connections --l-threshold -y lthreshold lower threshold of connections --mcast-interface interface multicast interface for connection sync --syncid sid syncid for connection sync (default=255) --connection -c output of current IPVS connections --timeout output of timeout (tcp tcpfin udp) --daemon output of daemon information --stats output of statistics information --rate output of rate information --exact expand numbers (display exact values) --thresholds output of thresholds information --persistent-conn output of persistent connection info --nosort disable sorting output of service/server entries --sort does nothing, for backwards compatibility --ops -o one-packet scheduling --numeric -n numeric output of addresses and ports --sched-flags -b flags scheduler flags (comma-separated) 3.","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"lvs","slug":"lvs","permalink":"http://yoursite.com/tags/lvs/"}]},{"title":"Nginx","slug":"nginx","date":"2018-11-27T16:00:00.000Z","updated":"2019-07-23T07:16:37.412Z","comments":true,"path":"2018/11/28/nginx/","link":"","permalink":"http://yoursite.com/2018/11/28/nginx/","excerpt":"","text":"High-Performance Load Balancingï¼ˆé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ï¼‰1.1 HTTP Load Balancing ä½¿ç”¨ NGINX çš„ HTTP æ¨¡å—ä½¿ç”¨ upstream å—åœ¨ HTTP æœåŠ¡å™¨ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡ 123456789upstream backend &#123; server 10.10.12.45:80 weight=1; server app.example.com:80 weight=2;&#125;server &#123; location / &#123; proxy_pass http://backend; &#125;&#125; 1.2 TCP Load Balancing ä½¿ç”¨ NGINX çš„ stream æ¨¡å—ä½¿ç”¨ upstream å—åœ¨ TCP æœåŠ¡å™¨ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡ 123456789101112stream &#123; upstream mysql_read &#123; server read1.example.com:3306 weight=5; server read2.example.com:3306; server 10.10.12.34:3306 backup; &#125; server &#123; listen 3306; proxy_pass mysql_read; &#125;&#125; 1.3 Load-Balancing æ–¹æ³• ä½¿ç”¨ NGINX çš„è´Ÿè½½å¹³è¡¡æ–¹æ³•ä¹‹ä¸€ï¼Œä¾‹å¦‚least_conn, least_time, hash, ip_hash è¿™é‡Œå°†åç«¯ upstream æ± çš„è´Ÿè½½å¹³è¡¡ç®—æ³•è®¾ç½®ä¸ºæœ€å°‘è¿æ¥ã€‚æ‰€æœ‰è´Ÿè½½å¹³è¡¡ç®—æ³•ï¼ˆé€šç”¨æ•£åˆ—é™¤å¤–ï¼‰éƒ½å°†æ˜¯ç‹¬ç«‹çš„æŒ‡ä»¤ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹ã€‚é€šç”¨æ•£åˆ—é‡‡ç”¨å•ä¸ªå‚æ•°ï¼ˆå¯ä»¥æ˜¯å˜é‡çš„ä¸²è”ï¼‰æ¥æ„å»ºæ•£åˆ—ã€‚ 12345upstream backend &#123; least_conn; server backend.example.com; server backend1.example.com;&#125; å¹¶éæ‰€æœ‰è¯·æ±‚æˆ–æ•°æ®åŒ…éƒ½å…·æœ‰ç›¸åŒçš„æƒé‡ã€‚é‰´äºæ­¤ï¼Œå¾ªç¯ï¼Œç”šè‡³æ˜¯å…ˆå‰ç¤ºä¾‹ä¸­ä½¿ç”¨çš„åŠ æƒå¾ªç¯ï¼Œå°†ä¸é€‚åˆæ‰€æœ‰åº”ç”¨ç¨‹åºæˆ–äº¤é€šæµé‡çš„éœ€è¦ã€‚NGINXæä¾›äº†è®¸å¤šè´Ÿè½½å¹³è¡¡ç®—æ³•ï¼Œå¯ç”¨äºé€‚åº”ç‰¹å®šçš„ç”¨ä¾‹ã€‚ è¿™äº›è´Ÿè½½å¹³è¡¡ç®—æ³•æˆ–æ–¹æ³•ä¸ä»…å¯ä»¥é€‰æ‹©ï¼Œè¿˜å¯ä»¥é…ç½®ã€‚ ä»¥ä¸‹è´Ÿè½½å¹³è¡¡æ–¹æ³•å¯ç”¨äº upstream HTTPï¼ŒTCP å’Œ UDP æ± ï¼š Round robinï¼ˆè½®è¯¢ï¼‰ï¼šé»˜è®¤è´Ÿè½½å¹³è¡¡æ–¹æ³•ï¼ŒæŒ‰ upstream æ± ä¸­æœåŠ¡å™¨åˆ—è¡¨çš„é¡ºåºåˆ†é…è¯·æ±‚ã€‚å¯¹äºåŠ æƒå¾ªç¯ï¼Œå¯ä»¥è€ƒè™‘æƒé‡ï¼Œå¦‚æœ upstream æœåŠ¡å™¨çš„å®¹é‡å˜åŒ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŠ æƒå¾ªç¯ã€‚ æƒé‡çš„æ•´æ•°å€¼è¶Šé«˜ï¼ŒæœåŠ¡å™¨åœ¨å¾ªç¯ä¸­çš„ä¼˜åŠ¿å°±è¶Šå¤§ã€‚æƒé‡èƒŒåçš„ç®—æ³•åªæ˜¯åŠ æƒå¹³å‡çš„ç»Ÿè®¡æ¦‚ç‡ã€‚å¾ªç¯æ³•æ˜¯é»˜è®¤çš„è´Ÿè½½å¹³è¡¡ç®—æ³•ï¼Œå¦‚æœæœªæŒ‡å®šå…¶ä»–ç®—æ³•ï¼Œåˆ™ä½¿ç”¨è¯¥ç®—æ³•ã€‚ Least connectionsï¼ˆï¼‰ï¼šå¦ä¸€ç§ç”± NGINX æä¾›çš„è´Ÿè½½å‡è¡¡æ–¹æ³•ã€‚æ­¤æ–¹æ³•é€šè¿‡å°†å½“å‰è¯·æ±‚ä»£ç†åˆ°å…·æœ‰é€šè¿‡ NGINX ä»£ç†çš„æœ€å°‘æ•°é‡çš„æ‰“å¼€è¿æ¥çš„upstreamæœåŠ¡å™¨æ¥å¹³è¡¡è´Ÿè½½ã€‚åœ¨å†³å®šå‘å“ªä¸ªæœåŠ¡å™¨å‘é€è¿æ¥æ—¶ï¼Œæœ€å°è¿æ¥ï¼ˆå¦‚å¾ªç¯ï¼‰ä¹Ÿä¼šè€ƒè™‘æƒé‡ã€‚æŒ‡ä»¤åç§°ä¸º least_connã€‚ Least timeï¼ˆï¼‰ï¼šä»…åœ¨ NGINX Plus ä¸­å¯ç”¨ï¼Œç±»ä¼¼äºæœ€å°‘è¿æ¥ï¼Œå› ä¸ºå®ƒä»£ç†å…·æœ‰æœ€å°‘æ•°é‡çš„å½“å‰è¿æ¥çš„upstream æœåŠ¡å™¨ï¼Œä½†æœ‰åˆ©äºå…·æœ‰æœ€ä½å¹³å‡å“åº”æ—¶é—´çš„æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ³•æ˜¯æœ€å¤æ‚çš„è´Ÿè½½å¹³è¡¡ç®—æ³•ä¹‹ä¸€ï¼Œå¯æ»¡è¶³é«˜æ€§èƒ½ Web åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚æ­¤ç®—æ³•æ˜¯ä¸€ä¸ªå¢åŠ æœ€å°‘è¿æ¥çš„å€¼ï¼Œå› ä¸ºå°‘é‡è¿æ¥å¹¶ä¸ä¸€å®šæ„å‘³ç€æœ€å¿«çš„å“åº”ã€‚æŒ‡ä»¤åç§°ä¸º least_timeã€‚ Generic hashï¼ˆï¼‰ï¼šç®¡ç†å‘˜ä½¿ç”¨ç»™å®šæ–‡æœ¬ï¼Œè¯·æ±‚æˆ–è¿è¡Œæ—¶çš„å˜é‡æˆ–ä¸¤è€…æ¥å®šä¹‰æ•£åˆ—ã€‚NGINX é€šè¿‡ä¸ºå½“å‰è¯·æ±‚ç”Ÿæˆå“ˆå¸Œå¹¶å°†å…¶æ”¾åœ¨ upstream æœåŠ¡å™¨ä¸Šæ¥åˆ†é…æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½ã€‚å½“æ‚¨éœ€è¦æ›´å¤šåœ°æ§åˆ¶å‘é€è¯·æ±‚çš„ä½ç½®æˆ–ç¡®å®šå“ªäº› upstream æœåŠ¡å™¨æœ€æœ‰å¯èƒ½å°†æ•°æ®ç¼“å­˜æ—¶ï¼Œæ­¤æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ± ä¸­æ·»åŠ æˆ–åˆ é™¤æœåŠ¡å™¨æ—¶ï¼Œå°†é‡æ–°åˆ†é…æ•£åˆ—è¯·æ±‚ã€‚è¯¥ç®—æ³•å…·æœ‰å¯é€‰å‚æ•°ï¼Œä¸€è‡´ï¼Œä»¥æœ€å°åŒ–é‡æ–°åˆ†å¸ƒçš„å½±å“ã€‚æŒ‡ä»¤åç§°æ˜¯ hashã€‚ IP hashï¼ˆï¼‰ï¼šä»…æ”¯æŒHTTPï¼Œæ˜¯æœ€åä¸€æ‰¹ã€‚IP å“ˆå¸Œä½¿ç”¨å®¢æˆ·ç«¯ IP åœ°å€ä½œä¸ºå“ˆå¸Œã€‚ä¸åœ¨é€šç”¨æ•£åˆ—ä¸­ä½¿ç”¨è¿œç¨‹å˜é‡ç•¥æœ‰ä¸åŒï¼Œæ­¤ç®—æ³•ä½¿ç”¨ IPv4 åœ°å€çš„å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚æˆ–æ•´ä¸ª IPv6 åœ°å€ã€‚åªè¦è¯¥æœåŠ¡å™¨å¯ç”¨ï¼Œæ­¤æ–¹æ³•å¯ç¡®ä¿å®¢æˆ·ç«¯ä»£ç†åˆ°åŒä¸€ä¸ª upstream æœåŠ¡å™¨ï¼Œè¿™åœ¨ä¼šè¯çŠ¶æ€å—åˆ°å…³æ³¨ä¸”æœªç”±åº”ç”¨ç¨‹åºçš„å…±äº«å†…å­˜å¤„ç†æ—¶éå¸¸æœ‰ç”¨ã€‚ åœ¨åˆ†é…æ•£åˆ—æ—¶ï¼Œæ­¤æ–¹æ³•è¿˜ä¼šè€ƒè™‘æƒé‡å‚æ•°ã€‚ æŒ‡ä»¤åç§°ä¸º ip_hashã€‚ 1.4 Connection Limiting ä½¿ç”¨ NGINX Plus çš„ max_conns å‚æ•°é™åˆ¶ upstream æœåŠ¡å™¨çš„è¿æ¥æ•° 1234567upstream backend &#123; zone backends 64k; queue 750 timeout=30s; server webserver1.example.com max_conns=25; server webserver2.example.com max_conns=15;&#125;","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"nginx","slug":"nginx","permalink":"http://yoursite.com/tags/nginx/"}]},{"title":"Node.js å®‰è£…æŒ‡å—","slug":"nodejs","date":"2018-11-26T16:00:00.000Z","updated":"2019-07-23T07:16:40.485Z","comments":true,"path":"2018/11/27/nodejs/","link":"","permalink":"http://yoursite.com/2018/11/27/nodejs/","excerpt":"","text":"https://github.com/creationix/nvm To install or update nvm, you can use the install script using cURL: 1curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash or Wget: 1wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash 123export NVM_DIR=\"$HOME/.nvm\"[ -s \"$NVM_DIR/nvm.sh\" ] &amp;&amp; \\. \"$NVM_DIR/nvm.sh\" # This loads nvm[ -s \"$NVM_DIR/bash_completion\" ] &amp;&amp; \\. \"$NVM_DIR/bash_completion\" # This loads nvm bash_completion","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"nodejs","slug":"nodejs","permalink":"http://yoursite.com/tags/nodejs/"}]},{"title":"æ ‘è“æ´¾å®‰è£…æ•™ç¨‹","slug":"raspberrypi","date":"2018-11-25T16:00:00.000Z","updated":"2019-07-23T07:16:59.204Z","comments":true,"path":"2018/11/26/raspberrypi/","link":"","permalink":"http://yoursite.com/2018/11/26/raspberrypi/","excerpt":"","text":"rasbian ç½‘ç»œé…ç½®1234567891011auto loiface lo inet loopbackauto eth0iface eth0 inet dhcpauto wlan0allow-hotplug wlan0iface wlan0 inet dhcpwpa-ssid &quot;360WiFi&quot;wpa-psk &quot;hellworld&quot; æ ‘è“æ´¾å®‰è£… docker-ce1234567curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -echo &quot;deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.listapt updateapt install docker-ce","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"raspberrypi","slug":"raspberrypi","permalink":"http://yoursite.com/tags/raspberrypi/"}]},{"title":"SELinux","slug":"selinux","date":"2018-11-24T16:00:00.000Z","updated":"2019-07-23T07:17:02.519Z","comments":true,"path":"2018/11/25/selinux/","link":"","permalink":"http://yoursite.com/2018/11/25/selinux/","excerpt":"","text":"1. ä¸Šä¸‹æ–‡ï¼ˆä»¥ apache ä¸ºä¾‹ï¼‰1ï¼‰æœåŠ¡å™¨ç«¯å®‰è£… httpd123[root@server ~]# yum -y install httpd[root@server ~]# systemctl start httpd[root@server ~]# systemctl enable httpd 2ï¼‰æŸ¥çœ‹ httpd é»˜è®¤ç›®å½•çš„ä¸Šä¸‹æ–‡12[root@server ~]# ls -ldZ /var/www/drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/ 3ï¼‰è®¾ç½®ä¸´æ—¶ä¸Šä¸‹æ–‡1234567891011121314151617[root@server ~]# mkdir /html[root@server ~]# ls -ldZ /html/drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /html/[root@server ~]# chcon -R -t httpd_sys_content_t /html/[root@server ~]# ls -ldZ /html/drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 /html/[root@server ~]# restorecon -R /html/[root@server ~]# ls -ldZ /html/drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /html/[root@server ~]# # --reference è®¾ç½®å’Œç›®å½•ç›¸åŒçš„ä¸Šä¸‹æ–‡[root@server ~]# chcon -R --reference=/var/www/html /www 4ï¼‰è®¾ç½®æ°¸ä¹…ä¸Šä¸‹æ–‡123456789[root@server ~]# semanage fcontext -a -t httpd_sys_content_t &apos;/html(/.*)?&apos;[root@server ~]# ls -ldZ /htmldrwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /html[root@server ~]# restorecon -R /html/[root@server ~]# ls -ldZ /htmldrwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /html 2. å¸ƒå°”å€¼ï¼ˆä»¥ vsftpd ä¸ºä¾‹ï¼‰ å¦‚æœæ­å»ºäº†ä¸€ä¸ªæœåŠ¡ï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯å¾€æœåŠ¡é‡Œå†™ä¸œè¥¿ï¼Œä½†æ˜¯æ— æ³•å†™å…¥ï¼ŒæŒ‰ç…§ä»¥ä¸‹ä¸èµ°æ’æŸ¥ 1ï¼‰æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å…è®¸å†™2ï¼‰æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å…è®¸å†™3ï¼‰æ£€æŸ¥ selinux ï¼ˆä¸Šä¸‹æ–‡|å¸ƒå°”å€¼ï¼‰ 1)æœåŠ¡ç«¯å®‰è£… vsftpd123[root@server ~]# yum -y install vsftpd[root@server ~]# systemctl start vsftpd[root@server ~]# systemctl enable vsftpd 2ï¼‰æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å…è®¸å†™1[root@server ~]# vim /etc/vsftpd/vsftpd.conf 123# å…è®¸åŒ¿åä¸Šä¼ anon_upload_enable=YESanon_mkdir_write_enable=YES 3ï¼‰æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å…è®¸å†™1234567891011[root@server ~]# ls -ld /var/ftp/drwxr-xr-x. 4 root root 27 8æœˆ 17 14:29 /var/ftp/[root@server ~]# cd /var/ftp/[root@server ftp]# mkdir test[root@server ftp]# chown -R ftp.ftp test[root@server ftp]# ls -ld testdrwxr-xr-x. 2 ftp ftp 6 8æœˆ 17 14:48 test 4ï¼‰æ£€æŸ¥ selinux ï¼ˆä¸Šä¸‹æ–‡|å¸ƒå°”å€¼ï¼‰12345678910111213141516171819202122232425262728293031[root@server ~]# getsebool -a | grep ftpftpd_anon_write --&gt; offftpd_connect_all_unreserved --&gt; offftpd_connect_db --&gt; offftpd_full_access --&gt; offftpd_use_cifs --&gt; offftpd_use_fusefs --&gt; offftpd_use_nfs --&gt; offftpd_use_passive_mode --&gt; offhttpd_can_connect_ftp --&gt; offhttpd_enable_ftp_server --&gt; offtftp_anon_write --&gt; offtftp_home_dir --&gt; off[root@server ftp]# setsebool -P ftpd_anon_write on[root@server ftp]# setsebool -P ftpd_full_access on[root@server ~]# getsebool -a | grep ftpftpd_anon_write --&gt; onftpd_connect_all_unreserved --&gt; offftpd_connect_db --&gt; offftpd_full_access --&gt; onftpd_use_cifs --&gt; offftpd_use_fusefs --&gt; offftpd_use_nfs --&gt; offftpd_use_passive_mode --&gt; offhttpd_can_connect_ftp --&gt; offhttpd_enable_ftp_server --&gt; offtftp_anon_write --&gt; offtftp_home_dir --&gt; off","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"selinux","slug":"selinux","permalink":"http://yoursite.com/tags/selinux/"}]},{"title":"Subversion å®‰è£…ä¸é…ç½®","slug":"svn","date":"2018-11-23T16:00:00.000Z","updated":"2019-07-23T07:17:05.919Z","comments":true,"path":"2018/11/24/svn/","link":"","permalink":"http://yoursite.com/2018/11/24/svn/","excerpt":"","text":"1. å®‰è£… Subversion1yum install -y subversion 2. åˆ›å»º SVN ç‰ˆæœ¬åº“12mkdir -p /data/svn/myprojectsvnadmin create /data/svn/myproject 3. é…ç½® SVN ä¿¡æ¯é…ç½®æ–‡ä»¶ç®€ä»‹ç‰ˆæœ¬åº“ä¸­çš„é…ç½®ç›®å½• conf æœ‰ä¸‰ä¸ªæ–‡ä»¶: authz æ˜¯æƒé™æ§åˆ¶æ–‡ä»¶ passwd æ˜¯å¸å·å¯†ç æ–‡ä»¶ svnserve.conf æ˜¯SVNæœåŠ¡ç»¼åˆé…ç½®æ–‡ä»¶ é…ç½®æƒé™é…ç½®æ–‡ä»¶ authzç¤ºä¾‹ä»£ç ï¼š/data/svn/myproject/conf/authz 12345678910[groups] #ç”¨æˆ·ç»„admin = admin,root,test #ç”¨æˆ·ç»„æ‰€å¯¹åº”çš„ç”¨æˆ·[/] #åº“ç›®å½•æƒé™@admin = rw #ç”¨æˆ·ç»„æƒé™*=r #éç”¨æˆ·ç»„æƒé™ é…ç½®è´¦å·å¯†ç æ–‡ä»¶ passwdç¤ºä¾‹ä»£ç ï¼š/data/svn/myproject/conf/passwd 123456[users]# harry = harryssecret# sally = sallyssecretadmin = 123456root = 123456test = 123456 é…ç½® SVN æœåŠ¡ç»¼åˆé…ç½®æ–‡ä»¶ svnserve.confç¤ºä¾‹ä»£ç ï¼š/data/svn/myproject/conf/svnserve.conf 1234567891011121314[general]# force-username-case = none# åŒ¿åè®¿é—®çš„æƒé™ å¯ä»¥æ˜¯readã€writeï¼Œnoneï¼Œé»˜è®¤ä¸ºreadanon-access = none#ä½¿æˆæƒç”¨æˆ·æœ‰å†™æƒé™auth-access = write#å¯†ç æ•°æ®åº“çš„è·¯å¾„password-db = passwd#è®¿é—®æ§åˆ¶æ–‡ä»¶authz-db = authz#è®¤è¯å‘½åç©ºé—´ï¼ŒSVNä¼šåœ¨è®¤è¯æç¤ºé‡Œæ˜¾ç¤ºï¼Œå¹¶ä¸”ä½œä¸ºå‡­è¯ç¼“å­˜çš„å…³é”®å­—realm = /data/svn/myproject[sasl] 4. å¯åŠ¨ SVN æœåŠ¡å¯åŠ¨ SVN1svnserve -d -r /data/svn checkout SVNé¡¹ç›®12mkdir -p /data/workspace/myprojectsvn co svn://127.0.0.1/myproject /data/workspace/myproject --username root --password 123456 --force --no-auth-cache æäº¤æ–‡ä»¶åˆ° SVN æœåŠ¡å™¨ä»æœ¬åœ°æäº¤æ–‡ä»¶åˆ° SVN æœåŠ¡å™¨ï¼Œå…¶ä¸­ root å¯†ç ä¸º /data/svn/myproject/conf/passwd æ–‡ä»¶å­˜å‚¨çš„å¯†ç  1234cd /data/workspace/myprojectecho test &gt;&gt; test.txtsvn add test.txtsvn commit test.txt -m &apos;test&apos; æäº¤æˆåŠŸåå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä»æœ¬åœ°é¡¹ç›®åˆ é™¤æ–‡ä»¶ 12cd /data/workspace/myprojectrm -rf test.txt åˆ é™¤åå¯ä»¥é€šè¿‡ SVN æœåŠ¡å™¨æ¢å¤ 12cd /data/workspace/myprojectsvn update æ¸…é™¤SVNå®¢æˆ·ç«¯å¯†ç æ–¹æ³•ï¼šé‚®ä»¶é€‰æ‹©TortoiseSVNä¸­çš„settingsé€‰é¡¹â€”Saved Dataâ€”å³è¾¹ä¼šå‘ç°æœ‰ä¸ªAuthentication data,ç‚¹å‡»clearï¼Œå³å®Œæˆæ¸…ç©ºè´¦å·å¯†ç æ“ä½œï¼Œç¡®è®¤å³å¯ã€‚ä¸‹æ¬¡å°±ä¼šè‡ªåŠ¨å¼¹å‡ºç™»å½•æ¡†ã€‚ åœ¨eclipseçš„svnæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä¿å­˜å¯†ç ï¼Œé‚£ä¹ˆè¦æ¸…é™¤æ—¶ï¼Œæ¢è´¦å·ç™»å½•ï¼Œå°±ç¨å¾®éº»çƒ¦ç‚¹ï¼š æŸ¥çœ‹ä½ çš„Eclipseä¸­ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆSVN æ¥å£windows &gt; preference &gt; Team &gt; SVN å¦‚æœæ˜¯ç”¨çš„JavaHL, æ‰¾åˆ°ä»¥ä¸‹ç›®å½•å¹¶åˆ é™¤authç›®å½•.C:\\Documents and Settings\\User\\Application Data\\Subversion\\ å¦‚æœä½ ç”¨çš„SVNKit, æ‰¾åˆ°ä»¥ä¸‹ç›®å½•å¹¶åˆ é™¤.keyringæ–‡ä»¶.eclipse\\configuration\\org.eclipse.core.runtime\\","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"svn","slug":"svn","permalink":"http://yoursite.com/tags/svn/"}]},{"title":"Ubuntu ç½‘ç»œé…ç½®","slug":"ubuntuserver","date":"2018-11-22T16:00:00.000Z","updated":"2019-07-23T07:17:19.293Z","comments":true,"path":"2018/11/23/ubuntuserver/","link":"","permalink":"http://yoursite.com/2018/11/23/ubuntuserver/","excerpt":"","text":"1. æŸ¥çœ‹æ‰€æœ‰ç½‘å¡ä¿¡æ¯1ifconfig -a 2. ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶1vim /etc/network/interfaces DHCP 1234567source /etc/network/interfaces.d/*auto loiface lo inet loopbackauto ens33iface ens33 inet dhcp STATIC 123456789101112131415source /etc/network/interfaces.d/*auto loiface lo inet loopbackauto ens33iface ens33 inet static# å…‹éš† mac åœ°å€# pre-up ifconfig ens33 hw ether &lt;MACADDR&gt; address &lt;IPADDR&gt;gateway &lt;GATEWAY&gt;netmask &lt;NETMASK&gt;# network &lt;NETWORK&gt;# broadcast &lt;BROADCAST&gt;dns-nameservers &lt;DNS&gt;","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"ubuntu","slug":"ubuntu","permalink":"http://yoursite.com/tags/ubuntu/"}]},{"title":"Vim","slug":"vim","date":"2018-11-21T16:00:00.000Z","updated":"2019-07-23T07:17:25.988Z","comments":true,"path":"2018/11/22/vim/","link":"","permalink":"http://yoursite.com/2018/11/22/vim/","excerpt":"","text":"ç¼–è¾‘æ–‡ä»¶ /etc/vimrc123456789101112autocmd BufNewFile *.py,*.sh,*, exec &quot;:call SetTitle()&quot;let $author_name = &quot;jeremy&quot;let $filetype_name = strpart(expand(&quot;%&quot;), stridx(expand(&quot;%&quot;), &quot;.&quot;))let $file_name = strpart(expand(&quot;%&quot;), 0, stridx(expand(&quot;%&quot;), &quot;.&quot;))func SetTitle()if &amp;filetype == &apos;sh&apos;call setline(1, &quot;\\#!/bin/bash&quot;)call setline(2, &quot;\\# writen by: &quot;.$author_name)call setline(3, &quot;\\# file name: &quot;.$file_name.$filetype_name)endifendfunc","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"vim","slug":"vim","permalink":"http://yoursite.com/tags/vim/"}]},{"title":"VirtualBox é‡åˆ°çš„é—®é¢˜","slug":"virtualbox","date":"2018-11-20T16:00:00.000Z","updated":"2019-07-23T07:17:34.106Z","comments":true,"path":"2018/11/21/virtualbox/","link":"","permalink":"http://yoursite.com/2018/11/21/virtualbox/","excerpt":"","text":"1ã€å¼•å¯¼ç•Œé¢ä¿®æ”¹123Shell&gt; FS0:FS0:\\&gt; cd EFIFS0:\\EFI&gt; cp centos\\grubx64.efi BOOT\\grubx64.efi 2ã€ç³»ç»Ÿç•Œé¢ä¿®æ”¹1cp /boot/efi/EFI/centos/grubx64.efi /boot/efi/EFI/BOOT/grubx64.efi","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"virtualbox","slug":"virtualbox","permalink":"http://yoursite.com/tags/virtualbox/"}]},{"title":"FTP æ•™ç¨‹","slug":"vsftpd","date":"2018-11-19T16:00:00.000Z","updated":"2019-07-23T07:17:37.141Z","comments":true,"path":"2018/11/20/vsftpd/","link":"","permalink":"http://yoursite.com/2018/11/20/vsftpd/","excerpt":"","text":"1. å®‰è£… vsftpd123456789101112131415# æŸ¥çœ‹ selinux çŠ¶æ€getenforce# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€service firewalld status# å®‰è£… vsftpdyum -y install vsftpd# è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable vsftpd# å¯åŠ¨ vsftpd æœåŠ¡systemctl start vsftpd# é˜²ç«å¢™å¼€æ”¾ ftp æœåŠ¡firewall-cmd --add-service=ftp --permanent# æŸ¥çœ‹å’Œæ›´æ”¹ ftp çš„ sebool å€¼getsebool -a | grep ftpsetsebool ftpd_full_access on 2. é…ç½® vsftpd1vim /etc/vsftpd/vsftpd.conf vsftpd.conf 1234567# ä¸å…è®¸åŒ¿åè®¿é—® ftpanonymous_enable=NO# ç”¨æˆ·ä¸å…è®¸åˆ‡æ¢ä¸Šçº§ç›®å½•chroot_local_user=YESallow_writeable_chroot=YES# è®¾ç½®æ—¶åŒºuse_localtime=YES 12# ä¿®æ”¹é…ç½®åé‡å¯ vsftpdsystemctl restart vsftpd 3. åˆ›å»ºç”¨æˆ·1234# åˆ›å»ºç”¨æˆ· [username]ï¼Œä¸å…è®¸ç™»é™†ï¼Œå®¶ç›®å½•ä¸º [directory]useradd -s /sbin/nologin -m -d [directory] [username]# è®¾ç½®å¯†ç echo \"[password]\" | passwd --stdin [username] 4. éªŒè¯1234# å®‰è£… ftp å®¢æˆ·ç«¯yum -y install ftp# è¿æ¥ ftp æœåŠ¡å™¨ftp [ip]","categories":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"ftp","slug":"ftp","permalink":"http://yoursite.com/tags/ftp/"}]},{"title":"Windows LinuxSubSystem","slug":"wsl","date":"2018-11-18T16:00:00.000Z","updated":"2019-07-23T07:17:40.821Z","comments":true,"path":"2018/11/19/wsl/","link":"","permalink":"http://yoursite.com/2018/11/19/wsl/","excerpt":"","text":"å®‰è£… oh-my-zsh curl 1sh -c \"$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\" wget 1sh -c \"$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)\" æ›´æ”¹é»˜è®¤ shell1chsh -s $(which zsh) æ›´æ”¹ä¸»é¢˜1vim ~/.zshrc 12ZSH_THEME=&quot;agnoster&quot;DEFAULT_USER=&quot;jeremy&quot; é—®é¢˜ å­—ä½“é—®é¢˜å¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸ è§£å†³åŠæ³•ï¼šWindows ç¯å¢ƒå®‰è£… powerline-fonts å¹¶è®¾ç½®æ§åˆ¶å°å­—ä½“https://github.com/powerline/fonts.git å¯åŠ¨vimçš„æ—¶å€™ä¼šå‡ºç°å­—ä½“å˜å›åŸæ¥çš„æ–°å®‹ä½“çš„æƒ…å†µï¼š win + R -&gt; è¿è¡Œ -&gt; 12```HKEY_CURRENT_USER\\Console\\C:_Program Files_WindowsApps_CanonicalGroupLimited.Ubuntu18.04onWindows_1804.2018.817.0_x64__79rhkp1fndgsc_ubuntu1804.exe æ·»åŠ ï¼šCodePage (DWORD (32) ç±»å‹ã€å€¼ 0x01b5)","categories":[{"name":"tools","slug":"tools","permalink":"http://yoursite.com/categories/tools/"}],"tags":[{"name":"windows","slug":"windows","permalink":"http://yoursite.com/tags/windows/"},{"name":"wsl","slug":"wsl","permalink":"http://yoursite.com/tags/wsl/"}]},{"title":"Zabbix Proxy åˆ†å¸ƒå¼ç›‘æ§","slug":"zabbix _proxy","date":"2018-11-17T16:00:00.000Z","updated":"2019-07-23T07:17:44.088Z","comments":true,"path":"2018/11/18/zabbix _proxy/","link":"","permalink":"http://yoursite.com/2018/11/18/zabbix _proxy/","excerpt":"","text":"1. å®‰è£… MySQLã€Zabbix Prorxy1234567# å®‰è£… MySQLapt install mysql-server# å®‰è£… zabbix proxywget https://repo.zabbix.com/zabbix/3.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.4-1+xenial_all.debdpkg -i zabbix-release_3.4-1+xenial_all.debapt updateapt install zabbix-server-mysql zabbix-agent zabbix-proxy-mysql zabbix-get zabbix-sender 2. å¯¼å…¥æ•°æ®1mysql -uroot -p 1234--åˆ›å»º zabbix_proxy æ•°æ®åº“create database zabbix_proxy character set utf8 collate utf8_bin;--æˆæƒgrant all privileges on zabbix_proxy.* to zabbix@localhost identified by 'password'; 1zcat /usr/share/doc/zabbix-proxy-mysql/schema.sql.gz | mysql -uzabbix -pzabbix zabbix 3. æ›´æ”¹é…ç½®1vim /etc/zabbix/zabbix_proxy.conf 1234567891011121314151617Server=192.168.6.30Hostname=Zabbix proxyLogFile=/var/log/zabbix/zabbix_proxy.logLogFileSize=0PidFile=/var/run/zabbix/zabbix_proxy.pidSocketDir=/var/run/zabbixDBName=zabbixDBUser=zabbixDBPassword=zabbixConfigFrequency=120DataSenderFrequency=1SNMPTrapperFile=/var/log/snmptrap/snmptrap.logTimeout=30ExternalScripts=/usr/lib/zabbix/externalscriptsFpingLocation=/usr/bin/fpingFping6Location=/usr/bin/fping6LogSlowQueries=3000 4. å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨1systemctl enable zabbix-proxy zabbix-agent mysql","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]},{"title":"Zabbix å®‰è£…æŒ‡å—","slug":"zabbix_installation","date":"2018-11-16T16:00:00.000Z","updated":"2019-07-23T07:17:46.754Z","comments":true,"path":"2018/11/17/zabbix_installation/","link":"","permalink":"http://yoursite.com/2018/11/17/zabbix_installation/","excerpt":"","text":"CentOS å®‰è£… zabbix3.41. å‡†å¤‡123rpm -i http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpmyum install zabbix-server-mysql zabbix-web-mysql zabbix-agentyum -y install php-fpm php php-mysql php-gd php-bcmath php-mbstring php-xml php-ldap 2. è®¾ç½®æ•°æ®åº“123456/usr/bin/mysqladmin -u root password 123456mysql -uroot -ppasswordmysql&gt; create database zabbix character set utf8 collate utf8_bin;mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;zabbix&apos;;mysql&gt; quit; 3. æ•°æ®åº“å¯¼å…¥æ•°æ®1zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix 4. ä¿®æ”¹ zabbix é…ç½®æ–‡ä»¶å¢åŠ  DBPassword=zabbix1vim /etc/zabbix/zabbix_server.conf 1DBPassword=zabbix 5. å°†æ—¶åŒºè®¾ç½®ä¸ºï¼šäºšæ´²/ä¸Šæµ·12vim /etc/httpd/conf.d/zabbix.confphp_value date.timezone Asia/Shanghai 6. å¯åŠ¨æœåŠ¡ï¼Œå°†æœåŠ¡è®¾ä¸ºå¼€æœºå¯åŠ¨12systemctl restart zabbix-server zabbix-agent httpdsystemctl enable zabbix-server zabbix-agent httpd 7. ä¿®æ”¹é»˜è®¤è¯­è¨€ï¼Œæ–‡å­—é…ç½®123vim /usr/share/zabbix/include/locales.inc.phpcp simkai.ttf /usr/share/zabbix/fonts/vim /usr/share/zabbix/include/defines.inc.php","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]},{"title":"Zabbix é€šè¿‡ jmx ç›‘æ§ Tomcat","slug":"zabbix_jmx","date":"2018-11-15T16:00:00.000Z","updated":"2019-07-23T07:17:49.388Z","comments":true,"path":"2018/11/16/zabbix_jmx/","link":"","permalink":"http://yoursite.com/2018/11/16/zabbix_jmx/","excerpt":"","text":"1. å®‰è£… jdk å’Œ zabbix-java-gateway1234# å®‰è£… openjdk æˆ–è€…ä¸‹è½½ tar.gzapt install openjdk-8-jdk# å®‰è£… zabbix-java-gatewayapt install zabbix-java-gateway 2. ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®1vim /etc/zabbix/zabbix_server.conf 123JavaGateway=192.168.6.30JavaGatewayPort=10052StartJavaPollers=50 123systemctl restart zabbix-serversystemctl start zabbix-java-gatewaysystemctl enable zabbix-java-gateway 3. é…ç½®è¢«ç›‘æ§ tomcat1vim /tomcat/bin/catalina.sh 1CATALINA_OPTS=\"-Djava.rmi.server.hostname=&lt; è¢«ç›‘æ§ tomcat ä¸»æœº IP åœ°å€ &gt; -Djavax.management.builder.initial= -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false\" æ›´æ”¹å®Œæˆä¹‹åé‡å¯ tomcat åº”ç”¨ 4. zabbix web é…ç½® æ·»åŠ è¢«ç›‘æ§ tomcat","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"tomcat","slug":"tomcat","permalink":"http://yoursite.com/tags/tomcat/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]},{"title":"Zabbix é€šè¿‡ SNMP è¿›è¡Œç›‘æ§","slug":"zabbix_snmp","date":"2018-11-14T16:00:00.000Z","updated":"2019-07-23T07:17:52.621Z","comments":true,"path":"2018/11/15/zabbix_snmp/","link":"","permalink":"http://yoursite.com/2018/11/15/zabbix_snmp/","excerpt":"","text":"SNMP ç›‘æ§ Linux1. è¢«ç›‘æ§ä¸»æœºå®‰è£… net-snmp1[root@client ~]# yum install -y net-snmp 2. ä¿®æ”¹é…ç½®æ–‡ä»¶1[root@client ~]# vim /etc/snmp/snmpd.conf 123456# sec.name source communitycom2sec notConfigUser default publicview systemview included .1view systemview included .1.3.6.1.2.1.1view systemview included .1.3.6.1.2.1.25.1.1 3. å¯åŠ¨12[root@client ~]# systemctl start snmpd.service[root@client ~]# netstat -nlp | grep 161 4. åœ¨ zabbix server ä¸Šæµ‹è¯•12[root@zabbix ~]# yum install -y net-snmp[root@zabbix ~]# snmpwalk -v 2c -c zabbix 192.168.1.51 | wc -l 5. zabbixçš„webç•Œé¢æ·»åŠ ä¸»æœº æ·»åŠ æ¨¡æ¿ è®¾ç½® communities SNMP ç›‘æ§ ESXI1. å¼€å¯ ESXI çš„ SNMP æœåŠ¡ï¼ˆå…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®ï¼‰ è®¾ç½® communities 1[root@esxi:~] esxcli system snmp set --communities public å¼€å¯ SNMP æœåŠ¡ 1[root@esxi:~] esxcli system snmp set --enable true å…è®¸æ‰€æœ‰ä¸»æœºè®¿é—® SNMP 12[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all trueAlready allowed all ip è®¾ç½®é˜²ç«å¢™ 1[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true é‡å¯ SNMP æœåŠ¡ 12345[root@esxi:~] /etc/init.d/snmpd restartroot: snmpd Running from interactive shell, running command: esxcli system snmp set -e false.root: snmpd setting up resource reservations.root: snmpd opening firewall port(s) for notifications.root: snmpd watchdog for snmpd started. 2. å¼€å¯ ESXI ä¸»æœºçš„ SNMP æœåŠ¡ï¼ˆå…è®¸ç‰¹å®šä¸»æœºè®¿é—®ï¼‰ ç¦æ­¢æ‰€æœ‰ä¸»æœºè®¿é—® SNMP 1[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all false è®¾ç½®é˜²ç«å¢™ 12[root@esxi:~] esxcli network firewall ruleset allowedip add --ruleset-id snmp --ip-address 10.0.101.0/24[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true é‡å¯ SNMP æœåŠ¡ 1[root@esxi:~] /etc/init.d/snmpd restart 3. æµ‹è¯•æ˜¯å¦èƒ½è·å– SNMP æ•°æ® åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šå®‰è£… SNMP 1[root@zabbix ~]# yum -y install net-snmp net-snmp-utils net-snmp-devel æµ‹è¯•è·å–ä¿¡æ¯ 12[root@zabbix ~]# snmpwalk -v 2c -c sunwoda 192.168.9.24:161 | wc -l4594 4. Zabbix æ·»åŠ ä¸»æœº æ·»åŠ æ¨¡æ¿ è®¾ç½® communities","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]},{"title":"Zabbix ä¼ä¸šå¾®ä¿¡å‘Šè­¦","slug":"zabbix_wechat_alert","date":"2018-11-13T16:00:00.000Z","updated":"2019-07-23T07:17:55.611Z","comments":true,"path":"2018/11/14/zabbix_wechat_alert/","link":"","permalink":"http://yoursite.com/2018/11/14/zabbix_wechat_alert/","excerpt":"","text":"1. ç¼–è¾‘ zabbix_server.conf é…ç½® zabbix å‘Šè­¦è„šæœ¬è·¯å¾„1AlertScriptsPath=/usr/local/share/zabbix/alertscripts/ 2. åˆ›å»ºå‘é€æ¶ˆæ¯è„šæœ¬ ç¼–å†™è„šæœ¬ vim wechat.py 123456789101112131415161718192021222324252627282930313233#!/usr/bin/env python#coding=utf-8import requestsimport jsonimport osimport sys# åŸºæœ¬ä¿¡æ¯CropID = 'xxxxxxxxxx'Secret = 'xxxxxxxxxx'agentid = 'xxxxxxxxx'touser = 'xxxxxxxxxx' # è·å–TokenGetToken =\"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=\"+ CropID + \"&amp;corpsecret=\" + Secretheaders = &#123;'Content-Type': 'application/json'&#125;json_data = json.loads(requests.get(GetToken).content.decode())token = json_data[\"access_token\"]# æ¶ˆæ¯å‘é€æ¥å£Purl = \"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=\" + token# æ¶ˆæ¯å‘é€å‡½æ•°def sendmsg(message): weixin_msg = &#123; \"touser\" : \"TangYingJie\", \"msgtype\" : \"text\", \"agentid\" : 1000002, \"text\" : &#123; \"content\" : message &#125;, &#125; print requests.post(Purl,json.dumps(weixin_msg),headers=headers) if __name__ == '__main__': message = sys.argv[1] #è·å–ç¬¬äºŒä¸ªå‚æ•° sendmsg(message) æµ‹è¯•è„šæœ¬å‘é€æ¶ˆæ¯ 1./wechat.py æµ‹è¯•æ¶ˆæ¯ 3. è¿›å…¥ zabbix ä¸»ç•Œé¢é…ç½®æŠ¥è­¦åª’ä»‹ç±»å‹ ç”¨æˆ· -&gt; æŠ¥è­¦åª’ä»‹ åŠ¨ä½œ -&gt; æ“ä½œ é»˜è®¤æ¥æ”¶äºº 1&#123;TRIGGER.STATUS&#125; : &#123;TRIGGER.NAME&#125; é»˜è®¤ä¿¡æ¯ 12345678910å½“å‰çŠ¶æ€ : &#123;TRIGGER.STATUS&#125;å‘Šè­¦ä¸»æœº : &#123;HOST.NAME&#125;å‘Šè­¦åœ°å€ : &#123;HOST.IP&#125;å‘Šè­¦æ—¶é—´ : &#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;å‘Šè­¦ç­‰çº§ : &#123;TRIGGER.SEVERITY&#125;å‘Šè­¦ä¿¡æ¯ : &#123;TRIGGER.NAME&#125;ç›‘æ§å–å€¼ : &#123;ITEM.VALUE&#125;ç›‘æ§é¡¹ç›® : &#123;ITEM.NAME&#125;æŒç»­æ—¶é—´ : &#123;EVENT.AGE&#125;äº‹ä»¶ID : &#123;ITEM.ID&#125; åŠ¨ä½œ -&gt; æ¢å¤æ“ä½œ","categories":[{"name":"monitor","slug":"monitor","permalink":"http://yoursite.com/categories/monitor/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"},{"name":"zabbix","slug":"zabbix","permalink":"http://yoursite.com/tags/zabbix/"}]}]}